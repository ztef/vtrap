/*! VOne 2017-03-23 - Property of Geckode LCC */
function toRadians(a){return a*VOne.degToRad}function loadJSON(a,b){var c=new XMLHttpRequest;c.overrideMimeType("application/json"),c.open("GET",a,!0),c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&b(c.responseText)},c.send(null)}function calculateXYInRadius(a,b){var c=toRadians(a);return{x:Math.cos(c)*b,y:Math.sin(c)*b}}function getAngleInDegreesFromCenter(a){var b=Math.atan2(a.y,a.x)*VOne.radToDeg;return b}function randomCoordsInRadius(a,b){var d=Math.random(),e=Math.random();return b&&d>e&&(c=e,e=d,d=c),{x:e*a*Math.cos(2*Math.PI*d/e),y:e*a*Math.sin(2*Math.PI*d/e)}}function nearestPow2(a){return Math.pow(2,Math.round(Math.log(a)/Math.log(2)))}function randomCoordsInCircle(a,b){a=a||100;var d=Math.random(),e=Math.random();return b&&d>e&&(c=e,e=d,d=c),[e*a*Math.cos(2*Math.PI*d/e),e*a*Math.sin(2*Math.PI*d/e)]}function randomCoordsInSphere(a,b){var c=Math.random(),d=Math.random();b&&c>d&&(w=d,d=c,c=w);var e=VOne.DoublePI*c,f=Math.acos(2*d-1),g=a*Math.sin(f)*Math.cos(e),h=a*Math.sin(f)*Math.sin(e),i=a*Math.cos(f);return[g,h,i]}var VOne={VERSION:"1.1.1"};if("function"==typeof define&&define.amd)define("VOne",VOne);else if("undefined"!=typeof exports&&"undefined"!=typeof module){module.exports=VOne;var THREE=require("three")}Object.assign(VOne,{PositionAnimation:0,ScaleAnimation:1,AlphaAnimation:2,MeshNameProperty:0,ChildNameProperty:1,MeshClassName:2,degToRad:Math.PI/180,radToDeg:180/Math.PI,SphericalIncrementRatio:3*Math.PI-Math.sqrt(5),GoldenRatio:(Math.sqrt(5)+1)/2-1,HalfPI:Math.PI/2,DoublePI:2*Math.PI}),VOne.SceneCreator=function(){this.type="SceneCreator"},VOne.SceneCreator.prototype={constructor:VOne.SceneCreator,createScene:function(a){var b=a||{},c=new THREE.Scene;c.VOneData={};var d=b.width||window.innerWidth,e=b.height||window.innerHeight,f=(d/window.innerWidth,e/window.innerHeight,b.bgColor||0),g=b.bgAlpha||1,h=b.parentType||"window",i=b.glRenderer||THREE.WebGLRenderer,j=b.verticalDegFOV||45,k=b.verticalVisibleUnits||2e4,l=b.controls||void 0,m=b.useControls||void 0,n=b.camera||void 0;c.VOneData.container="div"===h?document.createElement("div"):document.body,c.VOneData.containerId=b.containerId||"VOneContainer",(b.width||b.height)&&(c.VOneData.containerDimensions={width:d,height:e});var o=b.raycastThreshold||20,p=b.cameraNear||.1,q=b.cameraFar||25e4,r=b.useTweenAnimations||!1,s=d/e;c.VOneData.interactiveObjects=[],c.VOneData.interactiveModels={add:function(a){c.VOneData.interactiveObjects.push(a)}};var t;c.VOneData.container.style.margin="0",c.VOneData.container.style.padding="0";var u=k/2/Math.tan(toRadians(j/2));if(c.redererPaused=!1,c.VOneData.bgColor=f,c.VOneData.bgAlpha=g,c.VOneData.rendererType=i===THREE.WebGLRenderer?"webGL":"other",c.VOneData.rendererClass=i,"div"===h&&(document.body.appendChild(c.VOneData.container),c.VOneData.container.style.width=d+"px",c.VOneData.container.style.height=e+"px",c.VOneData.container.style.zIndex="-1",c.VOneData.container.id=c.VOneData.containerId,c.VOneData.containerType="div"),n?c.camera=n:(c.camera=new THREE.PerspectiveCamera(j,s,p,q),c.camera.position.z=u),c.add(c.camera),l&&(c.VOneData.controls=new l(c.camera,c.VOneData.container),a.controlsConfig))for(var v=Object.keys(a.controlsConfig),w=0;w<v.length;w++)c.VOneData.controls[v[w]]=a.controlsConfig[v[w]];if(m&&(c.VOneData.controls=m),c.VOneData.sceneManager=new VOne.ThreeSceneManager(c,c.VOneData.interactiveModels),c.VOneData.sceneManager.controls=c.VOneData.controls,VOne.RenderersManager.addScene(c),a.bodyBGColor&&(VOne.RenderersManager.bgColor=a.bodyBGColor),a.bodyBGAlpha&&(VOne.RenderersManager.bgAlpha=a.bodyBGAlpha),"webGL"===c.VOneData.rendererType){var x;c.mouse=new THREE.Vector2,c.mouseOnScreen=new THREE.Vector2,c.VOneData.raycaster=new THREE.Raycaster,c.VOneData.raycaster.params.Points.threshold=o,c.VOneData.INTERSECTED=null;var y;c.VOneData.rendererProperties=a.glRendererCustomProperties,c.render=function(){if(c.VOneData.interactiveObjects.length>0){c.VOneData.raycaster.setFromCamera(c.mouse,c.camera);var a=c.VOneData.raycaster.intersectObjects(c.VOneData.interactiveObjects);if(a.length>0){var b;if(a[0].object.geometry instanceof THREE.BufferGeometry){var d=a[0];if(d.hasOwnProperty("faceIndex")){c.VOneData.lastInteractiveModelName=a[0].object.name;var e=Math.floor(a[0].faceIndex*c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName].dataModel.length/a[0].object.geometry.attributes.position.count);y=e}else y=a[0].index;x=!0}else a[0].object.geometry instanceof THREE.Geometry&&(y=a[0].object,x=!1);if(c.VOneData.INTERSECTED!=y){if(null!==c.VOneData.INTERSECTED&&(b=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName],"function"==typeof b.onMouseOut))if(x){var f=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName].dataModel[c.VOneData.INTERSECTED];b.onMouseOut(f,c.VOneData.INTERSECTED)}else b.onMouseOut(y);if(c.VOneData.INTERSECTED=y,c.VOneData.lastInteractiveModelName=a[0].object.name,b=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName],"function"==typeof b.onMouseOver)if(x){var f=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName].dataModel[c.VOneData.INTERSECTED];b.onMouseOver(f,c.VOneData.INTERSECTED)}else b.onMouseOver(y)}}else if(null!==c.VOneData.INTERSECTED){var b=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName];if("function"==typeof b.onMouseOut)if(x){var f=c.VOneData.interactiveModels[c.VOneData.lastInteractiveModelName].dataModel[c.VOneData.INTERSECTED];b.onMouseOut(f,c.VOneData.INTERSECTED)}else b.onMouseOut(y);c.VOneData.INTERSECTED=null}}c.VOneData.controls&&c.VOneData.controls.update(),c.VOneData.sceneManager.onRender.length>0&&c.VOneData.sceneManager.onRender.forEach(function(a){a.fn(a.params)}),t.render(c,c.camera)},r&&c.VOneData.sceneManager.registerAnimationEngine()}else render=function(){controls&&controls.update(),c.VOneData.sceneManager.onRender.length>0&&c.VOneData.sceneManager.onRender.forEach(function(a){a.fn(a.params)}),t.render(c,c.camera)};return c.VOneData.sceneManager}},VOne.assignLevelData=function(a,b){b=b||{};var c=b.childPropertyName||"values",d=(b.parentPropertyName||"key",b.storeTotalValueAs||"totalValue"),e=b.setTotalBy||void 0,f=b.extendRecordsOn||!1,g=b.setProcessLastChild||void 0,h=0,i=function(a,b){if(Array.isArray(a))for(var j=0;j<a.length;j++){if(e&&(a[j][d]=0),a[j].level=b,!(c in a[j]))return;var k=b+1;i(a[j][c],k);var l=0;a[j][c].forEach(function(b){if(b.groupIndex=l,b.parent=a[j],l++,!b[c]){if(f&&!b.traversed){for(var i=1;i<b[f];i++)a[j][c].push(b),h++;b.traversed=!0}e&&("function"==typeof e?b[d]=e(b):b[d]=e),g&&g(b),h++}e&&(a[j][d]+=b[d])}),e&&a[j][c].sort(function(a,b){return a[d]-b[d]})}};i(a,0)},VOne.RadialDistribution=function(){function a(b,d,e,f,g){var h=d||0,i=e||360,j=g||0;if(!b[0].key){j++;var k=f*j,l=calculateXYInRadius(h,k),m=calculateXYInRadius(i,k),n=(h+i)/2,o=Math.sqrt(Math.pow(m.x-l.x,2)+Math.pow(m.y-l.y,2))/2,p=calculateXYInRadius(n,k);return void b.forEach(function(a,b){var d=randomCoordsInRadius(o,!0);a.position={x:p.x+d.x,y:p.y+d.y},a.angle=getAngleInDegreesFromCenter(a.position),a.level=j,c.graphModel.push(a)})}var q=h,r=(i-h)/b.length;j++,b.forEach(function(b,d){b.startAngle=q,q+=r,b.endAngle=q,b.angle=(b.endAngle+b.startAngle)/2,b.position=calculateXYInRadius(b.angle,j*f),c.graphModel.push(b),a(b.values,b.startAngle,b.endAngle,f,j),b.values.forEach(function(a){a.parent=b}),b.level=j})}var b,c={};return c.graphModel=[],c.data=function(a){return b=a,c},c.generateDistribution=function(d){if(!b)return void console.error("ERROR: no data to process. ");if(!b[0].key||!b[0].values)return void console.error("ERROR: Data array objects must contain key:String and values:Array properties.");var e=d.distanceFromParent||3500;return c.graphModel=[],a(b,0,360,e,d.firstNodeInCenter?-1:0),c},c.attachToScene=function(a,b,d){return VOne.CPSBufferGeometriesGenerator().generateGeometries(a,b,c.graphModel,d)},c},VOne.ForceDirectedLayoutEngine=function(a,b){b=b||{},this.averageForceUpdateThreshold=b.averageForceUpdateThreshold||.001,this.repulsion=b.repulsion||.5,this.springConstant=b.springConstant||.4,this.maxForce=b.maxForce||40,this.edgeLength=b.edgeLength||400,this.dampingFactor=b.dampingFactor||.1,this.setGraph(a)},VOne.ForceDirectedLayoutEngine.prototype={constructor:VOne.ForceDirectedLayoutEngine,setGraph:function(a){this.graph=a,this.graph.changed=!0,this.randomNodePositions()},clearForces:function(){this.graph.nodes.forEach(function(a,b){a.force.set(0,0,0)})},addRepulsiveForces:function(a,b){var c=a.getVector(b),d=c.length()/this.edgeLength;.01>d&&(d=.01);var e=this.repulsion/(d*d);this.addForce(a,c,-1*e),this.addForce(b,c,e)},step:function(){this.doFDLStep(),this.doFDLStep()},doFDLStep:function(){this.clearForces();var a=this,b=this.graph.nodes,c=b.length;b.forEach(function(d,e){for(var f=e+1;c>f;f++){var g=b[f];a.addRepulsiveForces(d,g)}});this.graph.edges;this.graph.edges.forEach(function(b,c){a.addEdgeForces(b)}),this.updateNodePositions()},randomNodePositions:function(){var a=this;this.graph.nodes.forEach(function(b,c){b.position.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),b.position.normalize(),b.position.multiplyScalar(Math.random()*a.edgeLength),b.update()})},addForce:function(a,b,c){a.force.x=a.force.x+b.x*c,a.force.y=a.force.y+b.y*c,a.force.z=a.force.z+b.z*c},getAverageForce:function(){var a=0;return this.graph.nodes.forEach(function(b,c){a+=b.force.length()}),a/this.graph.nodes.length},addEdgeForces:function(a){var b=a.from,c=a.to,d=b.getVector(c),e=a.defaultLength||this.edgeLength,f=d.length()-e;if(f>.1){var g=this.springConstant*f;this.addForce(b,d,g),this.addForce(c,d,-1*g)}},updateNodePositions:function(){var a=this;this.graph.nodes.forEach(function(b,c){var d=b.force.length(),e=b.force.clone();d>a.maxForce&&(d=a.maxForce),e.normalize(),e.multiplyScalar(d*a.dampingFactor),b.position.add(e),b.update()}),this.graph.edges.forEach(function(a,b){a.update()})}},VOne.Graph=function(){this.nodes=[],this.edges=[],this.nodeIdMap={},this.nodeIdentifierMap={},this.relationships={},this.maxId=0,this.startingPosition=new THREE.Vector3(0,0,0),this.changed=!1},VOne.Graph.prototype={constructor:VOne.Graph,addNode:function(a){this.nodes.push(a),this.nodeIdMap["n"+a.id]=a,a.identifier&&(this.nodeIdentifierMap[a.identifier]=a),a.graph=this,this.maxId=Math.max(this.maxId,a.id),this.changed=!0},addEdge:function(a){return this.edges.push(a),a.graph=this,this.changed=!0,a},getNodeById:function(a){return this.nodeIdMap["n"+a]},findEdge:function(a,b){for(var c=0;c<this.edges.length;c++){var d=this.edges[c];if(d.from==a&&d.to==b)return d}return!1},findOrCreateNode:function(a){var b=this.getNodeById(a);return b||(b=new VOne.GraphNode(a),this.addNode(b)),b},findOrCreateEdge:function(a,b){var c=this.findEdge(a,b);return c?c:(c=new VOne.GraphEdge(a,b),this.addEdge(c),c)},getOutgoingEdges:function(a){var b=[];return this.edges.forEach(function(c,d){c.from==a&&-1==b.indexOf(c)&&b.push(c)}),b},getIncoming:function(a){var b=[];return this.edges.forEach(function(c,d){c.to==a&&-1==b.indexOf(c)&&b.push(c)}),b},getEdges:function(a){var b=[];return this.edges.forEach(function(c,d){c.from!=a&&c.to!=a||-1!=b.indexOf(c)||b.push(c)}),b},getTargetNodes:function(){var a=[];return this.nodes.forEach(function(b,c){b.isTarget()&&a.push(b)}),a},getSources:function(){var a=[];return $.each(this.nodes,function(b,c){c.isSource(c)&&a.push(c)}),a},isLastTarget:function(a){return this.edges.forEach(function(b,c){return b.from==a?!1:void 0}),!0},isSource:function(a){return this.edges.forEach(function(b,c){return b.to==a?!1:void 0}),!0}},VOne.GraphBuilder=function(a,b){this.data=a,this.map=b||{}},VOne.GraphBuilder.prototype={constructor:VOne.GraphBuilder,buildGraph:function(){var a=new VOne.Graph,b="id",c="id";this.map.id&&(b=this.map.id),this.map.targetId&&(c=this.map.targetId);var d;return this.data.forEach(function(c,e){d=c[b];var f=new VOne.GraphNode(d,a);a.addNode(f)}),this.data.forEach(function(d,e){var f=d[b];d.friends.forEach(function(b,d){var e=b[c],g=a.getNodeById(f),h=a.getNodeById(e),i=new VOne.GraphEdge(g,h);a.addEdge(i)})}),a}},VOne.GraphEdge=function(a,b){this.from=a,this.to=b},VOne.GraphEdge.prototype={constructor:VOne.GraphEdge,getVector:function(){var a=this.to.position.clone();return a.sub(this.from.position),a},initNodePositions:function(a){this.to.atOrigin()&&!this.from.atOrigin()?this.to.position.set(Math.random()+this.from.position.x,Math.random()+this.from.position.y,Math.random()+this.from.position.z):this.from.atOrigin()&&!this.to.atOrigin()?this.from.position.set(Math.random()+this.to.position.x,Math.random()+this.to.position.y,Math.random()+this.to.position.z):a&&(this.from.position.set(a.x,a.y,a.z),this.to.position.set(a.x,a.y,a.z)),this.graph.changed=!0},update:function(){}},VOne.GraphNode=function(a){this.position=new THREE.Vector3(0,0,0),this.force=new THREE.Vector3(0,0,0),this.id=a,this.label="node_x",this.graph=null,this.type=void 0},VOne.GraphNode.prototype={constructor:VOne.GraphNode,getVector:function(a){if(!a)return void console.log("no node");var b=a.position.clone();return b.sub(this.position),b},atOrigin:function(){return 0==this.position.x&&0==this.position.y&&0==this.position.z},getOutgoing:function(){return this.graph.getOutgoing(this)},getIncoming:function(){return this.graph.getIncoming(this)},getEdges:function(){return this.graph.getEdges(this)},getChildren:function(){var a=[],b=this.getOutgoing();return b.forEach(function(b,c){-1==a.indexOf(b.to)&&a.push(b.to)}),a},getParents:function(){var a=[],b=this.getIncoming();return b.forEach(function(b,c){var d=b.from;-1==a.indexOf(d)&&a.push(d)}),a},isSource:function(){return this.graph.isSource(this)},isTarget:function(){return this.graph.isTarget(this)},setLabel:function(a){this.label=a},setType:function(a){this.type=a},update:function(){}},VOne.fibSphere=function(a,b,c,d){for(var e,f,g,h,i,j=2/a,k=new Float32Array(3*a),l=d?Math.random()*a:1,m=0;a>m;m++)f=m*j-1+j/2,i=Math.sqrt(1-f*f),h=(m+l)%a*VOne.SphericalIncrementRatio,e=Math.cos(h)*i,g=Math.sin(h)*i,k[3*m]=b.x+e*c,k[3*m+1]=b.y+f*c,k[3*m+2]=b.z+g*c;return k},VOne.circlePackLayout=function(a,b){if(!Array.isArray(a))return console.error("Provided data must be an array!"),-1;b||(b={});var c=b.childPropertyName||"values",d=b.nestedData||!1,e=b.setRadius||!1,f=b.radiusPropertyName||"radius",g=b.positionPropertyName||"center",h=b.centerX||0,i=b.centerY||0,j=b.padding||0,k=b.toleranceDistanceFactor||.01,l=function(a,b,h){if(e){var i="function"==typeof e;a.forEach(function(a){a[f]=i?e(a):e})}if(Array.isArray(a)){a.sort(function(a,b){return a[f]<b[f]?-1:a[f]>b[f]?1:0});var o,p,q,r,s=[];if(p=b,q=h,a[0][g]=new THREE.Vector3(p,q,0),s[0]=a[0],d&&c in a[0]&&l(a[0][c],p,q),a.length>1&&(p=b+a[0][f]+a[1][f]+j,q=h,a[1][g]=new THREE.Vector3(p,q,0),s[1]=a[1],d&&c in a[1]&&l(a[1][c],p,q)),a.length>2)for(var t,u,v=1,w=2;w<a.length;w++){for(t=!0,o=a[w],u=w-1;t;)r=m(s[0],s[1],o[f]+j),p=r.x,q=r.y,o[g]=new THREE.Vector3(p,q,0),n(o,a,w-1,k)?(v===w&&(u++,v=1,u>=w-1&&(u=2)),v++,s[0]=a[v],s[1]=a[u]):(t=!1,s[1]=o);d&&c in a[w]&&l(a[w][c],p,q)}}},m=function(a,b,c){var d,e,h=b[g].x>=a[g].x,i=b[g].y>=a[g].y,j=b[f]+a[f],k=0,l=0,m=a[g].distanceTo(b[g]),n=a[f]+c;h?i?(e=b[g].y-a[g].y,k=Math.asin(e/m)):(d=b[g].x-a[g].x,k=-Math.acos(d/m)):i?(d=b[g].x-a[g].x,k=Math.acos(d/m)):(e=b[g].y-a[g].y,k=Math.PI-Math.asin(e/m));var o=0;if(Math.abs(j-m)>.02*a[f]){var p=m-j;o=p/2*a[f]/b[f]}l=k+Math.acos((a[f]+o)/n);var q=a[g].x+Math.cos(l)*n,r=a[g].y+Math.sin(l)*n;return{x:q,y:r}},n=function(a,b,c,d){c=c||b.length-1,d=d||.001;for(var e,h=1-d,i=0;c>=i;i++)if(a!==b[i]&&(e=a[g].distanceTo(b[i][g]),e*h<a[f]+j))return!0;return!1};l(a,h,i)},VOne.DeathSphere=function(){this.type="VOne.DeathSphere"},VOne.DeathSphere.prototype.constructor=VOne.DeathSphere,VOne.DeathSphere.prototype.generate=function(a,b,c){if(!Array.isArray(a))return console.error("An array must be provided to create a Death sphere."),-1;"undefined"==typeof c&&(c="deathSphere");var d=b.childrenPropertyName||"values",e=b.parentPropertyName||"key",f=b.valueProperty||"totalValue",g=b.marginDegrees||20,h=b.radius||500,i=b.segmentsResolution||32,j=[],k=[],l=[],m=[],n=0,o=function(a,b){for(var c=(b-a)*VOne.degToRad,d=c/i,e=[],f=a*VOne.degToRad,g=0;i>=g;g++){var j=h*Math.cos(f),k=h*Math.sin(f);e.push(new THREE.Vector2(j,k)),f+=d}return e};calculateLevel0Total=function(){for(var b=0,c=0;c<a.length;c++)b+=a[c][f];return b},n=a[0][e]&&a[0][e][f]?a[0][e][f]:calculateLevel0Total();for(var p,q,r,s,t,u,v,w,x=0,y=-90+g,z=90-g,A=z-y,B=0;B<a.length;B++){p=x+VOne.DoublePI*a[B][f]/n,w=(x+p)/2,q=o(y,z),r=p-x,a[B].geometry=new THREE.LatheGeometry(q,32,x,r),a[B].middlePhi=w,j.push(a[B].geometry),k.push(a[B]),s=y;for(var C=0;C<a[B][d].length;C++)v=a[B][d][C][f]/a[B][f],t=s+v*A,u=o(s,t),a[B][d][C].geometry=new THREE.LatheGeometry(u,12,x,r),a[B][d][C].parentIndex=B,l.push(a[B][d][C].geometry),m.push(a[B][d][C]),s=t;x=p}var D=new VOne.GeometryModel("main"+c,void 0,k);D.setGeometries(j);var E=new VOne.GeometryModel("secondary"+c,void 0,m);return E.setGeometries(l),{mainGeometryModel:D,secondaryGeometryModel:E}},VOne.halfTube=function(a,b,c){a=a||1e3,b=b||{x:0,y:0,z:0},c=c||{};var d=c.height||500,e=c.radius||1e3,f=c.startPhi||180,g=c.endPhi||360,h=c.pointsPerRow||12,i=Math.ceil(a/h),j=d/i;if(f>g){var k=f;f=g,g=k}for(var l,m,n=(g-f)/h*VOne.degToRad,o=f*VOne.degToRad+n/2,p=o,q=b.y-d/2,r=new Float32Array(3*a),s=1;a>=s;s++){var t=s-1;l=e*Math.cos(p),m=e*Math.sin(p),r[3*t]=b.x+l,r[3*t+1]=q,r[3*t+2]=b.z+m,s%h!==0&&0!==s?p+=n:(p=o,q+=j)}return r},VOne.spiral=function(a,b){b=b||{};for(var c,d,e,f,g=b.centerX||0,h=b.centerY||0,i=b.sizePropertyName||"radius",j=b.positionPropertyName||"position",k=b.setSize||!1,l=b.linearPadding||0,m=b.radialPadding||0,n=b.z||0,o=b.looseSpiral||!1,p=b.startRadius||0,q=0,r=0,s=0;s<a.length;s++)k&&("function"==typeof k?a[s][i]=k(a[s],s):a[s][i]=k),e=o?p+a[s][i]*VOne.GoldenRatio:p>0?p+(2*Math.pow(a[s][i],2)+m)/Math.PI/p/2:a[s][i],f=Math.atan((q+a[s][i]+l)/p)+r,c=g+e*Math.cos(f),d=h+e*Math.sin(f),a[s][j]=new THREE.Vector3(c,d,n),q=a[s][i],p=e,r=f},VOne.GeometryModel=function(a,b,c,d){this.type="GeometryModel",this.name=a+"Nodes",this.dataModel=c,this.nodesAttributes=d,this.mesh=b,this.geometries=void 0,this.setInteraction=function(a,b){this[a]=b}},VOne.GeometryModel.prototype={constructor:VOne.GeometryModel,setGeometries:function(a){this.geometries=a}},VOne.Scenes=[],VOne.BufferGeometryModel=function(a){this.type="BufferGeometryModel",this.dataModel=a,this.positionArray=void 0,this.colorArray=void 0,this.sizeArray=void 0,this.alphaArray=void 0,this.geometry=void 0,this.mesh=void 0,this.animating=!1},VOne.BufferGeometryModel.prototype={constructor:VOne.BufferGeometryModel,setPositionArray:function(a){this.positionArray=a},getPositionArray:function(){return this.positionArray},setColorArray:function(a){this.colorArray=a},getColorArray:function(){return this.colorArray},setSizeArray:function(a){this.sizeArray=a},getSizeArray:function(){return this.sizeArray},setAlphaArray:function(a){this.alphaArray=a},getAlphaArray:function(){return this.alphaArray},setDataModel:function(a){this.dataModel=a},getDataModel:function(){return this.dataModel},setGeometry:function(a){this.geometry=a},getGeometry:function(){return this.geometry},setMesh:function(a){var b=this;a.getModel=function(){return b},this.mesh=a},getSceneObject:function(){return this.mesh},setAnimating:function(a){this.animating=a},setInteraction:function(a,b){this[a]=b}},VOne.PreparedBufferGeometryModel=function(a,b){return a&&"number"==typeof a?(VOne.BufferGeometryModel.call(this,b),this.type="PreparedBufferGeometryModel",this.maxVerticesNumber=a,this.setPositionFor=void 0,this.setColorFor=void 0,this.setSizeFor=void 0,this.setAlphaFor=void 0,void this.setGeometry(new THREE.BufferGeometry)):new Error("Usage: new PreparedBufferGeometryModel(maxVerticesNumber, [dataModel]);")},VOne.PreparedBufferGeometryModel.prototype=Object.create(VOne.BufferGeometryModel.prototype),VOne.PreparedBufferGeometryModel.prototype.constructor=VOne.PreparedBufferGeometryModel,VOne.PreparedBufferGeometryModel.prototype.setPosition=function(a){return this.setPositionFor=a,void 0===this.positionArray&&(this.positionArray=new Float32Array(3*this.maxVerticesNumber),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.positionArray,3))),this},VOne.PreparedBufferGeometryModel.prototype.setSize=function(a){return this.setSizeFor=a,void 0===this.sizeArray&&(this.sizeArray=new Float32Array(this.maxVerticesNumber),this.geometry.addAttribute("size",new THREE.BufferAttribute(this.sizeArray,1))),this},VOne.PreparedBufferGeometryModel.prototype.setColor=function(a){return this.setColorFor=a,void 0===this.colorArray&&(this.colorArray=new Float32Array(3*this.maxVerticesNumber),this.geometry.addAttribute("color",new THREE.BufferAttribute(this.colorArray,3))),this},VOne.PreparedBufferGeometryModel.prototype.setAlpha=function(a){return this.setAlphaFor=a,void 0===this.alphaArray&&(this.alphaArray=new Float32Array(this.maxVerticesNumber),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(this.alphaArray,1))),this},VOne.PreparedBufferGeometryModel.prototype.setDataModel=function(a){return a.length>this.maxVerticesNumber&&console.warn("Providing a model larger than the max vertices number assigned can lead to unexpected and fatal behaviour."),this.dataModel=a,this},VOne.PreparedBufferGeometryModel.prototype.appendRecords=function(a,b){var c=b||!1,d=this.dataModel.length,e=d+a.length;return this.dataModel.extend(a),c&&this.processRecords(d,a.length),{previusModelSize:d,currentModelSize:e}},VOne.PreparedBufferGeometryModel.prototype.processRecords=function(a,b){var c=a||0,d=b||this.dataModel.length,e=d+c;e>this.dataModel.length&&(e=this.dataModel.length-1);for(var f,g=c;e>g;g++)f=this.dataModel[g],void 0!==this.setPositionFor&&("function"==typeof this.setPositionFor?f.position=this.setPositionFor(f,g):f.position=this.setPositionFor,this.positionArray[3*g]=f.position.x,this.positionArray[3*g+1]=f.position.y,this.positionArray[3*g+2]=f.position.z),void 0!==this.setColorFor&&("function"==typeof this.setColorFor?f.color=this.setColorFor(f,g):f.color=this.setColorFor,this.colorArray[3*g]=f.color.r,this.colorArray[3*g+1]=f.color.g,this.colorArray[3*g+2]=f.color.b),void 0!==this.setSizeFor&&("function"==typeof this.setSizeFor?f.size=this.setSizeFor(f,g):f.size=this.setSizeFor,this.sizeArray[g]=f.size),void 0!==this.setAlphaFor&&("function"==typeof this.setAlphaFor?f.alpha=this.setAlphaFor(f,g):f.alpha=this.setAlphaFor,this.alphaArray[g]=f.alpha);void 0!==this.setPositionFor&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()),void 0!==this.setColorFor&&(this.geometry.attributes.color.needsUpdate=!0),void 0!==this.setSizeFor&&(this.geometry.attributes.size.needsUpdate=!0),void 0!==this.setAlphaFor&&(this.geometry.attributes.alpha.needsUpdate=!0),this.geometry.drawRange.count=this.dataModel.length},VOne.PreparedBufferGeometryModel.prototype.setGeometryDrawRangeCount=function(a){this.geometry.drawRange.count=a},VOne.BackgroundModelGenerator=function(a,b,c){if(!a||!b)return console.error("Must provide a valid records count value and a model to initialize! ej.:\n var mySuperModelGenerator = new VOne.BackgroundModelGenerator(howManyRecordsToHandle, { propertyName: 'property_type', propertyName: 'property_type' } );\n Check VOne documentation about valid property's types"),-1;var d=this;this.maskedDataModel=[],this.modelKeys=Object.keys(b),this.rawData={},this.dataModel=void 0,VOne.PreparedBufferGeometryModel.call(this,a,this.dataModel),this.type="BackgroundModelGenerator",this.recordsCount=a,this.recordsPartialDeliverCount=c||a,this.partialDeliver3Times=3*this.recordsPartialDeliverCount,this.worker=void 0,this.positionsProgram=void 0,this.colorsProgram=void 0,this.sizesProgram=void 0,this.alphasProgram=void 0,this.modelKeys.forEach(function(c){switch(b[c]){case"Int8Array":d.rawData[c]=new Int8Array(a);break;case"Uint8Array":d.rawData[c]=new Uint8Array(a);break;case"Uint8ClampedArray":d.rawData[c]=new Uint8ClampedArray(a);break;case"Int16Array":d.rawData[c]=new Int16Array(a);break;case"Uint16Array":d.rawData[c]=new Uint16Array(a);break;case"Int32Array":d.rawData[c]=new Int32Array(a);break;case"Uint32Array":d.rawData[c]=new Uint32Array(a);break;case"Float32Array":d.rawData[c]=new Float32Array(a);break;case"Float64Array":d.rawData[c]=new Float64Array(a)}}),this.program=["var model = { }, recordsPartialDeliverCount = "+this.recordsPartialDeliverCount+";","var dataModel_;","var extras;","var recordsCount_;","function initModel(dataModel, recordsCount){","dataModel_ = dataModel;","var keys = Object.keys(dataModel);","recordsCount_ = recordsCount;","keys.forEach(function(key){","switch(dataModel[key]){","case 'Int8Array':","model[key] = new Int8Array(recordsCount);","break;","case 'Uint8Array':","model[key] = new Uint8Array(recordsCount);","break;","case 'Uint8ClampedArray':","model[key] = new Uint8ClampedArray(recordsCount);","break;","case 'Int16Array':","model[key] = new Int16Array(recordsCount);","break;","case 'Uint16Array':","model[key] = new Uint16Array(recordsCount);","break;","case 'Int32Array':","model[key] = new Int32Array(recordsCount);","break;","case 'Uint32Array':","model[key] = new Uint32Array(recordsCount);","break;","case 'Float32Array':","model[key] = new Float32Array(recordsCount);","break;","case 'Float64Array':","model[key] = new Float64Array(recordsCount);","break;","default:","if(dataModel[key].toLowerCase().indexOf('string') > -1){","var lengthStartPos = dataModel[key].indexOf('(');","var lengthEndPos = dataModel[key].indexOf(')');","var strMaxLength = parseInt(dataModel[key].substr(lengthStartPos + 1, lengthEndPos - lengthStartPos - 1));","model[key] = new Uint8Array(recordsCount * strMaxLength);","}","break;","}","});","self.postMessage(model);","};","function stringToTypedArray(s) {","var escstr = encodeURIComponent(s);","var binstr = escstr.replace(/%([0-9A-F]{2})/g, function(match, p1) {","return String.fromCharCode('0x' + p1);","});","var ua = new Uint8Array(binstr.length);","Array.prototype.forEach.call(binstr, function (ch, i) {","ua[i] = ch.charCodeAt(0);","});","return ua;","}"],this.messengerProgramHead=["self.onmessage = function(e){","var data = e.data;","switch(data.cmd){","case 'initModel':","initModel(data.dataModel, data.recordsCount);","break;","case 'processRecords':","processRecords(data.records, data.offset);","break;","case 'getRecords':","self.postMessage({ messageType: 'model', content: model });","break;","case 'setExtras':","extras = data.extras;","break;"],this.messengerProgramBody=[],this.messengerProgramTail=["default:","self.postMessage('Unrecognized command or command not yet implemented. sorry... =(');","break;","}","}"],this.recordsCount3Times=3*this.recordsCount,this.dataModelForWorker=b,this.drawRangeCurrentIndex=0},VOne.BackgroundModelGenerator.prototype=Object.create(VOne.PreparedBufferGeometryModel.prototype),VOne.BackgroundModelGenerator.prototype.constructor=VOne.BackgroundModelGenerator,VOne.BackgroundModelGenerator.prototype.setPositionScript=function(a){return this.positionsProgram=[],this.program.push("var positionArray = new Float32Array("+this.partialDeliver3Times+"); var positionResult;"),this.program.push("var setPositionFunction = function(record, index) { "+a+" } ;"),this.positionsProgram.push("positionResult = setPositionFunction(record, i);"),this.positionsProgram.push("positionArray[j * 3] = positionResult.x"),this.positionsProgram.push("positionArray[j * 3 + 1] = positionResult.y"),this.positionsProgram.push("positionArray[j * 3 + 2] = positionResult.z"),this.useSetPositionsProgram=!0,this.messengerProgramBody.push("case 'getPositionArray':","self.postMessage({ messageType: 'positionArray', content: positionArray });","break;"),this.positionArray=new Float32Array(this.recordsCount3Times),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.positionArray,3)),this},VOne.BackgroundModelGenerator.prototype.setColorScript=function(a){return this.colorsProgram=[],this.program.push("var colorArray = new Float32Array("+this.partialDeliver3Times+"); var colorResult;"),this.program.push("var setColorFunction = function(record, index){ "+a+" };"),this.colorsProgram.push("colorResult = setColorFunction(record, i);"),this.colorsProgram.push("colorArray[j * 3] = colorResult.r"),this.colorsProgram.push("colorArray[j * 3 + 1] = colorResult.g"),this.colorsProgram.push("colorArray[j * 3 + 2] = colorResult.b"),this.useSetColorsProgram=!0,this.messengerProgramBody.push("case 'getColorArray':","self.postMessage({ messageType: 'colorArray', content: colorArray });","break;"),this.colorArray=new Float32Array(this.recordsCount3Times),this.geometry.addAttribute("color",new THREE.BufferAttribute(this.colorArray,3)),this},VOne.BackgroundModelGenerator.prototype.setSizeScript=function(a){return this.sizesProgram=[],this.program.push("var sizeArray = new Float32Array("+this.recordsPartialDeliverCount+"); var sizeResult;"),this.program.push("var setSizeFunction = function(record, index) { "+a+" };"),this.sizesProgram.push("sizeResult = setSizeFunction(record, i);"),this.sizesProgram.push("sizeArray[j] = sizeResult"),this.useSetSizesProgram=!0,this.messengerProgramBody.push("case 'getSizeArray':","self.postMessage({ messageType: 'sizeArray', content: sizeArray });","break;"),this.sizeArray=new Float32Array(this.recordsCount),this.geometry.addAttribute("size",new THREE.BufferAttribute(this.sizeArray,1)),this},VOne.BackgroundModelGenerator.prototype.setAlphaScript=function(a){return this.alphasProgram=[],this.program.push("var alphaArray = new Float32Array("+this.recordsPartialDeliverCount+"); var alphaResult;"),this.program.push("var setAlphaFunction = function(record, index){ "+a+" };"),this.alphasProgram.push("alphaResult = setAlphaFunction(record, i);"),this.alphasProgram.push("alphaArray[j] = alphaResult"),this.useSetAlphasProgram=!0,this.messengerProgramBody.push("case 'getAlphaArray':","self.postMessage({ messageType: 'alphaArray', content: alphaArray });","break;"),this.alphaArray=new Float32Array(this.recordsCount),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(this.alphaArray,1)),this},VOne.BackgroundModelGenerator.prototype.init=function(){var a=this;if(this.program.push("var processRecords = function(records, offset){","var finalIndex = records.length + offset;","var record;","var currentIndex = 0;","var modelKeys = Object.keys(model);","var j = 0;","var strIndex;","var toStore;","for(var i = offset; i < finalIndex; i++, j++){","record = records[currentIndex];","modelKeys.forEach(function(key){","if(dataModel_[key].toLowerCase().indexOf('string') === -1){","model[key][currentIndex] = record[key];","} else {","strIndex = model[key].length / recordsCount_ * i","toStore = stringToTypedArray(record[key])","toStore.forEach(function (value, index) {","model[key][strIndex + index] = value"," } );","}","});"),this.positionsProgram&&this.program.push(this.positionsProgram.join("\n")),this.colorsProgram&&this.program.push(this.colorsProgram.join("\n")),this.sizesProgram&&this.program.push(this.sizesProgram.join("\n")),this.alphasProgram&&this.program.push(this.alphasProgram.join("\n")),this.program.push("currentIndex ++;","}"),this.positionsProgram||this.colorsProgram||this.sizesProgram||this.alphasProgram){var b=[],c=[],d=0;this.program.push("self.postMessage({ messageType: 'transferrables', offset: offset, finalIndex: finalIndex, transferrables: {  "),this.positionsProgram&&(b.push(d>0?", positionArray: positionArray":"positionArray: positionArray"),c.push(d>0?", positionArray.buffer":"positionArray.buffer"),d++),this.colorsProgram&&(b.push(d>0?", colorArray: colorArray":"colorArray: colorArray"),c.push(d>0?", colorArray.buffer":"colorArray.buffer"),d++),this.sizesProgram&&(b.push(d>0?", sizeArray: sizeArray":"sizeArray: sizeArray"),c.push(d>0?", sizeArray.buffer":"sizeArray.buffer"),
d++),this.alphasProgram&&(b.push(d>0?", alphaArray: alphaArray":"alphaArray: alphaArray"),c.push(d>0?", alphaArray.buffer":"alphaArray.buffer"),d++);var e=Object.keys(this.rawData);e.forEach(function(a){b.push(d>0?", "+a+': model["'+a+'"]':a+': model["'+a+'"]'),c.push(d>0?', model["'+a+'"].buffer':'model["'+a+'"].buffer'),d++}),this.program.push(b.join(""),"} }, [",c.join(""),"]);"),this.program.push(this.positionsProgram?"positionArray = new Float32Array("+this.partialDeliver3Times+");":""),this.program.push(this.colorsProgram?"colorArray = new Float32Array("+this.partialDeliver3Times+");":""),this.program.push(this.sizesProgram?"sizeArray = new Float32Array("+this.recordsPartialDeliverCount+");":""),this.program.push(this.sizesProgram?"alphaArray = new Float32Array("+this.recordsPartialDeliverCount+");":""),this.program.push("initModel(dataModel_, "+this.recordsPartialDeliverCount+");")}this.program.push("}"),this.program.push(this.messengerProgramHead.join("\n")),this.program.push(this.messengerProgramBody.join("\n")),this.program.push(this.messengerProgramTail.join("\n"));var f=this.program.join("\n"),g=new Blob([f]),h=window.URL.createObjectURL(g);return this.worker=new Worker(h),this.worker.onerror=function(a){console.log("Error from background model generator worker","ERROR: Line "+a.lineno+" in "+a.filename+": "+a.message)},this.worker.onmessage=function(b){var c=b.data;if(c.messageType)switch(c.messageType){case"positionArray":this.positionArray=c.content;break;case"colorArray":this.colorArray=c.content;break;case"sizeArray":this.sizeArray=c.content;break;case"alphaArray":this.alphaArray=c.content;break;case"model":this.rawData=c.content;break;case"transferrables":a.updateGeometryModelArrays(c.transferrables,c.offset,c.finalIndex);break;case"info":console.log(c.content);break;default:console.log("Received the following message from background thread. But I don't know what to do with it: ",c.content)}},this.worker.postMessage({cmd:"initModel",dataModel:this.dataModelForWorker,recordsCount:this.recordsPartialDeliverCount}),this},VOne.BackgroundModelGenerator.prototype.processRecords=function(a,b){this.worker.postMessage({cmd:"processRecords",records:a,offset:b})},VOne.BackgroundModelGenerator.prototype.setExtrasForWorker=function(a){this.worker.postMessage({cmd:"setExtras",extras:a})},VOne.BackgroundModelGenerator.prototype.updateGeometryModelArrays=function(a,b,c){var d=this;a.positionArray&&(this.positionArray.set(a.positionArray,3*b),this.geometry.attributes.position.needsUpdate=!0),a.colorArray&&(this.colorArray.set(a.colorArray,3*b),this.geometry.attributes.color.needsUpdate=!0),a.sizeArray&&(this.sizeArray.set(a.sizeArray,b),this.geometry.attributes.size.needsUpdate=!0),a.alphaArray&&(this.alphaArray.set(a.alphaArray,b),this.geometry.attributes.alpha.needsUpdate=!0),this.modelKeys.forEach(function(c){d.rawData[c].set(a[c],b)}),this.dataModel=new Proxy(this.rawData,{get:function(a,b){var c={};return d.modelKeys.forEach(function(a){c[a]=d.rawData[a][b]}),c}}),this.setGeometryDrawRangeCount(c-1),this.geometry.computeBoundingSphere()},VOne.BackgroundModelGenerator.prototype.typedArrayToString=function(a){var b=Array.prototype.map.call(a,function(a){return String.fromCharCode(a)}).join(""),c=b.replace(/(.)/g,function(a,b){var c=b.charCodeAt(b).toString(16).toUpperCase();return c.length<2&&(c="0"+c),"%"+c});return decodeURIComponent(c)},VOne.DefaultImages={star:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHDRYtFjgycv0AAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAABlNJREFUWMPll8uPHUcVxn9fdfd9zcy1PePYjj32YJkQDA5BipBAAqQIsQD+B1hlj8QCsOwBO0aILRJr/gZ2sIoILBAOcgSBxGAzNs68PO/7mn5U1WHRPQqRYo8HkRUlXfW93eqq36nz1XfOhf/nUV6G9ONcYL8PhYEBxwRu8MGzRxchfOZjAAjA+Ay4NsQWuBa4AJMKRtOgEfQGUJ6FcOF/BDA+CToF7W4dbZZDuQnpRXAJmCAD4gSsgGJQf5dA/82CG6dgdh7CPmgM4RLEk5BMAYIwAHYgeQjxC/U7ioAH5RDGwCboBUiOLJxPQvY50Kcg/A3sMugT4F4AdxlsHtwMOAfKIPszxFdAHaANZOAEtCBZPWIK7p6HcBluXvlhKgm+TWpmSIICz0O4+Z1feJYHxJ4RQ7PVl+rIGYDtgSU1YLAjpuDq1atpkiRpjLEDpGbWbq4kSeLNrDCz3DmXL37pludNKN+Bzp8g/BK0CbYMrINtAXtHALh+/XoqqRNCmJI0B8xIascY2wCSCmAMDM1sz8zGSZLk19593edvw9SvM2y3Ij4A7oO9X0Mkz7p4CKEDzAFnJC1IOg/MA6cknQSeA/pAJskBQVL47cmvxq//8c3Id19E7YKkVUFVo1rxDBpYXFxMQwgd59ycpHPAgpk9b2YnJXVr3RMlRTMbAbNAv9kdYoxeBT5kL6NouP4SzBWoD9p+BoAQQgocM7MzZrYg6ZKkeWAG6ACJpGBmE0nTZtYHus1975wrrr32A38rcT6ka9BeRVMFtYoOScHi4mJqZj1Jp4EFSZeAi8A5SReSJFlI0/RskiRzwJSZAbjmY2ZWNWD7b/ye+OqXN6KqVRjuY+u1Vxy2A2kz8WyT59OSTkg6n6bp+SzLprvdbpJlmZVlmY9Go+Pe+3sxxmBmBTAEHjvntiXlFvZQrIglyIPFZ/OBjnNu2sxONDAzaZqearVa/VarlfR6Paanpwkh9CTN7+3tjWOMI0nTTZp6Ztb23qfOP/JxPIFBLUJVhwDEGFMza5tZD2ibWSYpy7Ks2+v1XLfbZWZmhn6/j5kpz/POeDyeCyG8H2PMGo10JaWtVgu3u0ZcD7AG7IKNDwFoXM41gkrMLEoiTVM3NTWlfr9Pv9+n3W5TliVZlsk5125Sl9SGSyIplYR/6NEysAK2W9eRQwGccxEIDYwBeYyxcs5Zp9NRq9Wqa0RZUhSFxRgrMwvNySglBcCbGXoPbBPcNsRBrZCnAqRpSlVVhXNuImkMFMCkLMutwWAwnWVZq6oqnHPs7OwwGAyKsiy3gZzabvLmJHhJxKU693Fc23AcHS5C75zLJY3MbChpYmYT7/2DwWCQFUXxXKfTaccYyfM8L4piJca43Kh/BOxJ2m5OhNdj8AVoAtkQysEzAEgam9kmsC7p+EFey7L03vuNyWQyDbgQwgDYALaAXTN73PzelZRfe+uWt6LuC2xQi7C/VBvGE8fNmze9cy53zm1JWgX+ZWbrZrYjaS3GeC+E8K73/q/APWDtALaWGisxxr2qqnK3AbYBPICpO5AtfWA0Tx2SfFPl1swsacRZmdlsc8ycJBqh7QPbZrYCPDCztRjj6MbvfuZjAd13Ptrpnrz/l8C/ccP/9NUf5cCWmRFjLCTtA7OSOgdzmJkHBjHGbUkrzrmNEMJelmW+dQfc/hMCfGr7dQX8aUjm4ScLdVU0s46kY5JmgN5/BOGBiZkNzWwvSZKRc85//zc3PI+gt3xEgPASmIPqLHAOkgvAS/Dj21dTSR3nXAq0Y4xIwjkXQgi+EW5+bXjLH3Q/+TKc+OcRAEZfg/aF+mG1DW6uroHuZXCfbhNnr/D6z7+VSiKEcABQNy/fuOHjHYjvAatg66D3oXP/ydXuw5F/BfznBa/0CL2M5O4I+4vHCrASrAoQB1z93opPkxcxSzDbxKo/kExuowegEhQAgyRCMn56uf3wOAf6bIf4xSto6nns1G3i0jIaAttgux6mVnDuLYLtgFooPsZVf4fhkLDRdL8F2ATCBFw8AkBwQMvhOtOEdBYd79RuMYS4Buk0uGxMDHexzirC1f9QRkNsOaAVsJ3a7Tio+ztHAHC7EJf2sftv42b/AXfX0RbECOkWWAo+gM7t42ZyDGFlxHbqTtet1r0/ozp6RpB+E/jVRwP8G3R7eXmZvRtYAAAAAElFTkSuQmCC"},VOne.Shaders={nodesCPS:{vertex:["attribute vec3 color;","attribute float size;","varying vec3 vColor;","void main() {","vColor = color;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * (600.0 / length( mvPosition.xyz ) );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 uniformsColor;","uniform sampler2D texture;","varying vec3 vColor;","void main() {","gl_FragColor = vec4( uniformsColor * vColor, 1.0 );","gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );","}"].join("\n")}},VOne.ThreeSceneManager=function(a,b){this.type="ThreeSceneManager",this._scene=a,this.sceneModel={},this.objectIndex=0,this._interactiveModels=b,this.camera=a.camera,this.controls=void 0,this.onRender=[],VOne.Scenes.push(this)},VOne.ThreeSceneManager.prototype={constructor:VOne.ThreeSceneManager,add:function(a,b,c){this.objectIndex++;var d=b||"g"+this.objectIndex;if(a.sceneManager=this,Array.isArray(a)){var e=c||new THREE.Object3D;return a.forEach(function(a){e.add(a)}),c||(this._scene.add(e),this.sceneModel[d]=e),e}if(c){var f=this.sceneModel[c];return f||(f=new THREE.Object3D,this.sceneModel[c]=f,this._scene.add(f)),this.sceneModel[c].add(a),this.sceneModel[c]}return this._scene.add(a),void(this.sceneModel[d]=a)},registerInteractiveBufferGeometry:function(a){var b;"undefined"==typeof a.name?(b="bufferGeometry"+this.objectIndex,a.mesh.name=b):b=a.name,this._interactiveModels[b]=a,this._interactiveModels.add(a.mesh)},unRegisterInteractiveBufferGeometry:function(a){var b=this;this._scene.VOneData.interactiveObjects.forEach(function(c,d){return c===a.mesh?b._scene.VOneData.interactiveObjects.splice(d,1):void 0})},registerInteractiveGeometry:function(a){var b=a.name;this._interactiveModels[b]=a;for(var c=0;c<a.mesh.length;c++)a.mesh[c].name=b,this._interactiveModels.add(a.mesh[c])},getLastObject:function(){var a=Object.keys(this.sceneModel),b=a[a.length-1];return this.sceneModel[b]},getObjectsCount:function(){var a=Object.keys(this.sceneModel);return a.length},getObject:function(a){return this.sceneModel[a]},removeObject:function(a){this._scene.remove(this.sceneModel[a]),delete this.sceneModel[a]},getSceneObjects:function(){return this.sceneModel},removeLastObjectFromScene:function(a){var b,c=Object.keys(this.sceneModel);return a?(b=c[c.length-1],this._scene.remove(this.sceneModel[b]),delete this.sceneModel[b],!0):c.length>1?(b=c[c.length-1],this._scene.remove(this.sceneModel[b]),delete this.sceneModel[b],!0):!1},clear:function(){for(var a=Object.keys(this.sceneModel),b=0;b<a.length;b++)this._scene.remove(this.sceneModel[a[b]]),delete this.sceneModel[a[b]]},setCameraPosition:function(a,b,c){this._scene.camera.position.set(a,b,c)},setOnRender:function(a,b,c){if("function"!=typeof a)console.error("ERROR: You must provide a function!");else{var d=c||"",e=b||[];this.onRender.push({id:d,fn:a,params:e})}},removeFromOnRenderById:function(a){if(!a||""===a)return void console.warn("Can't remove a function without id.");for(var b,c=this.onRender.length,d=0;c>d;d++)if(b=this.onRender[d],b.id===a)return this.onRender.splice(d,1),b},registerAnimationEngine:function(){var a=new VOne.AnimationEngine(this);this.setOnRender(a.animate,this,"animationEngine")},pauseRenderer:function(){this._scene.redererPaused=!0},resumeRenderer:function(){this._scene.redererPaused=!1},getMouse:function(){return this._scene.mouse},getMouseOnScreen:function(){return this._scene.mouseOnScreen}},VOne.RenderersManager={glRenderer:!1,clock:new THREE.Clock,scenesToRender:{},bgColor:0,bgAlpha:1,canvas:void 0,addScene:function(a,b){var c=(a.VOneData.rendererType,!1);if(0===Object.keys(VOne.RenderersManager.scenesToRender).length&&(c=!0),a.VOneData.rendererClass===THREE.WebGLRenderer){VOne.RenderersManager.glRenderer||(VOne.RenderersManager.canvas=document.createElement("canvas"),VOne.RenderersManager.canvas.style.width="100%",VOne.RenderersManager.canvas.style.height="100%",VOne.RenderersManager.canvas.style.top="0",VOne.RenderersManager.canvas.style.left="0",VOne.RenderersManager.canvas.style.zIndex="-1",VOne.RenderersManager.canvas.style.position="fixed",document.body.appendChild(VOne.RenderersManager.canvas),VOne.RenderersManager.scenesToRender.glRenderer={scenes:[]},VOne.RenderersManager.glRenderer=new THREE.WebGLRenderer({canvas:VOne.RenderersManager.canvas,alpha:!0,antialias:!0}),VOne.RenderersManager.glRenderer.setClearColor(VOne.RenderersManager.bgColor,VOne.RenderersManager.bgAlpha),VOne.RenderersManager.glRenderer.setPixelRatio(window.devicePixelRatio)),a.VOneData.id=b,VOne.RenderersManager.scenesToRender.glRenderer.scenes.push(a),a.VOneData.renderer=VOne.RenderersManager.glRenderer;var d=parseInt(a.VOneData.container.style.width.substr(0,a.VOneData.container.style.width.indexOf("px"))),e=parseInt(a.VOneData.container.style.height.substr(0,a.VOneData.container.style.height.indexOf("px")));a.VOneData.container.widthRelation=d/window.innerWidth,a.VOneData.container.heightRelation=e/window.innerHeight,a.onMouseMove=function(b){b.preventDefault();var c=b.target.getBoundingClientRect();a.mouse.x=b.offsetX/c.width*2-1,a.mouse.y=2*-(b.offsetY/c.height)+1,a.mouseOnScreen.x=b.offsetX,a.mouseOnScreen.y=b.offsetY},a.onMouseClick=function(b){if(b.preventDefault(),null!==a.VOneData.INTERSECTED&&(model=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName],"function"==typeof model.onClick))if(isBufferGeometry){var c=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName].dataModel[a.VOneData.INTERSECTED];model.onClick(c,a.VOneData.INTERSECTED)}else model.onClick(intersectedInterestProperty)}}else VOne.RenderersManager.scenesToRender.otherRenderer||(VOne.RenderersManager.scenesToRender.otherRenderer={scenes:[]}),VOne.RenderersManager.scenesToRender.otherRenderer.scenes.push(a),a.VOneData.renderer=new a.VOneData.rendererClass({alpha:!0,antialias:!0}),a.VOneData.renderer.setSize(a.VOneData.containerDimensions.width,a.VOneData.containerDimensions.height),a.VOneData.container.appendChild(a.VOneData.renderer.domElement);if(a.VOneData.renderer.sortObjects=!0,a.VOneData.rendererProperties){var f=Object.keys(a.VOneData.rendererProperties);f.forEach(function(b){a.VOneData.renderer[b]=a.VOneData.rendererProperties[b]})}a.VOneData.container.addEventListener("mousemove",a.onMouseMove,!1),a.VOneData.container.addEventListener("click",a.onMouseClick,!1),c&&VOne.RenderersManager.animate()},removeSceneById:function(a){},updateRendererSize:function(){},animate:function(){requestAnimationFrame(VOne.RenderersManager.animate),VOne.RenderersManager.renderScenes()},renderScenes:function(){for(var a=Object.keys(VOne.RenderersManager.scenesToRender),b=VOne.RenderersManager.clock.getDelta(),c=0;c<a.length;c++){var d=VOne.RenderersManager.scenesToRender[a[c]].scenes;if("glRenderer"===a[c]){var e=window.innerWidth,f=window.innerHeight;VOne.RenderersManager.canvas.width===e&&VOne.RenderersManager.canvas.height==f||(VOne.RenderersManager.scenesToRender.glRenderer.scenes.forEach(function(a){var b=e/f;if("div"===a.VOneData.containerType){var c=a.VOneData.container.widthRelation*e,d=a.VOneData.container.heightRelation*f;a.VOneData.container.style.width=c+"px",a.VOneData.container.style.height=d+"px"}a.camera.aspect=b,a.camera.updateProjectionMatrix()}),VOne.RenderersManager.glRenderer.setPixelRatio(window.devicePixelRatio),VOne.RenderersManager.glRenderer.setSize(e,f,!1)),VOne.RenderersManager.glRenderer.setClearColor(VOne.RenderersManager.bgColor,VOne.RenderersManager.bgAlpha),VOne.RenderersManager.glRenderer.setScissorTest(!1),VOne.RenderersManager.glRenderer.clear(),VOne.RenderersManager.glRenderer.setScissorTest(!0),d.forEach(function(a){if(a.visible){if(a.VOneData.interactiveObjects.length>0){a.VOneData.raycaster.setFromCamera(a.mouse,a.camera);var c,d,e=a.VOneData.raycaster.intersectObjects(a.VOneData.interactiveObjects);if(e.length>0){if("Points"===e[0].object.type){var f=e[0];if(f.hasOwnProperty("faceIndex")){a.VOneData.lastInteractiveModelName=e[0].object.name;var g=Math.floor(e[0].faceIndex*a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName].dataModel.length/e[0].object.geometry.attributes.position.count);intersectedInterestProperty=g}else intersectedInterestProperty=e[0].index;isBufferGeometry=!0}else"Mesh"===e[0].object.type&&(intersectedInterestProperty=e[0].object,isBufferGeometry=!1);a.VOneData.INTERSECTED!=intersectedInterestProperty&&(null!==a.VOneData.INTERSECTED&&(c=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName],"function"==typeof c.onMouseOut&&(isBufferGeometry?(d=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName].dataModel[a.VOneData.INTERSECTED],c.onMouseOut(d,a.VOneData.INTERSECTED)):c.onMouseOut(intersectedInterestProperty))),a.VOneData.INTERSECTED=intersectedInterestProperty,a.VOneData.lastInteractiveModelName=e[0].object.name,c=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName],"function"==typeof c.onMouseOver&&(isBufferGeometry?(d=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName].dataModel[a.VOneData.INTERSECTED],c.onMouseOver(d,a.VOneData.INTERSECTED)):c.onMouseOver(intersectedInterestProperty)))}else null!==a.VOneData.INTERSECTED&&(c=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName],"function"==typeof c.onMouseOut&&(isBufferGeometry?(d=a.VOneData.interactiveModels[a.VOneData.lastInteractiveModelName].dataModel[a.VOneData.INTERSECTED],c.onMouseOut(d,a.VOneData.INTERSECTED)):c.onMouseOut(intersectedInterestProperty)),a.VOneData.INTERSECTED=null)}a.VOneData.controls&&a.VOneData.controls.update(b),a.VOneData.sceneManager.onRender.length>0&&a.VOneData.sceneManager.onRender.forEach(function(a){a.fn(a.params)});var h=a.VOneData.container.getBoundingClientRect();if(h.bottom>0||h.top<a.VOneData.renderer.domElement.clientHeight||h.right>0||h.left<a.VOneData.renderer.domElement.clientWidth){var i=h.right-h.left,j=h.bottom-h.top,k=h.left,l=a.VOneData.renderer.domElement.clientHeight-h.bottom;a.VOneData.renderer.setViewport(k,l,i,j),a.VOneData.renderer.setScissor(k,l,i,j),VOne.RenderersManager.glRenderer.setClearColor(a.VOneData.bgColor,a.VOneData.bgAlpha),a.VOneData.renderer.render(a,a.camera)}}})}else d.forEach(function(a){a.VOneData.controls&&a.VOneData.controls.update(b),a.VOneData.sceneManager.onRender.length>0&&a.VOneData.sceneManager.onRender.forEach(function(a){a.fn(a.params)}),a.VOneData.renderer.render(a,a.camera)})}}},VOne.CPSBufferGeometriesGenerator=function(){var a={};a.generateGeometries=function(a,b,c,d){var e,f,g,h,i=(a.interactive||"false",c),j=a.hasRelations||!1,k=a.elementZPos||function(a){return 1e3*Math.random()},l=a.elementSize?"function"==typeof a.elementSize?a.elementSize:function(b){return a.elementSize}:function(a){return 250},m=a.elementColor?"function"==typeof a.elementColor?a.elementColor:function(b){return a.elementColor}:function(a){return"pink"},n=a.elementAlpha?a.elementAlpha:.9;if("undefined"==typeof i)return void console.error("ERROR: A data model is required.");j&&(h=new Float32Array(6*i.length),e=a.relationsLinesColor?"function"==typeof a.relationsColor?a.relationsColor:function(b){return a.relationsColor}:function(a){return[7829367,7829367]},f=a.relationsLineWidth||.5,g=a.relationsLinesAlpha?a.relationsLinesAlpha:1);var o,p=new Float32Array(3*i.length),q=new Float32Array(i.length),r=new Float32Array(3*i.length),s=new THREE.BufferGeometry;i.forEach(function(a,b){p[3*b]=a.position.x,p[3*b+1]=a.position.y,a.position.z=a.position.z||k(a),p[3*b+2]=isNaN(a.position.z)?0:a.position.z,q[b]=l(a),a.size=q[b];var c=new THREE.Color(m(a));r[3*b]=c.r,r[3*b+1]=c.g,r[3*b+3]=c.b,a.color=c,j&&a.parent&&(h[6*b]=a.position.x,h[6*b+1]=a.position.y,h[6*b+2]=a.position.z,h[6*b+3]=a.parent.position.x,h[6*b+4]=a.parent.position.y,a.parent.position.z||(a.parent.position.z=k(a.parent)),h[6*b+5]=a.parent.position.z)});var t,u=new THREE.TextureLoader;t=a.texturePath?u.load(a.texturePath):u.load(VOne.DefaultImages.star);var v={uniformsColor:{type:"c",value:new THREE.Color(16777215)},texture:{type:"t",value:t}},w=new THREE.ShaderMaterial({uniforms:v,vertexShader:VOne.Shaders.nodesCPS.vertex,fragmentShader:VOne.Shaders.nodesCPS.fragment,blending:THREE.AdditiveBlending,depthTest:!0,transparent:1>n,opacity:n});s.addAttribute("position",new THREE.BufferAttribute(p,3)),s.addAttribute("color",new THREE.BufferAttribute(r,3)),s.addAttribute("size",new THREE.BufferAttribute(q,1));var x=new THREE.Points(s,w);if(x.name=d+"Nodes",b.add(x,x.name),j){o=new THREE.BufferGeometry,o.addAttribute("position",new THREE.BufferAttribute(h,3));var y=new THREE.Line(o,new THREE.LineBasicMaterial({lineWidth:f,color:e[0],transparent:!0,opacity:g}));y.name=d+"Relations",b.add(y,y.name)}var z=new VOne.GeometryModel(d,x,i,s.attributes);return z};return a},VOne.GraphGeometriesGenerator=function(a,b){return this.type="VOne.GeometriesGenerator",a?(this.graph=a,this.textureMap=b||{"default":{color:"pink",scale:10}},this.geometries=[],this.relationsBufferGeometry=new THREE.BufferGeometry,this.relations=new Float32Array(3*a.edges.length),void(this.lineMaterial=new THREE.LineBasicMaterial({linewidth:.1,color:16777215,transparent:!0,opacity:.8}))):(console.error("You must provide a VOne.graph."),-1)},VOne.GraphGeometriesGenerator.prototype={constructor:VOne.GraphGeometriesGenerator},VOne.GraphGeometriesGenerator.prototype.buildGeometries=function(a){var b=this.textureMap,c=new THREE.TextureLoader,d=this,e=Object.keys(b);e.forEach(function(a){var d;d=a.texturePath?c.load(b[a].texturePath):c.load(VOne.DefaultImages.star);var e=new THREE.Color(b[a].color);b[a].material=new THREE.SpriteMaterial({map:d,color:e})}),this.graph.nodes.forEach(function(a){var c="undefined"==typeof a.type?"default":a.type,e=new THREE.Sprite(b[c].material);e.position=a.position,e.scale.x=e.scale.y=e.scale.z=b[c].scale,a.sprite=e,a.update=function(){var b=a.position.clone();e.position.set(b.x,b.y,b.z)},d.geometries.push(e)}),this.graph.edges.forEach(function(a,b){a.update=function(){var c=a.from.position.clone(),e=a.to.position.clone();d.relations[6*b]=c.x,d.relations[6*b+1]=c.y,d.relations[6*b+2]=c.z,d.relations[6*b+3]=e.x,d.relations[6*b+4]=e.y,d.relations[6*b+5]=e.z,d.relationsBufferGeometry.attributes.position&&(d.relationsBufferGeometry.attributes.position.needsUpdate=!0)},a.update()}),d.relationsBufferGeometry.addAttribute("position",new THREE.BufferAttribute(d.relations,3));var f=new THREE.LineSegments(d.relationsBufferGeometry,d.lineMaterial);return{nodes:this.geometries,relations:f}},VOne.GenericBufferGeometriesGenerator=function(a){this.generator={},this.generator.generateFromModel=function(){if(!this.model)throw new Error("A model is required to generate a points geometry. Use setModel(model) to set one.");var b=!1,c=a?new VOne.InstancedBufferGeometryModel(this.model):new VOne.BufferGeometryModel(this.model),d=this.model.length,e=new THREE.BufferGeometry;if("undefined"!=typeof this.setPosition){var f,g=new Float32Array(3*d);if("function"==typeof this.setPosition)for(var h=0;d>h;h++)f=this.setPosition(this.model[h],h),this.model[h].position=f,g[3*h]=f.x,g[3*h+1]=f.y,g[3*h+2]=f.z;else for(var h=0;d>h;h++)f=this.setPosition,this.model[h].position=f,g[3*h]=f.x,g[3*h+1]=f.y,g[3*h+2]=f.z;c.setPositionArray(g),e.addAttribute("position",new THREE.BufferAttribute(g,3)),b=!0}if("undefined"!=typeof this.setColor){var i,j=new Float32Array(3*d);if("function"==typeof this.setColor)for(var h=0;d>h;h++)i=this.setColor(this.model[h]),h,this.model[h].color=i,j[3*h]=i.r,j[3*h+1]=i.g,j[3*h+2]=i.b;else for(var h=0;d>h;h++)i=this.setColor,this.model[h].color=i,j[3*h]=i.r,j[3*h+1]=i.g,j[3*h+2]=i.b;c.setColorArray(j),e.addAttribute("color",new THREE.BufferAttribute(j,3)),b=!0}if("undefined"!=typeof this.setSize){var k,l=new Float32Array(d);if("function"==typeof this.setSize)for(var h=0;d>h;h++)k=this.setSize(this.model[h],h),this.model[h].size=k,l[h]=k;else for(var h=0;d>h;h++)k=this.setSize,this.model[h].size=k,l[h]=k;c.setSizeArray(l),e.addAttribute("size",new THREE.BufferAttribute(l,1)),b=!0}if("undefined"!=typeof this.setAlpha){var m,n=new Float32Array(d);if("function"==typeof this.setAlpha)for(var h=0;h<this.model.length;h++)m=this.setAlpha(this.model[h],h),this.model[h].alpha=m,n[h]=m;else for(var h=0;h<this.model.length;h++)m=this.setAlpha,this.model[h].alpha=m,n[h]=m;c.setAlphaArray(n),e.addAttribute("alpha",new THREE.BufferAttribute(n,1)),b=!0}return b?(c.setGeometry(e),c):(console.error("no geometry generated. Try setting position, color, size or alpha first."),-1)}},VOne.GenericBufferGeometriesGenerator.prototype={constructor:VOne.GenericBufferGeometriesGenerator,setModel:function(a){return this.generator.model=a,this},setPosition:function(a){return this.generator.setPosition=a,this},setColor:function(a){return this.generator.setColor=a,this},setSize:function(a){return this.generator.setSize=a,this},setAlpha:function(a){return this.generator.setAlpha=a,this},generate:function(){return this.generator.generateFromModel()}},VOne.RelationshipBufferGeometriesGenerator=function(){this.generator={},this.generator.generateFromModel=function(){if(!this.model)throw new Error("A model is required to generate a points geometry. Use setModel(model) to set one.");for(var a=new VOne.BufferGeometryModel(this.model),b=this.model.length,c=new THREE.BufferGeometry,d=0,e=0;b>e;e++)"parent"in this.model[e]&&d++;if(0===d)return void console.error("No element within the provided model has <parent> property.");var f,g,h=new Float32Array(6*d);this.setColor&&(f=new Float32Array(6*d)),this.setAlpha&&(g=new Float32Array(2*d));for(var i,j,k,l,m,n,e=0;b>e;e++)"parent"in this.model[e]&&(i=this.model[e],j=this.model[e].parent,k=this.model[e].position.clone(),l=this.model[e].parent.position.clone(),h[6*e]=k.x,h[6*e+1]=k.y,h[6*e+2]=k.z,h[6*e+3]=l.x,h[6*e+4]=l.y,h[6*e+5]=l.z,i.relationshipsFirstIndex=6*e,j.relationshipsFirstIndex=6*e+3,this.setColor&&("function"==typeof this.setColor?(m=this.setColor(i),f[6*e]=m[0].r,f[6*e+1]=m[0].g,f[6*e+2]=m[0].b,f[6*e+3]=m[1].r,f[6*e+4]=m[1].g,f[6*e+5]=m[1].b):(f[6*e]=this.setColor[0].r,f[6*e+1]=this.setColor[0].g,f[6*e+2]=this.setColor[0].b,f[6*e+3]=this.setColor[1].r,f[6*e+4]=this.setColor[1].g,f[6*e+5]=this.setColor[1].b)),this.setAlpha&&("function"==typeof this.setAlpha?(n=this.setAlpha(i),g[2*e]=n[0],g[2*e+1]=n[1]):(g[2*e]=this.setAlpha[0],g[2*e+1]=this.setAlpha[1])));return a.setPositionArray(h),c.addAttribute("position",new THREE.BufferAttribute(h,3)),this.setColor&&(a.setColorArray(f),c.addAttribute("color",new THREE.BufferAttribute(f,3))),this.setAlpha&&(a.setAlphaArray(g),c.addAttribute("alpha",new THREE.BufferAttribute(g,1))),a.setGeometry(c),a}},VOne.RelationshipBufferGeometriesGenerator.prototype={constructor:VOne.RelationshipBufferGeometriesGenerator,setDataModel:function(a){return this.generator.model=a,this},setColor:function(a){return this.generator.setColor=a,this},setAlpha:function(a){return this.generator.setAlpha=a,this},generate:function(){return this.generator.generateFromModel()}},VOne.PieSlice=function(a){var b=a.startAngle*(a.angleInRadians?1:VOne.degToRad),c=a.endAngle*(a.angleInRadians?1:VOne.degToRad),d=a.color||new THREE.Color;this.shape=new THREE.Shape,this.alpha=a.alpha||1;var e={x:Math.cos(b)*a.innerRadius,y:Math.sin(b)*a.innerRadius};({x:Math.cos(c)*a.outerRadius,y:Math.sin(c)*a.outerRadius});this.shape.moveTo(e.x,e.y),this.shape.absarc(0,0,a.innerRadius,b,c),this.shape.absarc(0,0,a.outerRadius,c,b,!0),this.createSliceBufferGeometry(a.height,d)},VOne.PieSlice.prototype.constructor=VOne.PieSlice,VOne.PieSlice.prototype.calculateArcPoints=function(a,b,c){return{startX:Math.cos(a)*c,startY:Math.sin(a)*c,midX:Math.cos((b+a)/2)*c,midY:Math.sin((b+a)/2)*c,endX:Math.cos(b)*c,endY:Math.sin(b)*c}},VOne.PieSlice.prototype.createSliceBufferGeometry=function(a,b){var c={amount:a,bevelEnabled:!1,steps:1,curveSegments:16,dynamic:!0};this.sliceGeometry=new THREE.ExtrudeGeometry(this.shape,c);var d=this.sliceGeometry.faces.length,e=new Float32Array(9*d),f=new Float32Array(9*d),g=new Float32Array(9*d),h=new Float32Array(3*d);this.geometry=new THREE.BufferGeometry;for(var i,j=0;j<this.sliceGeometry.faces.length;j++)i=this.sliceGeometry.faces[j],e[9*j]=this.sliceGeometry.vertices[i.a].x,e[9*j+1]=this.sliceGeometry.vertices[i.a].y,e[9*j+2]=this.sliceGeometry.vertices[i.a].z,e[9*j+3]=this.sliceGeometry.vertices[i.b].x,e[9*j+4]=this.sliceGeometry.vertices[i.b].y,e[9*j+5]=this.sliceGeometry.vertices[i.b].z,e[9*j+6]=this.sliceGeometry.vertices[i.c].x,e[9*j+7]=this.sliceGeometry.vertices[i.c].y,e[9*j+8]=this.sliceGeometry.vertices[i.c].z,f[9*j]=i.normal.x,f[9*j+1]=i.normal.y,f[9*j+2]=i.normal.z,f[9*j+3]=i.normal.x,f[9*j+4]=i.normal.y,f[9*j+5]=i.normal.z,f[9*j+6]=i.normal.x,f[9*j+7]=i.normal.y,f[9*j+8]=i.normal.z,g[9*j]=b.r,g[9*j+1]=b.g,g[9*j+2]=b.b,g[9*j+3]=b.r,g[9*j+4]=b.g,g[9*j+5]=b.b,g[9*j+6]=b.r,g[9*j+7]=b.g,g[9*j+8]=b.b,h[3*j]=this.alpha,h[3*j+1]=this.alpha,h[3*j+2]=this.alpha;this.geometry.addAttribute("position",new THREE.BufferAttribute(e,3)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(f,3)),this.geometry.addAttribute("color",new THREE.BufferAttribute(g,3)),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(h,1)),this.geometry.computeBoundingBox()},VOne.PieSlice.prototype.getGeometry=function(){return this.geometry},VOne.PieSlice.prototype.getEdgesGeometry=function(a){for(var b=a.color||new THREE.Color,c=a.alpha||1,d=new THREE.EdgesGeometry(this.geometry),e=d.attributes.position.count,f=new Float32Array(3*e),g=new Float32Array(e),h=0;e>h;h++)f[3*h]=b.r,f[3*h+1]=b.g,f[3*h+2]=b.b,g[h]=c;return d.addAttribute("color",new THREE.BufferAttribute(f,3)),d.addAttribute("alpha",new THREE.BufferAttribute(g,1)),d},VOne.LeapGrabControls=function(a,b){function c(){p&&w(),q&&x(),r&&y(),e.position.addVectors(d.target,v),v.lengthSq()>Math.pow(n,2)&&e.position.addVectors(d.target,v.setLength(n)),v<Math.pow(m,2)&&e.position.addVectors(d.target,v.setLength(m)),e.lookAt(d.target)}if(!a)return console.error("No scene provided to VOne.LeapGrabControls. Can't start."),-1;this.config=b||{};var d=this;this.sceneManager=a;var e=this.config.objectToControl||a.camera,f=this.config.panSpeed||.02,g=this.config.rotationSpeed||.05,h=(this.config.zoomSpeed||1,new THREE.Vector2),i=new THREE.Vector2,j=new THREE.Vector2,k=new THREE.Vector2,l=1;this.target=new THREE.Vector3;var m=0,n=1/0;this.pointingFlag=!1;var o,p=!1,q=!1,r=!1,s=!1,t=!1,u=void 0!==this.config.useHelperDiv?this.config.useHelperDiv:!0,v=new THREE.Vector3;v.subVectors(e.position,this.target),this.objectToControl&&this.startControls(),this.startControls=function(){if(console.info("starting leapmotion grab controls"),u){var a=document.createElement("div");a.id="VOneRightHandDiv",a.style="position: fixed; right: 0; bottom: 0; width: 25%; height: 0; border: solid 1px #eee;",document.body.appendChild(a);var b=document.createElement("div");b.id="VOneLeftHandDiv",b.style="position: fixed; left: 0; bottom: 0; width: 25%; height: 0; border: solid 1px #eee;",document.body.appendChild(b)}o=new Leap.Controller({enableGestures:!0}),o.setBackground(!0),o.loop(function(e){if(e.hands.length>0){d.sceneManager.controls&&(d.sceneManager.controls.enabled=!1),pointingFlag=!0;for(var f=o.frame(1),g=0;g<e.hands.length;g++){var m,n=e.hands[g];m=1===n.grabStrength?"closed":"open";var v=n.type;if("right"===v){var w=n.translation(f);"open"===m?(u&&(a.style.borderColor="green"),s||(h.setX(w[0]),h.setY(w[1]),i.copy(h)),t=!0,q=!1):(u&&(a.style.borderColor="yellow"),s=!1,i.setX(w[0]),i.setY(w[1]),q=!0),1===e.hands.length&&(b.style.borderColor="#eee",t=!1,r=!1)}else{var x=n.translation(f);"open"===m?(u&&(b.style.borderColor="green"),s||(j.setX(x[0]),j.setY(x[1]),k.copy(j)),s=!0,p=!1):(u&&(b.style.borderColor="yellow"),k.setX(x[0]),k.setY(x[1]),s=!1,p=!0),1===e.hands.length&&(a.style.borderColor="#eee",s=!1,r=!1)}}t&&s?e.scaleFactor(f)>1.5?l=1:(l=e.scaleFactor(f),r=!0):r=!1,c()}else b.style.borderColor="#eee",a.style.borderColor="#eee",s=!1,t=!1,pointingFlag=!1,d.sceneManager.controls&&(d.sceneManager.controls.enabled=!0)})};var w=function(){var a,b=new THREE.Vector3,c=new THREE.Quaternion,f=new THREE.Vector3,h=new THREE.Vector3,i=new THREE.Vector3,j=new THREE.Vector3;return function(){j.set(k.x,k.y,0),a=j.length(),a&&(v.copy(e.position).sub(d.target),f.copy(v).normalize(),h.copy(e.up).normalize(),i.crossVectors(h,f).normalize(),h.setLength(k.y),i.setLength(k.x),j.copy(h.add(i)),b.crossVectors(j,v).normalize(),a*=g,c.setFromAxisAngle(b,a),v.applyQuaternion(c),e.up.applyQuaternion(c))}}(),x=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){v.subVectors(e.position,d.target),a.copy(i),a.multiplyScalar(v.length()*f),c.copy(v).cross(e.up).setLength(a.x),c.add(b.copy(e.up).setLength(-a.y)),e.position.add(c),d.target.add(c)}}(),y=function(){var a=2-l;v.multiplyScalar(a)};this.startControls()},VOne.LeapGrabControls.prototype={constructor:VOne.LeapGrabControls},THREE.Mesh.prototype.addClass=function(a){return"undefined"==typeof this.classes&&(this.classes=[]),this.classes.indexOf(-1!==a)&&this.classes.push(a),this.classes},THREE.Mesh.prototype.removeClass=function(a){if("undefined"==typeof this.classes)return-1;var b=this.classes.indexOf(a);return b>-1&&this.classes.splice(b,1),this.classes},Array.prototype.extend=function(a){a.forEach(function(a){this.push(a)},this)},VOne.select=function(a){var b=new VOne.Selection,c=0,d=1,e=a.charAt(0);switch(e){case"#":c=VOne.MeshNameProperty;break;case"_":c=VOne.ChildNameProperty;break;case".":c=VOne.MeshClassName;break;default:c=VOne.ChildNameProperty,d=0}for(var f=a.substr(d),g=VOne.Scenes.length,h=0;g>h;h++){var i=VOne.Scenes[h].getSceneObjects();if(c===VOne.ChildNameProperty)void 0!==typeof i[f]&&b.selected.push(i[f]);else for(var j=Object.keys(i),k=0;k<j.length;k++)if(Array.isArray(i[j[k]]))i[j[k]].forEach(function(a){switch(c){case VOne.MeshNameProperty:a.name===f&&b.selected.push(a);break;case VOne.MeshClassName:"undefined"!=typeof a.classes&&-1!==a.classes.indexOf(f)&&b.selected.push(a)}});else switch(c){case VOne.MeshNameProperty:i[j[k]].name===f&&b.selected.push(i[j[k]]);break;case VOne.MeshClassName:
"undefined"!=typeof i[j[k]].classes&&-1!==i[j[k]].classes.indexOf(f)&&b.selected.push(i[j[k]])}}return b},VOne.Selection=function(){this.selected=[],this.positionAnimationDuration=void 0,this.positionAnimationTarget=void 0,this.scaleAnimationDuration=void 0,this.scaleAnimationTarget=void 0},VOne.Selection.prototype={constructor:VOne.Selection,setPositionAnimationTarget:function(a){return this.positionAnimationTarget=a,this},setPositionAnimationDuration:function(a){return this.positionAnimationDuration=a,this},setScaleAnimationTarget:function(a){return this.scaleAnimationTarget=a,this},setScaleAnimationDuration:function(a){return this.scaleAnimationDuration=a,this},start:function(){var a=new VOne.Animation,b=this;if("undefined"!=typeof this.positionAnimationTarget){var c,d;"function"==typeof this.positionAnimationTarget?this.selected.forEach(function(e){c=b.positionAnimationTarget(e),d=b.getDurationFor(e),a.meshBasicAnimation(e,VOne.PositionAnimation,c,d)}):this.selected.forEach(function(e){c=b.positionAnimationTarget,d=b.getDurationFor(e),a.meshBasicAnimation(e,VOne.PositionAnimation,c,d)})}if("undefined"!=typeof this.scaleAnimationTarget){var c,d;"function"==typeof this.scaleAnimationTarget?this.selected.forEach(function(e){c=b.scaleAnimationTarget(e),d=b.getDurationFor(e),a.meshBasicAnimation(e,VOne.ScaleAnimation,c,d)}):this.selected.forEach(function(e){c=b.scaleAnimationTarget,d=b.getDurationFor(e),a.meshBasicAnimation(e,VOne.ScaleAnimation,c,d)})}},getDurationFor:function(a){var b;return a===VOne.PositionAnimation?"undefined"!=typeof this.positionAnimationDuration&&(b="function"==typeof this.positionAnimationDuration?this.positionAnimationDuration(this):this.positionAnimationDuration):"undefined"!=typeof this.scaleAnimationDuration&&(b="function"==typeof this.scaleAnimationDuration?this.scaleAnimationDuration(this):this.scaleAnimationDuration),b}},VOne.AnimationEngine=function(a){this.type="VOne.AnimationEngine",this.animate.bind(this)},VOne.AnimationEngine.prototype={constructor:VOne.AnimationEngine,animate:function(a){for(var b=a.getSceneObjects(),c=Object.keys(b),d=0;d<c.length;d++){var e=b[c[d]];if(e instanceof THREE.Points){if("function"!=typeof e.getModel)return;var f=e.getModel();if(f.animating){f.animating=!1;for(var g=!0,h=!0,i=!0,j=f.getDataModel(),d=0;d<j.length;d++){var k=j[d],l=!0;if(k.animating){if(k.positionTween&&k.positionTween.running){var m=1e3*k.positionTween.clock.getElapsedTime(),n=m/k.positionTween.tweenDuration,o=f.getPositionArray();if(1>n){var p=k.positionTween.delta.clone();p.multiplyScalar(n);var q=k.positionTween.start.clone();q.sub(p),k.position.set(q.x,q.y,q.z),o[3*d]=q.x,o[3*d+1]=q.y,o[3*d+2]=q.z,e.geometry.attributes.position.needsUpdate=!0,f.animating=!0}else k.position.set(k.positionTween.dest.x,k.positionTween.dest.y,k.positionTween.dest.z),o[3*d]=k.positionTween.dest.x,o[3*d+1]=k.positionTween.dest.y,o[3*d+2]=k.positionTween.dest.z,e.geometry.attributes.position.needsUpdate=!0,e.geometry.computeBoundingSphere(),k.positionTween.running=!1}if(k.scaleTween&&k.scaleTween.running){var m=1e3*k.scaleTween.clock.getElapsedTime(),n=m/k.scaleTween.tweenDuration,r=f.getSizeArray();if(1>n){var s=k.scaleTween.delta;s*=n;var t=k.scaleTween.start;t+=s,k.size=t,r[d]=t,e.geometry.attributes.size.needsUpdate=!0,f.animating=!0}else k.size=k.scaleTween.dest,r[d]=k.scaleTween.dest,e.geometry.attributes.size.needsUpdate=!0,k.scaleTween.running=!1}if(k.alphaTween&&k.alphaTween.running){var m=1e3*k.alphaTween.clock.getElapsedTime(),n=m/k.alphaTween.tweenDuration,u=f.getAlphaArray();if(1>n){var s=k.alphaTween.delta;s*=n;var t=k.alphaTween.start;t+=s,k.alpha=t,u[d]=t,e.geometry.attributes.alpha.needsUpdate=!0,f.animating=!0}else k.alpha=k.alphaTween.dest,u[d]=k.alphaTween.dest,e.geometry.attributes.alpha.needsUpdate=!0,k.alphaTween.running=!1}k.scaleTween?k.scaleTween.running||(g=!1):g=!1,k.positionTween?k.positionTween.running||(h=!1):h=!1,k.alphaTween?k.alphaTween.running||(i=!1):i=!1,h||g||i||(l=!1),k.animating=l}}}}else if(e instanceof THREE.Mesh||e instanceof THREE.Camera)VOne.AnimationEngine.animateMesh(e);else if(e.children.length>0){e.animating&&VOne.AnimationEngine.animateMesh(e);for(var v=0;v<e.children.length;v++)e.children[v].animating&&VOne.AnimationEngine.animateMesh(e.children[v])}}}},VOne.AnimationEngine.animateMesh=function(a){if(a.animating){var b=!0,c=!0,d=!0;if(a.positionTween&&a.positionTween.running){var e=1e3*a.positionTween.clock.getElapsedTime(),f=e/a.positionTween.tweenDuration;if(1>f){var g=a.positionTween.delta.clone();g.multiplyScalar(f);var h=a.positionTween.start.clone();h.sub(g),a.position.set(h.x,h.y,h.z)}else a.position.set(a.positionTween.dest.x,a.positionTween.dest.y,a.positionTween.dest.z),a.positionTween.running=!1}if(a.scaleTween&&a.scaleTween.running){var e=1e3*a.scaleTween.clock.getElapsedTime(),f=e/a.scaleTween.tweenDuration;if(1>f){var i=a.scaleTween.delta.clone();i.multiplyScalar(f);var j=a.scaleTween.start.clone();j.sub(i),a.scale.set(j.x,j.y,j.z)}else a.scale.set(a.scaleTween.dest.x,a.scaleTween.dest.y,a.scaleTween.dest.z),a.scaleTween.running=!1}a.scaleTween?a.scaleTween.running||(c=!1):c=!1,a.positionTween?a.positionTween.running||(d=!1):d=!1,d||c||(b=!1),a.animating=b}},VOne.Animation=function(){},VOne.Animation.prototype.constructor=VOne.Animation,VOne.Animation.prototype.meshBasicAnimation=function(a,b,c,d,e){var f,g,h,i=d||500;if(!(c instanceof THREE.Vector3))return console.error("Target position / scale must be a THREE.Vector3. Try again."),-1;if(b===VOne.PositionAnimation)f="positionTween",g=a.position.clone(),h=a.position.clone(),h.sub(c);else{if(b!==VOne.ScaleAnimation)return console.error("Provide a valid animation type."),-1;f="scaleTween",g=a.scale.clone(),h=a.scale.clone(),h.sub(c)}var j=new THREE.Clock;j.start();var k={start:g,dest:c,tweenDuration:i,clock:j,delta:h,running:!0};a[f]=k,a.animating=!0},VOne.Animation.prototype.pointsBasicAnimation=function(a,b,c,d,e){var f,g,h,i=e||500;if(0===i&&(i=1),!(a instanceof THREE.Points))return console.error("A THREE.Points object must be supplied in order to be animated."),-1;if(c===VOne.PositionAnimation&&!(d instanceof THREE.Vector3))return console.error("Target position in position animation must be a THREE.Vector3. Try again."),-1;var j=a.getModel(),k=j.getDataModel();if(c===VOne.PositionAnimation)f="positionTween",g=k[b].position.clone(),h=k[b].position.clone(),h.sub(d);else if(c===VOne.ScaleAnimation)f="scaleTween",g=k[b].size,h=k[b].size-d;else{if(c!==VOne.AlphaAnimation)return console.error("Provide a valid animation type."),-1;f="alphaTween",g=k[b].alpha,h=k[b].alpha-d}var l=new THREE.Clock;l.start();var m={start:g,dest:d,tweenDuration:i,clock:l,delta:h,running:!0};k[b][f]=m,k[b].animating=!0,j.animating=!0},VOne.ShaderCreator=function(){},VOne.ShaderCreator.prototype={constructor:VOne.ShaderCreator,createShader:function(a){var b,c=[],d=[];a.color?(c.push("attribute vec3 "+a.color+";"),c.push("varying vec3 vColor;")):a.varyingColor&&(c.push("attribute vec3 "+a.varyingColor.startColor+";"),c.push("attribute vec3 "+a.varyingColor.endColor+";"),c.push("varying vec3 vColor;")),a.textureArrayIndex&&(c.push("attribute float "+a.textureArrayIndex+";"),c.push("varying float v"+a.textureArrayIndex+";")),a.varyingAttributes&&(c.push("attribute float "+a.varyingAttributes.age+";"),c.push("attribute float "+a.varyingAttributes.duration+";")),a.size?c.push("attribute float "+a.size+";"):a.varyingSize&&(c.push("attribute float "+a.varyingSize.startSize+";"),c.push("attribute float "+a.varyingSize.endSize+";")),a.alpha&&(c.push("attribute float "+a.alpha+";"),c.push("varying float VOneAlphaValue;")),c.push("void main() {"),a.varyingAttributes&&c.push("float factor = "+a.varyingAttributes.age+" / "+a.varyingAttributes.duration+";"),a.color?c.push("vColor = "+a.color+";"):a.varyingColor&&c.push("vColor = mix("+a.varyingColor.startColor+", "+a.varyingColor.endColor+", factor);"),a.textureArrayIndex&&c.push("v"+a.textureArrayIndex+" = "+a.textureArrayIndex+";"),a.alpha&&c.push("VOneAlphaValue = "+a.alpha+";"),c.push("vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );"),a.points&&!a.varyingSize&&(b=a.pointsFactor||"200.0",c.push("gl_PointSize = size * ( "+b+" / length( mvPosition.xyz ) );")),a.points&&a.varyingSize&&(b=a.pointsFactor||"200.0",c.push("float sizeFactor = "+a.varyingAttributes.age+" / "+a.varyingAttributes.duration+";"),c.push("gl_PointSize = "+a.varyingSize.startSize+" + sizeFactor *  ( "+a.varyingSize.endSize+" - "+a.varyingSize.startSize+") * ( "+b+" / length(mvPosition.xyz ) ); ")),c.push("gl_Position = projectionMatrix * mvPosition;"),c.push("}");var e={colorUniform:{type:"c",value:new THREE.Color(16777215)}};if(a.useTexture){var f=new THREE.TextureLoader;texture=f.load(a.useTexture),e.texture={type:"t",value:texture},d.push("uniform sampler2D texture;")}if(a.textureArray){if(!a.textureArrayIndex||!Array.isArray(a.textureArray))return console.error("No texture array index property (attribute name) provided."),-1;e.texture={type:"t",value:texture},d.push("uniform sampler2D textures["+a.textureArray.length+"];"),c.push("varying float v"+a.textureArrayIndex+";")}if(a.useTHREETexture&&(e.texture={type:"t",value:a.useTHREETexture},d.push("uniform sampler2D texture;")),d.push("uniform vec3 colorUniform;"),d.push("varying vec3 vColor;"),a.alpha&&d.push("varying float VOneAlphaValue;"),a.textureArray&&d.push("varying float v"+a.textureArrayIndex+";"),d.push("void main() {"),(a.color||a.varyingColor)&&(a.alpha?d.push("gl_FragColor = vec4( colorUniform * vColor, VOneAlphaValue );"):d.push("gl_FragColor = vec4( colorUniform * vColor, 1.0 );")),(a.useTexture||a.useTHREETexture)&&a.points)d.push("gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );"),a.alpha&&d.push("if ( gl_FragColor.a < 0.001 ) discard;");else if(a.textureArray){d.push("vec4 startColor = vec4(vColor, 1.0);"),d.push("vec4 finalColor;");for(var g=0;g<a.textureArray.length;g++)d.push("vec4 finalColor;"),d.push("if(v"+a.textureArrayIndex+" < "+g+".5){ "),d.push("finalColor = texture2D(textures["+g+"], gl_PointCoord);"),d.push("}")}else a.color&&(a.alpha?d.push("gl_FragColor.a = VOneAlphaValue;"):d.push("gl_FragColor = vec4( colorUniform * vColor, 1.0 );"));return d.push("}"),{vertexShader:c.join("\n"),fragmentShader:d.join("\n"),uniforms:e}}},VOne.Label3D=function(a,b){void 0===b&&(b={});var c=b.hasOwnProperty("fontFace")?b.fontFace:"Arial Narrow",d=b.hasOwnProperty("fontSize")?b.fontSize:18,e=b.hasOwnProperty("lineLength")?b.lineLength:27,f=b.hasOwnProperty("maxLines")?b.maxLines:3,g=b.hasOwnProperty("lineHeight")?b.lineHeight:d+5,h=b.hasOwnProperty("borderThickness")?b.borderThickness:2,i=b.hasOwnProperty("borderColor")?b.borderColor:{r:150,g:0,b:150,a:0},j=b.hasOwnProperty("backgroundColor")?b.backgroundColor:{r:255,g:255,b:255,a:0},k=b.hasOwnProperty("textColor")?b.textColor:{r:30,g:0,b:190,a:1},l=b.canvasFixedWidth,m=b.canvasFixedHeight,n=[];"number"==typeof a&&(a=a.toString());for(var o,p,q=a.split(" "),r=0,s=0;f>s&&r<q.length;s++)for(n[s]="",o=!1,p=0;!o&&r<q.length;)p+q[r].length<e?(n[s]+=" "+q[r],r++,p=n[s].length):(n[s]+=" ",o=!0);r<q.length&&(n[f-1]+="...");var t,u=d*e,v=n.length*g;l?t=l:(t=nearestPow2(u),u>t&&(t*=2));var w;m?w=m:(w=nearestPow2(v),w>v&&(w*=2));var x=document.createElement("canvas");x.width=t,x.height=w;var y=x.getContext("2d");y.font=d+"px "+c,y.textAlign=b.textAlign||"center",y.font=""+d+"px "+c,y.fillStyle="rgba("+j.r+","+j.g+","+j.b+","+j.a+")",y.strokeStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",y.lineWidth=h,y.fillStyle="rgba("+k.r+", "+k.g+", "+k.b+", 1.0)";var z=Math.floor(t/2),A=Math.ceil(w/2-v/2+g/2);n.forEach(function(a){y.fillText(a,z,A),A+=g});var B=new THREE.Texture(x);B.needsUpdate=!0;var C,D;return b.spriteMaterial?(C=new THREE.SpriteMaterial({map:B}),D=new THREE.Sprite(C)):(C=new THREE.MeshBasicMaterial({map:B,side:THREE.DoubleSide,depthTest:!0}),C.transparent=!0,D=new THREE.Mesh(new THREE.PlaneGeometry(512,128),C)),D},VOne.LogScale=function(a,b){return Array.isArray(a)&&Array.isArray(b)?(this.domain=a,this.range=b,this.minDomainValue=this.domain[0],this.maxDomainValue=this.domain[1],this.minRangeValue=Math.log(this.range[0]),this.maxRangeValue=Math.log(this.range[1]),void(this.scale=(this.maxRangeValue-this.minRangeValue)/(this.maxDomainValue-this.minDomainValue))):(console.error("VOne.LogScale: Domain and range must be provided as arrays!"),-1)},VOne.LogScale.prototype={constructor:VOne.LogScale,getValueFor:function(a){return Math.exp(this.minRangeValue+this.scale*(a-this.minDomainValue))}},VOne.Polygon=function(a,b,c,d,e,f){var g=360/a,h=e?90:0;this.vertices=[];for(var i=0;a>i;i++){var j=calculateXYInRadius(h,d);j.x+=b,j.y+=c,this.vertices.push(new THREE.Vector2(j.x,j.y)),h+=g}this.vertices.push(this.vertices[0])},VOne.Polygon.prototype.constructor=VOne.Polygon,VOne.HexGrid=function(a,b,c,d,e,f){if(this.lengthX=c>a?c-a:a-c,this.lengthY=d>b?d-b:b-d,this.rotated=f||!0,this.shapes=[],this.model=[],this.byNameModel={},this.hexRadius=e/2,this.startX=a,this.startY=b,this.endX=c,this.endY=d,this.rotated){var g=calculateXYInRadius(30,this.hexRadius),h=calculateXYInRadius(330,this.hexRadius),i=calculateXYInRadius(150,this.hexRadius);this.deltaY=g.y-h.y,this.deltaX=(g.x-i.x)/2}else{var g=calculateXYInRadius(60,this.hexRadius),h=calculateXYInRadius(120,this.hexRadius),i=calculateXYInRadius(300,this.hexRadius);this.deltaY=(g.y-i.y)/2,this.deltaX=g.x-h.x}for(var j=this.rotated?Math.ceil(this.lengthY/(this.hexRadius+2*this.deltaY)):Math.ceil(this.lengthY/this.deltaY),k=this.lengthX/this.deltaX,l=this.rotated?Math.ceil(k):Math.ceil(this.lengthX/(this.hexRadius+deltaX)),m=a,n=b,o=0;l>o;o++){for(var p=0;j>p;p++){var q=new VOne.Polygon(6,m,n,this.hexRadius,this.rotated);q.index=o*j+p;var r=new THREE.Shape(q.vertices);r.name="v"+o+"_"+p,q.name="v"+o+"_"+p,q.center=new THREE.Vector2(m,n),n+=3*this.deltaY,this.shapes.push(r),this.model.push(q),this.byNameModel["v"+o+"_"+p]=q}this.rotated?(n=o%2===0?b+3*this.hexRadius/2:b,m+=this.deltaX):(m=p%2===0?a+3*this.hexRadius/2:a,n+=this.deltaY)}this.shapeGeometry=new THREE.ShapeGeometry(this.shapes)},VOne.HexGrid.prototype.constructor=VOne.HexGrid,VOne.HexGrid.prototype.generateBufferGeometries=function(a){for(var b=a||0,c=this.shapeGeometry.faces.length,d=new Float32Array(9*c),e=new Float32Array(9*c),f=0;c>f;f++){var g=this.shapeGeometry.faces[f];d[9*f]=this.shapeGeometry.vertices[g.a].x,d[9*f+1]=this.shapeGeometry.vertices[g.a].y,d[9*f+2]=b,d[9*f+3]=this.shapeGeometry.vertices[g.b].x,d[9*f+4]=this.shapeGeometry.vertices[g.b].y,d[9*f+5]=b,d[9*f+6]=this.shapeGeometry.vertices[g.c].x,d[9*f+7]=this.shapeGeometry.vertices[g.c].y,d[9*f+8]=b,e[9*f]=g.normal.x,e[9*f+1]=g.normal.y,e[9*f+2]=g.normal.z,e[9*f+3]=g.normal.x,e[9*f+4]=g.normal.y,e[9*f+5]=g.normal.z,e[9*f+6]=g.normal.x,e[9*f+7]=g.normal.y,e[9*f+8]=g.normal.z}return this.bufferGeometry=new THREE.BufferGeometry,this.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(d,3)),this.bufferGeometry.addAttribute("normal",new THREE.BufferAttribute(e,3)),this.pointsCount=d.length,this.bufferGeometryModel=new VOne.BufferGeometryModel(this.model),this.bufferGeometryModel.setGeometry(this.bufferGeometry),this.bufferGeometryModel.setPositionArray(d),this},VOne.HexGrid.prototype.setGeometriesColor=function(a){var b=this.model.length;if("function"==typeof a)for(var c=0;b>c;c++)this.model[c].color=a(this.model[c]);else{if(!(a instanceof THREE.Color))return console.error("No valid color provided for HexGrid."),-1;for(var c=0;b>c;c++)this.model[c].color=a}for(var d=this.shapeGeometry.faces.length,e=new Float32Array(9*d),f=d/b,c=0;d>c;c++){var g=Math.floor(c/f);e[9*c]=this.model[g].color.r,e[9*c+1]=this.model[g].color.g,e[9*c+2]=this.model[g].color.b,e[9*c+3]=this.model[g].color.r,e[9*c+4]=this.model[g].color.g,e[9*c+5]=this.model[g].color.b,e[9*c+6]=this.model[g].color.r,e[9*c+7]=this.model[g].color.g,e[9*c+8]=this.model[g].color.b}return this.bufferGeometry.addAttribute("color",new THREE.BufferAttribute(e,3)),this.bufferGeometryModel.setColorArray(e),this},VOne.HexGrid.prototype.setGeometriesAlpha=function(a){var b=this.model.length;if("function"==typeof a)for(var c=0;b>c;c++)this.model[c].alpha=a(this.model[c]);else{if("number"!=typeof a)return console.error("No valid alpha provided for HexGrid."),-1;for(var c=0;b>c;c++)this.model[c].alpha=a}for(var d=this.shapeGeometry.faces.length,e=new Float32Array(3*d),f=d/b,c=0;d>c;c++){var g=Math.floor(c/f);e[3*c]=this.model[g].alpha,e[3*c+1]=this.model[g].alpha,e[3*c+2]=this.model[g].alpha}return this.bufferGeometry.addAttribute("alpha",new THREE.BufferAttribute(e,1)),this.bufferGeometryModel.setAlphaArray(e),this},VOne.HexGrid.prototype.generateEdgesGeometry=function(a){for(var b=a||0,c=this.shapes.length,d=new Float32Array(36*c),e=0;c>e;e++)for(var f=this.shapes[e],g=0;6>g;g++)d[36*e+6*g]=f.actions[g].args[0],d[36*e+6*g+1]=f.actions[g].args[1],d[36*e+6*g+2]=b,d[36*e+6*g+3]=f.actions[g+1].args[0],d[36*e+6*g+4]=f.actions[g+1].args[1],d[36*e+6*g+5]=b;return this.edgesBufferGeometry=new THREE.BufferGeometry,this.edgesBufferGeometry.addAttribute("position",new THREE.BufferAttribute(d,3)),this.edgesBufferGeometry},VOne.HexGrid.prototype.whereIs=function(a,b){var c=(new THREE.Vector2(a,b),void 0),d=this.hexRadius,e=this.startX<this.endX?this.startX:this.endX,f=this.startY<this.endY?this.startY:this.endY,g=this.endX<this.endX?this.endX:this.endX,h=this.endY<this.endY?this.endY:this.endY;if(e>a||a>g||f>b||b>h)return!1;var i=this.rotated?this.lengthY/(this.hexRadius+2*this.deltaY):this.lengthY/this.deltaY,j=this.rotated?this.lengthX/this.deltaX:this.lengthX/(this.hexRadius+deltaX),k=Math.floor((a-e)/this.lengthX*j),l=Math.floor((b-f)/this.lengthY*i);c=this.byNameModel["v"+k+"_"+l],d=c.center.distanceTo(new THREE.Vector2(a,b));for(var m=k-1;k+1>=m;m++)for(var n=l-1;l+1>=n;n++){var o=this.byNameModel["v"+m+"_"+n];if(o){var p=o.center.distanceTo(new THREE.Vector2(a,b));d>p&&(c=this.byNameModel["v"+m+"_"+n])}}return c};