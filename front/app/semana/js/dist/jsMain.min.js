/*! Geckode_Consumo_Electrico 2017-03-24 - Property of Geckode LCC */
function InitSVG(){$("#svgMain").css("width",2*config.radioExterior+100).css("height",2*config.radioExterior+100),d3.select("#svgMain").append("svg").attr("id","containerSCG").attr("width",2*config.radioExterior+100).attr("height",2*config.radioExterior+100),svgMain=d3.select("#svgMain").append("g").attr("transform","translate(50,50)"),init()}function DibujaElementosSVG(){svgMain.append("circle").attr("r",config.radioExterior+20).attr("cx",config.radioExterior).attr("cy",config.radioExterior).style("opacity",.3).style("fill","black");var a=svgMain.append("circle").attr("r",config.radioInterior-26).attr("cx",config.radioExterior).attr("cy",config.radioExterior).style("stroke","#1C9CAD").style("fill","none").style("stroke-width",13).style("stroke-opacity",.4);svgMain.append("circle").attr("r",config.radioInterior-20).attr("cx",config.radioExterior).attr("cy",config.radioExterior).style("stroke","#1C9CAD").style("fill","none").style("stroke-width",3).style("stroke-opacity",.7),svgMain.append("circle").attr("r",config.radioInterior-45).attr("cx",config.radioExterior).attr("cy",config.radioExterior).style("stroke","#CCCCCC").style("fill","none").style("stroke-width",65).style("stroke-opacity",.1);for(var a=svgMain.append("circle").attr("r",config.radioExterior-10).attr("cx",config.radioExterior).attr("cy",config.radioExterior).style("stroke","#1C9CAD").style("fill","none").style("stroke-width",4).style("stroke-opacity",.8),b=(d3.scale.linear().domain([minimoValorIngreso,maximoValorIngreso]).range(["#608E8F","00FBFF"]),d3.scale.linear().domain([minimoValorGasto,maximoValorGasto]).range(["#E6561E","FFD900"]),d3.scale.linear().domain([minimoGeneral,maximoGeneral]).range([5,60]),d3.scale.linear().domain([0,maximoCategoria]).range([1,20]),d3.scale.linear().domain([1e3,maximoCategoria]).range(["#44349E","#00FBFF"])),c=d3.scale.linear().domain([1,maximoCategoria]).range(["#E6561E","#FFD900"]),d=d3.scale.linear().domain([0,maximoCategoria]).range([1,10]),e=d3.scale.linear().domain([0,maximoSubCategoria]).range([5,180]),f=d3.scale.linear().domain([minimoGeneral,maximoGeneral]).range([5,60]),g=d3.scale.linear().domain([minimoGeneral,maximoGeneral]).range([60,config.maximaAltura]),h=d3.scale.linear().domain([minimoGeneral,maximoGeneral]).range([3,35]),i=0;i<dataNested.length;i++){if("Ingressos"==dataNested[i].key){console.log("Ingressos");var j="Ingressos";dataNested[i].anguloInicial=0,dataNested[i].anguloFinal=Math.round(357*(totalIngresos/(totalIngresos+totalGastos)))}else{console.log("gastos");var j="Despeses";dataNested[i].anguloInicial=Math.round(357*(totalIngresos/(totalIngresos+totalGastos)))+1,dataNested[i].anguloFinal=Math.round(dataNested[i].anguloInicial+357*(totalGastos/(totalIngresos+totalGastos)))-1}for(var k=(dataNested[i].anguloFinal-dataNested[i].anguloInicial)/dataNested[i].total,l=dataNested[i].anguloInicial,m=0;m<dataNested[i].values.length;m++){var n=CreaCoordenada(l,config.radioInterior,{x:config.radioExterior,y:config.radioExterior}),o=CreaCoordenada(l,.98*config.radioExterior,{x:config.radioExterior,y:config.radioExterior});if("Ingressos"==dataNested[i].key)var p=b(dataNested[i].values[m].total);else var p=c(dataNested[i].values[m].total);svgMain.append("line").attr("x1",n.x).attr("y1",n.y).attr("x2",o.x).attr("y2",o.y).style("stroke",p).style("stroke-width",Math.round(d(dataNested[i].values[m].total))).style("stroke-opacity",1);var q=.96*config.radioExterior,r=d3.svg.line.radial().interpolate(arcInterpolator(q)).tension(2).radius(q).angle(function(a,b){return a*degreeToRadians}),s=1,t=[l,l+k*dataNested[i].values[m].total];svgMain.append("path").datum(t).attr("class","aro").style("opacity",s).style("stroke-width",function(a){return this.prefijo=j,this.nombre=dataNested[i].values[m].key,this.colorLinea=p,this.total=dataNested[i].values[m].total,$(".tooltip").css("position","fixed"),$(".tooltip").css("z-index",900),50}).on("mouseover",function(a){d3.select(this).style("stroke","white"),$("#toolTip").css("visibility","visible"),$("#toolTip").css("left",mouse_x+20+"px"),$("#toolTip").css("top",mouse_y+"px");var b="<span style='color:white'>"+this.prefijo+"<br>"+this.nombre+"<br>"+formatNumber(this.total)+" M €";return $("#toolTip").html(b),a}).on("mouseout",function(a){return $("#toolTip").css("visibility","hidden"),d3.select(this).style("stroke",function(a){return this.colorLinea}),a}).attr("transform","translate("+String(config.radioExterior)+", "+String(config.radioExterior)+")").style("stroke",p).style("fill","none").attr("d",r);var r=d3.svg.line.radial().interpolate(arcInterpolator(config.radioInterior)).tension(2).radius(config.radioInterior).angle(function(a,b){return a*degreeToRadians});svgMain.append("path").datum(t).attr("class","aro").style("opacity",s).style("stroke-width",function(a){return this.prefijo=j,this.nombre=dataNested[i].values[m].key,this.colorLinea=p,this.total=dataNested[i].values[m].total,$(".tooltip").css("position","fixed"),$(".tooltip").css("z-index",900),10}).on("mouseover",function(a){d3.select(this).style("stroke","white"),$("#toolTip").css("visibility","visible"),$("#toolTip").css("left",mouse_x+20+"px"),$("#toolTip").css("top",mouse_y+"px");var b="<span style='color:white'>"+this.prefijo+"<br>"+this.nombre+"<br>"+formatNumber(this.total)+" M €";return $("#toolTip").html(b),a}).on("mouseout",function(a){return $("#toolTip").css("visibility","hidden"),d3.select(this).style("stroke",function(a){return this.colorLinea}),a}).attr("transform","translate("+String(config.radioExterior)+", "+String(config.radioExterior)+")").style("stroke",p).style("fill","none").attr("d",r);for(var u=(config.radioExterior-config.radioInterior)/dataNested[i].values[m].total,v=0;v<dataNested[i].values[m].values.length;v++){var w=config.radioInterior+u*dataNested[i].values[m].values[v].total,x=l+(l+k*dataNested[i].values[m].total-l)/2,y=CreaCoordenada(x,w,{x:config.radioExterior,y:config.radioExterior});svgMain.append("circle").attr("r",e(dataNested[i].values[m].values[v].total)).attr("cx",y.x).attr("cy",y.y).style("stroke","none").style("fill",function(){return this.prefijo=j,this.nombre=dataNested[i].values[m].values[v].key,this.colorLinea=p,this.total=dataNested[i].values[m].values[v].total,$(".tooltip").css("position","fixed"),$(".tooltip").css("z-index",900),p}).style("fill-opacity",.2).on("mouseover",function(a){d3.select(this).style("fill","white"),$("#toolTip").css("visibility","visible"),$("#toolTip").css("left",mouse_x+20+"px"),$("#toolTip").css("top",mouse_y+"px");var b="<span style='color:white'>"+this.prefijo+"<br>"+this.nombre+"<br>"+formatNumber(this.total)+" M €";return $("#toolTip").html(b),a}).on("mouseout",function(a){return $("#toolTip").css("visibility","hidden"),d3.select(this).style("fill",function(a){return this.colorLinea}),a});for(var z=0;z<dataNested[i].values[m].values[v].values.length;z++){var A=p.replace("#",""),B=new THREE.LineBasicMaterial({color:Number("0x"+A),transparent:!0,opacity:.5}),C=new THREE.Geometry;C.vertices.push(new THREE.Vector3(0,0,0)),C.vertices.push(new THREE.Vector3(0,g(dataNested[i].values[m].values[v].values[z].monto),0));var r=new THREE.Line(C,B);sceneGL.add(r);var C=new THREE.SphereGeometry(h(dataNested[i].values[m].values[v].values[z].monto),20,20,0,2*Math.PI,0,2*Math.PI),B=new THREE.MeshBasicMaterial({color:Number("0x"+A)}),D=new THREE.Mesh(C,B);D.data=dataNested[i].values[m].values[v].values[z],D.color=p,D.position.y=g(dataNested[i].values[m].values[v].values[z].monto),sceneGL.add(D),coleccionObjetosSeleccionables.push(D);var E=CreaCoordenada(x,getRandomInt(config.radioInterior,config.radioExterior),{x:config.radioExterior,y:config.radioExterior});nodes.push({radius:f(dataNested[i].values[m].values[v].values[z].monto),cx:y.x,cy:y.y,x:E.x,y:E.y,origenX:y.x,origenY:y.y,line:r,esfera:D,color:p,prefijo:j,nombre:dataNested[i].values[m].values[v].values[z].descripcion,total:dataNested[i].values[m].values[v].values[z].monto,line3D:r,esfera:D,svg:a})}}l+=k*dataNested[i].values[m].total}}force=d3.layout.force().nodes(nodes).size([windowWidth,windowHeight]).gravity(0).charge(-19).friction(.3).on("tick",tick).start(),circulos=svgMain.selectAll(".circulos").data(nodes).enter().append("circle").attr("class","circulos").attr("r",function(a){return f(a.total)}).attr("cx",function(a){return a.cx}).attr("cy",function(a){return a.cy}).style("stroke","black").style("stroke-width",.5).style("stroke-opacity",.7).style("fill",function(a){return this.prefijo=a.prefijo,this.r=f(a.total),this.nombre=a.nombre,this.colorLinea=a.color,this.total=a.total,a.DOM=this,$(".tooltip").css("position","fixed"),$(".tooltip").css("z-index",900),a.color}).style("fill-opacity",1).on("mouseover",function(a){d3.select(this).style("fill","white"),$("#toolTip").css("visibility","visible"),$("#toolTip").css("left",mouse_x+20+"px"),$("#toolTip").css("top",mouse_y+"px");var b="<span style='color:white'>"+this.prefijo+"<br>"+this.nombre+"<br>"+formatNumber(this.total)+" M €";return $("#toolTip").html(b),a}).on("mouseout",function(a){return $("#toolTip").css("visibility","hidden"),d3.select(this).style("fill",function(a){return this.colorLinea}),a}),setInterval(function(){ActualizaPosiciones()},4e3)}function SimulaBusqueda(){if(busquedaEnCurso=!busquedaEnCurso,elementoBuscado){d3.select(elementoBuscado.DOM).style("fill",elementoBuscado.DOM.colorLinea).attr("r",elementoBuscado.radius);var a=new THREE.MeshBasicMaterial({color:elementoBuscado.color_hex});elementoBuscado.esfera.material=a;var a=new THREE.LineBasicMaterial({color:elementoBuscado.color_hex});elementoBuscado.line.material=a,elementoBuscado=void 0}if(busquedaEnCurso){$("#busqueda").addClass("seleccionado"),$("#busqueda_2").addClass("seleccionado"),elementoBuscado=nodes[getRandomInt(0,nodes.length-1)],elementoResaltadoInterval=setInterval(function(){d3.select(elementoBuscado.DOM).style("fill","white").style("fill-opacity",1).attr("r",0).transition().duration(1200).style("fill-opacity",0).attr("r",250)},2e3);var a=new THREE.MeshBasicMaterial({color:16777215});elementoBuscado.esfera.material=a;var a=new THREE.LineBasicMaterial({color:16777215});elementoBuscado.line.material=a}else $("#busqueda").removeClass("seleccionado"),$("#busqueda_2").removeClass("seleccionado"),clearInterval(elementoResaltadoInterval)}function onDocumentMouseDown(a){a.preventDefault(),mouse.x=a.clientX/window.innerWidth*2-1,mouse.y=2*-(a.clientY/window.innerHeight)+1,raycaster.setFromCamera(mouse,camera);var b=raycaster.intersectObjects(coleccionObjetosSeleccionables);if(b.length>0){$("#fotos").css("visibility","visible"),$("#fotos").css("left",mouse_x-290+"px"),$("#fotos").css("top",mouse_y+"px");var c=[getRandomInt(0,10),getRandomInt(0,10),getRandomInt(0,10)];document.getElementById("aro").contentWindow.graficaSVG||document.getElementById("aro").contentWindow.Inicializa(500),$("#aro")[0].contentWindow.RenderActualiza(c),$("#aro").css("visibility","visible"),$("#aro").css("left",mouse_x+"px"),$("#aro").css("top",String(mouse_y+12)+"px"),$("#aro")[0].contentWindow.AdjustSize(80,80,40),$("#barras")[0].contentWindow.goto(),$("#barras").css("left",mouse_x+140+"px"),$("#barras").css("visibility","visible"),$("#barras").css("top",mouse_y-100+"px"),$("#svgGraficaFrontal").css("opacity",.1)}else $("#aro").css("visibility","hidden"),$("#fotos").css("visibility","hidden"),$("#barras").css("visibility","hidden"),$("#svgGraficaFrontal").css("opacity",1)}function onDocumentMouseMove(a){a.preventDefault(),mouse.x=a.clientX/window.innerWidth*2-1,mouse.y=2*-(a.clientY/window.innerHeight)+1,raycaster.setFromCamera(mouse,camera);var b=raycaster.intersectObjects(coleccionObjetosSeleccionables);if(b.length>0){if(modoSeleccionaSVG=!1,$("#svgGraficaFrontal").css("z-index",-2),ultimoSeleccionado){var c=new THREE.MeshBasicMaterial({color:ultimoSeleccionado.color});ultimoSeleccionado.material=c}if(b[0].object){$("#toolTip").css("visibility","visible"),$("#toolTip").css("left",mouse_x+20+"px"),$("#toolTip").css("top",mouse_y-60+"px");var d="<span style='color:white'>"+b[0].object.data.tipo+"<br>"+b[0].object.data.descripcion+"<br>"+formatNumber(b[0].object.data.monto)+" M €";$("#toolTip").html(d);var c=new THREE.MeshBasicMaterial({color:16777215});b[0].object.material=c,ultimoSeleccionado=b[0].object}}else{if(modoSeleccionaSVG=!0,$("#svgGraficaFrontal").css("z-index",4),ultimoSeleccionado){var c=new THREE.MeshBasicMaterial({color:ultimoSeleccionado.color});ultimoSeleccionado.material=c}modoSeleccionaSVG||$("#toolTip").css("visibility","hidden")}}function ActualizaPosiciones(){for(var a=0;a<nodes.length;a++)nodes[a].cx=nodes[a].origenX+getRandomInt(-65,55),nodes[a].cy=nodes[a].origenY+getRandomInt(-65,55);force.start()}function tick(a){circulos.each(gravity(.2*a.alpha)).each(collide(.5)).attr("cx",function(a){return a.line3D&&(a.line3D.position.set(a.x-config.radioExterior,0,a.y-config.radioExterior),a.esfera.position.x=a.x-config.radioExterior,a.esfera.position.z=a.y-config.radioExterior),a.x}).attr("cy",function(a){return a.y})}function gravity(a){return function(b){b.y+=(b.cy-b.y)*a,b.x+=(b.cx-b.x)*a}}function collide(a){var b=d3.geom.quadtree(nodes);return function(c){if(!permiteCoalicion){var d=c.radius+maxRadius+padding,e=c.x-d,f=c.x+d,g=c.y-d,h=c.y+d;b.visit(function(b,d,i,j,k){if(b.point&&b.point!==c){var l=c.x-b.point.x,m=c.y-b.point.y,n=Math.sqrt(l*l+m*m),o=c.radius+b.point.radius+(c.color!==b.point.color)*padding;n<o&&(n=(n-o)/n*a,c.x-=l*=n,c.y-=m*=n,b.point.x+=l,b.point.y+=m)}return d>f||j<e||i>h||k<g})}}}function Consulta(){d3.csv("docs/balance.csv").row(function(a){return a}).get(function(a,b){console.log("rows",b);for(var c=0;c<b.length;c++)b[c].monto=Number(b[c].monto.replaceAll(",","").replaceAll("€","")),b[c].monto=Math.round(b[c].monto/1e3),"Ingressos"==b[c].tipo?(totalIngresos+=Number(b[c].monto),maximoValorIngreso<b[c].monto&&(maximoValorIngreso=b[c].monto),minimoValorIngreso>b[c].monto&&(minimoValorIngreso=b[c].monto)):(totalGastos+=Number(b[c].monto),maximoValorGasto<b[c].monto&&(maximoValorGasto=b[c].monto),minimoValorGasto>b[c].monto&&(minimoValorGasto=b[c].monto)),maximoGeneral<b[c].monto&&(maximoGeneral=b[c].monto),minimoGeneral>b[c].monto&&(minimoGeneral=b[c].monto);Rows=b,dataNested=d3.nest().key(function(a){return a.tipo}).key(function(a){return a.categoria}).key(function(a){return a.subcategoria}).entries(b);for(var c=0;c<dataNested.length;c++){dataNested[c].total=0;for(var d=0;d<dataNested[c].values.length;d++){dataNested[c].values[d].total=0;for(var e=0;e<dataNested[c].values[d].values.length;e++){dataNested[c].values[d].values[e].total=0;for(var f=0;f<dataNested[c].values[d].values[e].values.length;f++)dataNested[c].total+=dataNested[c].values[d].values[e].values[f].monto,dataNested[c].values[d].total+=dataNested[c].values[d].values[e].values[f].monto,dataNested[c].values[d].values[e].total+=dataNested[c].values[d].values[e].values[f].monto;maximoSubCategoria<dataNested[c].values[d].values[e].total&&(maximoSubCategoria=dataNested[c].values[d].values[e].total)}dataNested[c].values[d].values.sort(function(a,b){return b.total-a.total}),maximoCategoria<dataNested[c].values[d].total&&(maximoCategoria=dataNested[c].values[d].total)}dataNested[c].values.sort(function(a,b){return b.total-a.total})}$("#ingresos").html(formatNumber(totalIngresos)+" M €"),$("#gastos").html(formatNumber(totalGastos)+" M €"),DibujaElementosSVG()})}function FiltraDatos(){EliminaParticulas(),dataGraph=[];for(var a=0;a<dataRaw.length;a++)dataRaw[a].unixTime>=fechaInicial.getTime()&&dataRaw[a].unixTime<=fechaFinal.getTime()&&dataGraph.push(dataRaw[a]);DibujaParticulas(),DibujaElementosSVG(),DibujaParticulasIndicadores()}function SeleccionaRangoFechas(a){switch(lapsoDeTiempoSeleccionado=a,a){case 1:$("#dia_btn").css("color","yellow"),$("#semana_btn").css("color","gray"),$("#mes_btn").css("color","gray"),$("#anio_btn").css("color","gray"),etiquetaTiempo="Llamadas de las Ultimas Horas";break;case 7:$("#dia_btn").css("color","gray"),$("#semana_btn").css("color","yellow"),$("#mes_btn").css("color","gray"),$("#anio_btn").css("color","gray"),etiquetaTiempo="Llamadas de la Semana";break;case 30:$("#dia_btn").css("color","gray"),$("#semana_btn").css("color","gray"),$("#mes_btn").css("color","yellow"),$("#anio_btn").css("color","gray"),etiquetaTiempo="Llamadas del Mes";break;case 365:$("#dia_btn").css("color","gray"),$("#semana_btn").css("color","gray"),$("#mes_btn").css("color","gray"),$("#anio_btn").css("color","yellow"),etiquetaTiempo="Llamadas del Año"}$("#etiquetaTiempo").html(etiquetaTiempo),ConsultaDatosPrincipalesMpos()}function round_dec(a){return Math.round(10*a)/10}function toScreenPosition(a,b){var c=new THREE.Vector3,d=.5*windowWidth,e=.5*windowHeight;return a.updateMatrixWorld(),c.setFromMatrixPosition(a.matrixWorld),c.project(b),c.x=c.x*d+d,c.y=-(c.y*e)+e,{x:c.x,y:c.y}}function isFullScreen(){return Math.abs(screen.width-window.innerWidth)<10}function fullScreen(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;if("undefined"!=typeof b&&b)b.call(a);else if("undefined"!=typeof window.ActiveXObject){var c=new ActiveXObject("WScript.Shell");null!=c&&c.SendKeys("{F11}")}}function latLng2Point(a,b){var c=b.getProjection().fromLatLngToPoint(b.getBounds().getNorthEast()),d=b.getProjection().fromLatLngToPoint(b.getBounds().getSouthWest()),e=Math.pow(2,b.getZoom()),f=b.getProjection().fromLatLngToPoint(a);return new google.maps.Point((f.x-d.x)*e,(f.y-c.y)*e)}function point2LatLng(a,b){var c=b.getProjection().fromLatLngToPoint(b.getBounds().getNorthEast()),d=b.getProjection().fromLatLngToPoint(b.getBounds().getSouthWest()),e=Math.pow(2,b.getZoom()),f=new google.maps.Point(a.x/e+d.x,a.y/e+c.y);return b.getProjection().fromPointToLatLng(f)}function distanciaGeodesica(a,b,c,d){var e=.01745329,f=57.29577951,g=b-d,h=Math.sin(a*e)*Math.sin(c*e)+Math.cos(a*e)*Math.cos(c*e)*Math.cos(g*e),i=Math.acos(h)*f,j=111.302*i;return j}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16),a:1}:null}function polygonCenter(a){for(var b,c,d,e,f=[],g=[],h=a.getPath(),i=0;i<h.length;i++)g.push(h.getAt(i).lng()),f.push(h.getAt(i).lat());return f.sort(),g.sort(),b=f[0],c=f[h.length-1],d=g[0],e=g[h.length-1],center_x=b+(c-b)/2,center_y=d+(e-d)/2,new google.maps.LatLng(center_x,center_y)}function arcInterpolator(a){return function(b){var c,d=[];return b.forEach(function(b,e){var f,g=Math.atan2(b[0],b[1]);f=e?["A",a,a,0,+(Math.abs(g-c)>Math.PI),+(g<c),b[0],b[1]]:b,c=g,d.push(f.join(" "))}),d.join(" ")}}function CreaCoordenada(a,b,c){"undefined"==typeof c&&(c=centroide);var d=(a-90)*(Math.PI/180),e=new Object;return e.x=0+b*Math.cos(d)+c.x,e.y=0+b*Math.sin(d)+c.y,e}function getDia(a){switch(a){case 0:return"Dom";case 1:return"Lun";case 2:return"Mar";case 3:return"Mie";case 4:return"Jue";case 5:return"Vie";case 6:return"Sab"}}function getMes(a){switch(a){case 0:return"Ene";case 1:return"Feb";case 2:return"Mar";case 3:return"Abr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Ago";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dic"}}function toTitleCase(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}function getPointerLocation(a){var b=Math.pow(2,mapa_.getZoom()),c=new google.maps.LatLng(mapa_.getBounds().getNorthEast().lat(),mapa_.getBounds().getSouthWest().lng()),d=mapa_.getProjection().fromLatLngToPoint(c),e=mapa_.getProjection().fromLatLngToPoint(a),f=new google.maps.Point(Math.floor((e.x-d.x)*b),Math.floor((e.y-d.y)*b));return f}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function GetValorRangos(a,b,c,d,e){var f=(e-d)/(c-b),g=d-f*b,h=f*a+g;return h}function formatNumber(a){try{a=a.toFixed(2)+"",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1}catch(a){}}function utmToLatLng(a,b,c,d){d||(c=1e7-c);var e=6378137,f=.081819191,g=.006739497,h=.9996,i=c/h,j=i/(e*(1-Math.pow(f,2)/4-3*Math.pow(f,4)/64-5*Math.pow(f,6)/256)),k=(1-Math.pow(1-f*f,.5))/(1+Math.pow(1-f*f,.5)),l=3*k/2-27*Math.pow(k,3)/32,m=21*Math.pow(k,2)/16-55*Math.pow(k,4)/32,n=151*Math.pow(k,3)/96,o=1097*Math.pow(k,4)/512,p=j+l*Math.sin(2*j)+m*Math.sin(4*j)+n*Math.sin(6*j)+o*Math.sin(8*j),q=e/Math.pow(1-Math.pow(f*Math.sin(p),2),.5),r=e*(1-f*f)/Math.pow(1-Math.pow(f*Math.sin(p),2),1.5),s=q*Math.tan(p)/r,t=5e5-b,u=t/(q*h),v=u*u/2,w=Math.pow(Math.tan(p),2),x=g*Math.pow(Math.cos(p),2),y=(5+3*w+10*x-4*x*x-9*g)*Math.pow(u,4)/24,z=(61+90*w+298*x+45*w*w-252*g-3*x*x)*Math.pow(u,6)/720,A=t/(q*h),B=(1+2*w+x)*Math.pow(u,3)/6,C=(5-2*x+28*w-3*Math.pow(x,2)+8*g+24*Math.pow(w,2))*Math.pow(u,5)/120,D=(A-B+C)/Math.cos(p),E=180*D/Math.PI,F=180*(p-s*(v+y+z))/Math.PI;d||(F=-F);var G=(a>0&&6*a-183||3)-E,H={latitude:F,longitude:G};return H}function CalcularGrados(a,b,c){PintaPoligonosTemporales(String(a+","+b),120,16711680,1,"poligonoN1"),PintaPoligonosTemporales(String(a+","+b),1200,16711680,.5,"poligonoN0")}function PintaPoligonosTemporales(a,b,c,d,e){var f=CalculaCoordenadas(a,b);CoordsPoligono=new Array;var g=new Array,h=new google.maps.LatLng(f.Y1,f.X1);g.push(h);var h=new google.maps.LatLng(f.Y1,f.X2);g.push(h);var h=new google.maps.LatLng(f.Y2,f.X2);g.push(h);var h=new google.maps.LatLng(f.Y2,f.X1);g.push(h);var h=new google.maps.LatLng(f.Y1,f.X1);g.push(h),poligonos[e]&&poligonos[e].setMap(null);var i=0;"poligonoN0"==e&&coleccionN0[f.Y1+","+f.X1]&&"poligonoN0"==e&&(i=GetValorRangos(coleccionN0[f.Y1+","+f.X1].valor,1,maximaCantidadN0,1,10)/10,d=0);var j=.6;coleccionN1[f.Y1+","+f.X1]&&"poligonoN1"==e&&(j=GetValorRangos(coleccionN1[f.Y1+","+f.X1].valor,1,maximaCantidadN1,1,30)/10,d=GetValorRangos(coleccionN1[f.Y1+","+f.X1].valor,1,maximaCantidadN1,2,10)/10),poligonos[e]=new google.maps.Polygon({paths:g,strokeColor:c,strokeOpacity:d,strokeWeight:j,fillColor:"red",fillOpacity:i}),poligonos[e].setMap(mapa_)}function DibujaTodosN1(){for(var a in coleccionN1){var b=coleccionN1[a].coordenadas;CoordsPoligono=new Array;var c=new Array,d=new google.maps.LatLng(b.Y1,b.X1);c.push(d);var d=new google.maps.LatLng(b.Y1,b.X2);c.push(d);var d=new google.maps.LatLng(b.Y2,b.X2);c.push(d);var d=new google.maps.LatLng(b.Y2,b.X1);c.push(d);var d=new google.maps.LatLng(b.Y1,b.X1);c.push(d);var e=GetValorRangos(coleccionN1[b.Y1+","+b.X1].valor,1,maximaCantidadN1,0,5)/10;TodosN1Dibujados.push(new google.maps.Polygon({paths:c,strokeOpacity:0,strokeWeight:0,fillColor:"red",fillOpacity:e})),TodosN1Dibujados[TodosN1Dibujados.length-1].setMap(mapa_)}for(var a in coleccionN0){var b=coleccionN0[a].coordenadas;CoordsPoligono=new Array;var c=new Array,d=new google.maps.LatLng(b.Y1,b.X1);c.push(d);var d=new google.maps.LatLng(b.Y1,b.X2);c.push(d);var d=new google.maps.LatLng(b.Y2,b.X2);c.push(d);var d=new google.maps.LatLng(b.Y2,b.X1);c.push(d);var d=new google.maps.LatLng(b.Y1,b.X1);c.push(d);var e=GetValorRangos(coleccionN0[b.Y1+","+b.X1].valor,1,maximaCantidadN0,0,30)/10;TodosN0Dibujados.push(new google.maps.Polygon({paths:c,strokeOpacity:0,strokeWeight:0,fillColor:"red",fillOpacity:e})),TodosN0Dibujados[TodosN0Dibujados.length-1].setMap(mapa_)}}function limpiaCaracteresEspeciales(a){return a=a.replaceAll("á","a"),a=a.replaceAll("é","e"),a=a.replaceAll("í","i"),a=a.replaceAll("ó","o"),a=a.replaceAll("ú","u"),a=a.replaceAll("ñ","n"),a=a.replaceAll(" ","")}function EliminaTodosN(){for(var a=0;a<TodosN1Dibujados.length;a++)TodosN1Dibujados[a].setMap(null);TodosN1Dibujados=[];for(var a=0;a<TodosN0Dibujados.length;a++)TodosN0Dibujados[a].setMap(null);TodosN0Dibujados=[]}function ObtieneNombres(a,b){var c=CalculaCoordenadas(String(a+","+b),120),d=CalculaCoordenadas(String(a+","+b),1200);return{n0:{Y1:d.Y1,X1:d.X1,Y2:d.Y2,X2:d.X2},n1:{Y1:c.Y1,X1:c.X1,Y2:c.Y2,X2:c.X2}}}function CalculaCoordenadas(a,b){var c=a.split(","),a=c[1],d=a.split("."),e=new Array;return XXEntero=d[0],Xdecimales=Number("."+d[1]),Xdecimales/=1/b,d=Xdecimales.toString().split("."),X1=Number(d[0]),X2=(X1+1)*(1/b),X1*=1/b,X1>=0?XXEntero>=0?X1=XXEntero+X1:X1=XXEntero-X1:X1=Number(XXEntero+X1.toString().substr(1)),X2>=0?XXEntero>0?X2=XXEntero+X2:X2=XXEntero-X2:X2=Number(XXEntero+X2.toString().substr(1)),"-0"==c[1].toString().split(".")[0]&&(X1*=-1),"0"==c[1].toString().split(".")[0]&&(X2*=-1),a=c[0],e=a.split("."),YYEntero=e[0],Ydecimales=Number("."+e[1]),Ydecimales/=1/b,e=Ydecimales.toString().split("."),Y1=Number(e[0]),Y2=(Y1+1)*(1/b),Y1*=1/b,Y1>=0?YYEntero>=0?Y1=Number(YYEntero)+Number(Y1):Y1=Number(YYEntero)-Number(Y1):Y1=Number(Number(YYEntero)+Number(Y1.toString().substr(1))),Y2>=1?YYEntero>=0?Y2=Number(YYEntero)+Number(Y2):Y2=Number(Number(YYEntero)+Number(Y2.toString().substr(1))):Y2=Number(YYEntero+Y2.toString().substr(1)),"-0"==c[0].toString().split(".")[0]&&(Y1*=-1,Y2*=-1),{Y1:Y1,X1:X1,Y2:Y2,X2:X2}}function init(){var a=new VOne.SceneCreator;sceneCSS3D=a.createScene({bgColor:"#00FF00",bgAlpha:0,glRenderer:THREE.CSS3DRenderer,width:windowWidth,height:windowHeight,controls:THREE.OrbitControls,parentType:"div",containerId:"svgGraficaFrontal",verticalDegFOV:60}),sceneGL=a.createScene({bodyBGColor:2762555,bodyBGAlpha:1,bgColor:"#000000",bgAlpha:.09,useTweenAnimations:!0,glRenderer:THREE.WebGLRenderer,width:windowWidth,height:windowHeight,useControls:sceneCSS3D.controls,camera:sceneCSS3D.camera,parentType:"div",cameraNear:.1,cameraFar:1e8,containerId:"webglContainer",raycastThreshold:10,verticalDegFOV:60}),controls=sceneCSS3D.controls,camera=sceneCSS3D.camera,$("#svgGraficaFrontal").css("position","fixed"),$("#svgGraficaFrontal").css("float","left"),$("#webglContainer").css("z-index",3),$("#svgGraficaFrontal").css("z-index",-2),$("#webglContainer").css("position","fixed"),sceneCSS3D.camera.position.set(0,1300,1500),controls.target.z=0,controls.target.x=0,controls.target.y=-500,graficaFrontal3D=new THREE.CSS3DObject($("#svgMain")[0]),sceneCSS3D.add(graficaFrontal3D),graficaFrontal3D.position.set(0,0,0),graficaFrontal3D.rotation.x=-90*(Math.PI/180),raycaster=new THREE.Raycaster,raycaster.params.PointCloud.threshold=.5,controls.minPolarAngle=0*(Math.PI/180),controls.maxPolarAngle=120*(Math.PI/180),controls.minAzimuthAngle=110*(Math.PI/180),controls.maxAzimuthAngle=120*(Math.PI/180);var b=new THREE.AmbientLight(1118481);sceneGL.add(b);var c=new THREE.DirectionalLight(16777215,.8);c.position.x=500,c.position.y=600,c.position.z=500,c.castShadow=!0,sceneGL.add(c);var c=(new THREE.LineBasicMaterial({color:7039851}),new THREE.DirectionalLight(16777215,.4));c.position.x=-500,c.position.y=400,c.position.z=-500,c.position.normalize(),sceneGL.add(c),c.shadow.camera=!0,c.castShadow=!0,c.shadowDarkness=.5;var c=new THREE.DirectionalLight(16777215,.2);c.position.x=500,c.position.y=-500,c.position.z=500,c.position.normalize(),sceneGL.add(c),c.shadow.camera=!0,c.castShadow=!0,c.shadowDarkness=.5;var c=new THREE.DirectionalLight(16777215,.2);c.position.x=650,c.position.y=650,c.position.z=-800,c.position.normalize(),sceneGL.add(c)}function EliminaBarrasPersonas(){svgMujeres.selectAll(".etiquetaPersonaMujer").data([]).exit().remove(),svgHombres.selectAll(".etiquetaPersonaHombre").data([]).exit().remove(),svgMujeres.selectAll(".barraPersonaMujer").data([]).exit().remove(),svgHombres.selectAll(".barraPersonaHombre").data([]).exit().remove();for(var a=0;a<diasRegistrados.length;a++)diasRegistrados[a].Mujer=0,diasRegistrados[a].Hombre=0}function DibujaBarrasPersonas(){EliminaBarrasPersonas();for(var a={},b=0;b<modeloParaPersonas.length;b++)a["_"+modeloParaPersonas[b].fecha.getTime()]?a["_"+modeloParaPersonas[b].fecha.getTime()]&&(a["_"+modeloParaPersonas[b].fecha.getTime()][String(modeloParaPersonas[b].genero)]+=1):a["_"+modeloParaPersonas[b].fecha.getTime()]={Hombre:0,Mujer:0,fecha:modeloParaPersonas[b].fecha.getTime()},maximoPersonasDeportadasPorDia<a["_"+modeloParaPersonas[b].fecha.getTime()][modeloParaPersonas[b].genero]&&(maximoPersonasDeportadasPorDia=a["_"+modeloParaPersonas[b].fecha.getTime()][modeloParaPersonas[b].genero]);for(var c=windowWidth/diasRegistrados.length,b=0;b<modeloParaPersonas.length;b++)for(var d=0;d<marcasTiempo.length;d++){var e=new Date(marcasTiempo[d].fecha);modeloParaPersonas[b].fecha.getMonth()==e.getMonth()&&modeloParaPersonas[b].fecha.getFullYear()==e.getFullYear()&&(marcasTiempo[d][String(modeloParaPersonas[b].genero)]||0===marcasTiempo[d][String(modeloParaPersonas[b].genero)])&&(marcasTiempo[d][String(modeloParaPersonas[b].genero)]+=1)}var f=(windowWidth/marcasTiempo.length,[]);for(var g in a)f.push(a[g]);svgMujeres.selectAll(".barraPersonaMujer").data(f).enter().append("rect").attr("id","barraPersona").attr("class","barraPersonaMujer").attr("x",function(a,b){return GetValorRangos(a.fecha,minimaFecha,maximaFecha,0,windowWidth)}).attr("y",function(a){return config.profundidadBarrasHombresMujeres-30-GetValorRangos(a.Mujer,0,maximoPersonasDeportadasPorDia,0,config.profundidadBarrasHombresMujeres)}).style("fill","yellow").attr("height",function(a){return GetValorRangos(a.Mujer,0,maximoPersonasDeportadasPorDia,0,config.profundidadBarrasHombresMujeres)}).attr("width",function(a){return c}),svgHombres.selectAll(".barraPersonaHombre").data(f).enter().append("rect").attr("id","barraPersona").attr("class","barraPersonaHombre").attr("x",function(a,b){return GetValorRangos(a.fecha,minimaFecha,maximaFecha,0,windowWidth)}).attr("y",function(a){return config.profundidadBarrasHombresMujeres-30-GetValorRangos(a.Hombre,0,maximoPersonasDeportadasPorDia,0,config.profundidadBarrasHombresMujeres)}).style("fill","#4F76F7").style("opacity",.6).attr("height",function(a){return GetValorRangos(a.Hombre,0,maximoPersonasDeportadasPorDia,0,config.profundidadBarrasHombresMujeres)}).attr("width",function(a){return c}),svgMujeres.selectAll(".etiquetaPersonaMujer").data(marcasTiempo).enter().append("text").attr("id","etiquetaPersonaMujer").attr("class","etiquetaPersonaMujer").attr("x",function(a,b){return GetValorRangos(a.fecha,minimaFecha,maximaFecha,0,windowWidth)}).attr("y",function(a){return config.profundidadBarrasHombresMujeres-10}).style("fill","yellow").style("font-size",11).style("font-family","Coda").style("text-anchor","middle").text(function(a){return 0==Number(a.Mujer)?"":formatNumber(a.Mujer)}),svgHombres.selectAll(".etiquetaPersonaHombre").data(marcasTiempo).enter().append("text").attr("id","etiquetaPersonaHombre").attr("class","etiquetaPersonaHombre").attr("x",function(a,b){return GetValorRangos(a.fecha,minimaFecha,maximaFecha,0,windowWidth)}).attr("y",function(a){return config.profundidadBarrasHombresMujeres-10}).style("fill","#4F76F7").style("font-size",10).style("font-family","Coda").style("text-anchor","middle").text(function(a){return 0==Number(a.Hombre)?"":formatNumber(a.Hombre)})}var svgMain,force,circulos,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,INTERSECTED,coleccionObjetosSeleccionables=[],padding=60,maxRadius=6,nodes=[],lineaVertical,lineaHorizontal,tituloProveedor,tituloObjeto,tituloMonto,objetoAseguirLineas,elementoBuscado,elementoResaltadoInterval,busquedaEnCurso=!1,ultimoSeleccionado=new Object,permiteCoalicion=!1,totalIngresos=0,totalGastos=0,dataNested,maximoValorIngreso=0,minimoValorIngreso=1e11,maximoValorGasto=0,minimoValorGasto=1e11,maximoGeneral=0,minimoGeneral=1e11,maximoCategoria=0,maximoSubCategoria=0,Rows,etiquetaTiempo="",degreeToRadians=Math.PI/180,getUrlParameter=function(a){var b,c,d=decodeURIComponent(window.location.search.substring(1)),e=d.split("&");for(c=0;c<e.length;c++)if(b=e[c].split("="),b[0]===a)return void 0===b[1]||b[1]},rad=function(a){return a*Math.PI/180},getDistance=function(a,b){var c=6378137,d=rad(b.lat()-a.lat()),e=rad(b.lng()-a.lng()),f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(rad(a.lat()))*Math.cos(rad(b.lat()))*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;
return h};Date.prototype.addDays=function(a){return this.setDate(this.getDate()+parseInt(a)),this},Date.prototype.removeDays=function(a){return this.setDate(this.getDate()-parseInt(a)),this},String.prototype.replaceAll=function(a,b){var c=this;return c.replace(new RegExp(a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),b)},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},convertPixels=function(a,b){return overlay.getProjection().fromDivPixelToLatLng(new google.maps.Point(a,b))};var poligonos=new Object;poligonos.poligonoN0,poligonos.poligonoN1;var TodosN1Dibujados=[],TodosN0Dibujados=[],sceneGL,sceneCSS3D,controls,camera,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,lineaSenaladora,svgMujeres,svgHombres,maximoPersonasDeportadasPorDia=0;