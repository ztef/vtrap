/*! VOne 2019-09-02 - Property of Geckode LLC */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var VOne={VERSION:"1.1.1"};function toRadians(e){return e*VOne.degToRad}function loadJSON(e,t){var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.onreadystatechange=function(){4==r.readyState&&"200"==r.status&&t(r.responseText)},r.send(null)}function calculateXYInRadius(e,t){var r=toRadians(e);return{x:Math.cos(r)*t,y:Math.sin(r)*t}}function getAngleInDegreesFromCenter(e){return Math.atan2(e.y,e.x)*VOne.radToDeg}function randomCoordsInRadius(e,t){var r=Math.random(),n=Math.random();if(t&&n<r){var o=n;n=r,r=o}return{x:n*e*Math.cos(2*Math.PI*r/n),y:n*e*Math.sin(2*Math.PI*r/n)}}function nearestPow2(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function randomCoordsInCircle(e,t){e=e||100;var r=Math.random(),n=Math.random();return t&&n<r&&(c=n,n=r,r=c),[n*e*Math.cos(2*Math.PI*r/n),n*e*Math.sin(2*Math.PI*r/n)]}function randomCoordsInSphere(e,t){var r=Math.random(),n=Math.random();t&&n<r&&(w=n,n=r,r=w);var o=VOne.DoublePI*r,i=Math.acos(2*n-1);return[e*Math.sin(i)*Math.cos(o),e*Math.sin(i)*Math.sin(o),e*Math.cos(i)]}Object.assign(VOne,{PositionAnimation:0,ScaleAnimation:1,AlphaAnimation:2,ColorAnimation:3,MeshNameProperty:0,ChildNameProperty:1,MeshClassName:2,degToRad:Math.PI/180,radToDeg:180/Math.PI,SphericalIncrementRatio:3*Math.PI-Math.sqrt(5),GoldenRatio:(Math.sqrt(5)+1)/2-1,HalfPI:Math.PI/2,DoublePI:2*Math.PI,BUBBLE:0,EMITTER:1,ORDER:{ASC:0,DESC:1},OPERATION:{SUM:0,AVG:1,COUNT:2},Utils:{}}),VOne.SceneCreator=function(){this.type="SceneCreator"},VOne.SceneCreator.prototype={constructor:VOne.SceneCreator,createScene:function(e){var t=e||{},o=new THREE.Scene;o.VOneData={};var r=t.width||window.innerWidth,n=t.height||window.innerHeight,i=(window.innerWidth,window.innerHeight,void 0!==t.bgColor?t.bgColor:0),a=void 0!==t.bgAlpha?t.bgAlpha:1,s=t.parentType||"window",l=t.glRenderer||THREE.WebGLRenderer,h=t.verticalDegFOV||45,c=t.verticalVisibleUnits||2e4,d=t.controls||void 0,u=t.useControls||void 0,p=t.camera||void 0;o.VOneData.container="div"===s?document.createElement("div"):document.body,o.VOneData.containerId=t.containerId||"VOneContainer",(t.width||t.height)&&(o.VOneData.containerDimensions={width:r,height:n});var f,y=t.raycastThreshold||20,g=t.cameraNear||.1,m=t.cameraFar||25e4,v=t.useTweenAnimations||!1,A=r/n;o.VOneData.interactiveObjects=[],o.VOneData.interactiveModels={add:function(e){o.VOneData.interactiveObjects.push(e)}},o.VOneData.container.style.margin="0",o.VOneData.container.style.padding="0";var O,E,V=c/2/Math.tan(toRadians(h/2));if(o.redererPaused=!1,o.VOneData.bgColor=i,o.VOneData.bgAlpha=a,o.VOneData.rendererType=l===THREE.WebGLRenderer?"webGL":"other",o.VOneData.rendererClass=l,"div"===s&&(document.body.appendChild(o.VOneData.container),o.VOneData.container.style.width=r+"px",o.VOneData.container.style.height=n+"px",o.VOneData.container.style.zIndex="-1",o.VOneData.container.id=o.VOneData.containerId,o.VOneData.containerType="div"),p?o.camera=p:(o.camera=new THREE.PerspectiveCamera(h,A,g,m),o.camera.position.z=V),o.add(o.camera),d&&(o.VOneData.controls=new d(o.camera,o.VOneData.container),e.controlsConfig))for(var M=Object.keys(e.controlsConfig),w=0;w<M.length;w++)o.VOneData.controls[M[w]]=e.controlsConfig[M[w]];(u&&(o.VOneData.controls=u),o.VOneData.sceneManager=new VOne.ThreeSceneManager(o,o.VOneData.interactiveModels),o.VOneData.sceneManager.controls=o.VOneData.controls,VOne.RenderersManager.addScene(o),e.bodyBGColor&&(VOne.RenderersManager.bgColor=e.bodyBGColor),e.bodyBGAlpha&&(VOne.RenderersManager.bgAlpha=e.bodyBGAlpha),"webGL"===o.VOneData.rendererType)?(o.mouse=new THREE.Vector2,o.mouseOnScreen=new THREE.Vector2,o.VOneData.raycaster=new THREE.Raycaster,o.VOneData.raycaster.params.Points.threshold=y,o.VOneData.INTERSECTED=null,o.VOneData.rendererProperties=e.glRendererCustomProperties,o.render=function(){if(0<o.VOneData.interactiveObjects.length){o.VOneData.raycaster.setFromCamera(o.mouse,o.camera);var e=o.VOneData.raycaster.intersectObjects(o.VOneData.interactiveObjects);if(0<e.length){if(e[0].object.geometry instanceof THREE.BufferGeometry){if(e[0].hasOwnProperty("faceIndex")){o.VOneData.lastInteractiveModelName=e[0].object.name;var t=Math.floor(e[0].faceIndex*o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName].dataModel.length/e[0].object.geometry.attributes.position.count);E=t}else E=e[0].index;O=!0}else e[0].object.geometry instanceof THREE.Geometry&&(E=e[0].object,O=!1);if(o.VOneData.INTERSECTED!=E){if(null!==o.VOneData.INTERSECTED&&"function"==typeof(n=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName]).onMouseOut)if(O){var r=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName].dataModel[o.VOneData.INTERSECTED];n.onMouseOut(r,o.VOneData.INTERSECTED)}else n.onMouseOut(E);if(o.VOneData.INTERSECTED=E,o.VOneData.lastInteractiveModelName=e[0].object.name,"function"==typeof(n=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName]).onMouseOver)if(O){r=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName].dataModel[o.VOneData.INTERSECTED];n.onMouseOver(r,o.VOneData.INTERSECTED)}else n.onMouseOver(E)}}else if(null!==o.VOneData.INTERSECTED){var n;if("function"==typeof(n=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName]).onMouseOut)if(O){r=o.VOneData.interactiveModels[o.VOneData.lastInteractiveModelName].dataModel[o.VOneData.INTERSECTED];n.onMouseOut(r,o.VOneData.INTERSECTED)}else n.onMouseOut(E);o.VOneData.INTERSECTED=null}}o.VOneData.controls&&o.VOneData.controls.update(),0<o.VOneData.sceneManager.onRender.length&&o.VOneData.sceneManager.onRender.forEach(function(e){e.fn(e.params)}),f.render(o,o.camera)},v&&o.VOneData.sceneManager.registerAnimationEngine()):o.render=function(){controls&&controls.update(),0<o.VOneData.sceneManager.onRender.length&&o.VOneData.sceneManager.onRender.forEach(function(e){e.fn(e.params)}),f.render(o,o.camera)};return o.VOneData.sceneManager}},VOne.assignLevelData=function(e,t){var a=(t=t||{}).childPropertyName||"values",s=(t.parentPropertyName,t.storeTotalValueAs||"totalValue"),l=t.setTotalBy||void 0,h=t.extendRecordsOn||!1,c=t.setProcessLastChild||void 0;!function e(r,t){if(Array.isArray(r))for(var n=0;n<r.length;n++){if(l&&(r[n][s]=0),r[n].level=t,!(a in r[n]))return;var o=t+1;e(r[n][a],o);var i=0;r[n][a].forEach(function(e){if(e.groupIndex=i,e.parent=r[n],i++,!e[a]){if(h&&!e.traversed){for(var t=1;t<e[h];t++)r[n][a].push(e),0;e.traversed=!0}l&&(e[s]="function"==typeof l?l(e):l),c&&c(e),0}l&&(r[n][s]+=e[s])}),l&&r[n][a].sort(function(e,t){return e[s]-t[s]})}}(e,0)},VOne.RadialDistribution=function(){var r,m={};return m.graphModel=[],m.data=function(e){return r=e,m},m.generateDistribution=function(e){if(r){if(!r[0].key||!r[0].values)return console.log(r[0]),void console.error("ERROR: Data array objects must contain key:String and values:Array properties.");var t=e.distanceFromParent||3500;return m.graphModel=[],function r(e,t,n,o,i){var a=t||0;var s=n||360;var l=i||0;if(!e[0].key){var h=o*++l,c=calculateXYInRadius(a,h),d=calculateXYInRadius(s,h),u=(a+s)/2,p=Math.sqrt(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2))/2,f=calculateXYInRadius(u,h);return void e.forEach(function(e,t){var r=randomCoordsInRadius(p,!0);e.position={x:f.x+r.x,y:f.y+r.y},e.angle=getAngleInDegreesFromCenter(e.position),e.level=l,m.graphModel.push(e)})}var y=a;var g=(s-a)/e.length;l++;e.forEach(function(t,e){t.startAngle=y,y+=g,t.endAngle=y,t.angle=(t.endAngle+t.startAngle)/2,t.position=calculateXYInRadius(t.angle,l*o),m.graphModel.push(t),r(t.values,t.startAngle,t.endAngle,o,l),t.values.forEach(function(e){e.parent=t}),t.level=l})}(r,e.startAngle,e.endAngle,t,e.firstNodeInCenter?-1:0),m}console.error("ERROR: no data to process. ")},m.attachToScene=function(e,t,r){return VOne.CPSBufferGeometriesGenerator().generateGeometries(e,t,m.graphModel,r)},m},VOne.ForceDirectedLayoutEngine=function(e,t){t=t||{},this.averageForceUpdateThreshold=t.averageForceUpdateThreshold||.001,this.repulsion=t.repulsion||.5,this.springConstant=t.springConstant||.4,this.maxForce=t.maxForce||40,this.edgeLength=t.edgeLength||400,this.dampingFactor=t.dampingFactor||.1,this.setGraph(e)},VOne.ForceDirectedLayoutEngine.prototype={constructor:VOne.ForceDirectedLayoutEngine,setGraph:function(e){this.graph=e,this.graph.changed=!0,this.randomNodePositions()},clearForces:function(){this.graph.nodes.forEach(function(e,t){e.force.set(0,0,0)})},addRepulsiveForces:function(e,t){var r=e.getVector(t),n=r.length()/this.edgeLength;n<.01&&(n=.01);var o=this.repulsion/(n*n);this.addForce(e,r,-1*o),this.addForce(t,r,o)},step:function(){this.doFDLStep(),this.doFDLStep()},doFDLStep:function(){this.clearForces();var o=this,i=this.graph.nodes,a=i.length;i.forEach(function(e,t){for(var r=t+1;r<a;r++){var n=i[r];o.addRepulsiveForces(e,n)}});this.graph.edges;this.graph.edges.forEach(function(e,t){o.addEdgeForces(e)}),this.updateNodePositions()},randomNodePositions:function(){var r=this;this.graph.nodes.forEach(function(e,t){e.position.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),e.position.normalize(),e.position.multiplyScalar(Math.random()*r.edgeLength*2),e.update()})},addForce:function(e,t,r){e.force.x=e.force.x+t.x*r,e.force.y=e.force.y+t.y*r,e.force.z=e.force.z+t.z*r},getAverageForce:function(){var r=0;return this.graph.nodes.forEach(function(e,t){r+=e.force.length()}),r/this.graph.nodes.length},addEdgeForces:function(e){var t=e.from,r=e.to,n=t.getVector(r),o=e.defaultLength||this.edgeLength,i=n.length()-o;if(.1<i){var a=this.springConstant*i;this.addForce(t,n,a),this.addForce(r,n,-1*a)}},updateNodePositions:function(){var o=this;this.graph.nodes.forEach(function(e,t){var r=e.force.length(),n=e.force.clone();r>o.maxForce&&(r=o.maxForce),n.normalize(),n.multiplyScalar(r*o.dampingFactor),e.position.add(n),e.update()}),this.graph.edges.forEach(function(e,t){e.update()})}},VOne.Graph=function(){this.nodes=[],this.edges=[],this.nodeIdMap={},this.nodeIdentifierMap={},this.relationships={},this.startingPosition=new THREE.Vector3(0,0,0),this.changed=!1},VOne.Graph.prototype={constructor:VOne.Graph,addNode:function(e){this.nodes.push(e),(this.nodeIdMap["n"+e.id]=e).identifier&&(this.nodeIdentifierMap[e.identifier]=e),(e.graph=this).changed=!0},removeNodeById:function(t){var e=this.nodes.findIndex(function(e){return e.id===t});if(-1<e){this.nodes[e];delete this.nodeIdMap["n"+this.nodes[e].id];this.nodes.splice(e,1);void 0;this.removeInvalidEdges();return this.changed=!0,e}return-1},removeInvalidEdges:function(){for(var e=0,t=this.edges.length-1;0<=t;t--)void 0!==this.edges[t].to&&void 0!==this.edges[t].from||(this.edges.splice(t,1),e++);return e},addEdge:function(e){return this.edges.push(e),(e.graph=this).changed=!0,e},getNodeById:function(e){return this.nodeIdMap["n"+e]},findEdge:function(e,t){for(var r=void 0,n=void 0,o=0;o<this.edges.length;o++)if((r=this.edges[o]).from.id==e.id&&r.to.id==t.id){n=r;break}return n},findOrCreateNode:function(e){var t=this.getNodeById(e);return t||(t=new VOne.GraphNode(e),this.addNode(t),this.changed=!0),t},findOrCreateEdge:function(e,t){if(!e||!t)return!1;var r=this.findEdge(e,t);return r||(r=new VOne.GraphEdge(e,t),this.addEdge(r),this.changed=!0),r},getOutgoingEdges:function(r){var n=[];return this.edges.forEach(function(e,t){e.from==r&&-1==n.indexOf(e)&&n.push(e)}),n},getIncomingEdges:function(r){var n=[];return this.edges.forEach(function(e,t){e.to==r&&-1==n.indexOf(e)&&n.push(e)}),n},getEdges:function(r){var n=[];return this.edges.forEach(function(e,t){e.from!=r&&e.to!=r||-1!=n.indexOf(e)||n.push(e)}),n},getTargetNodes:function(){var r=[];return this.nodes.forEach(function(e,t){e.isTarget()&&r.push(e)}),r},getSources:function(){var r=[];return $.each(this.nodes,function(e,t){t.isSource()&&r.push(t)}),r},isLastTarget:function(r){return this.edges.forEach(function(e,t){if(e.from==r)return!1}),!0},isSource:function(r){return this.edges.forEach(function(e,t){if(e.to==r)return!1}),!0}},VOne.GraphBuilder=function(e,t){this.data=e,this.map=t||{}},VOne.GraphBuilder.prototype={constructor:VOne.GraphBuilder,buildGraph:function(){var n,s=new VOne.Graph,o="id",l="id";return this.map.id&&(o=this.map.id),this.map.targetId&&(l=this.map.targetId),this.data.forEach(function(e,t){n=e[o];var r=new VOne.GraphNode(n,s);s.addNode(r)}),this.data.forEach(function(e,t){var a=e[o];e.friends.forEach(function(e,t){var r=e[l],n=s.getNodeById(a),o=s.getNodeById(r),i=new VOne.GraphEdge(n,o);s.addEdge(i)})}),s}},VOne.GraphEdge=function(e,t){this.from=e,this.to=t},VOne.GraphEdge.prototype={constructor:VOne.GraphEdge,getVector:function(){var e=this.to.position.clone();return e.sub(this.from.position),e},initNodePositions:function(e){this.to.atOrigin()&&!this.from.atOrigin()?this.to.position.set(Math.random()+this.from.position.x,Math.random()+this.from.position.y,Math.random()+this.from.position.z):this.from.atOrigin()&&!this.to.atOrigin()?this.from.position.set(Math.random()+this.to.position.x,Math.random()+this.to.position.y,Math.random()+this.to.position.z):e&&(this.from.position.set(e.x,e.y,e.z),this.to.position.set(e.x,e.y,e.z)),this.graph.changed=!0},update:function(){}},VOne.GraphNode=function(e){this.position=new THREE.Vector3(0,0,0),this.force=new THREE.Vector3(0,0,0),this.id=e,this.label="node_x",this.graph=null,this.type=void 0},VOne.GraphNode.prototype={constructor:VOne.GraphNode,getVector:function(e){if(e){var t=e.position.clone();return t.sub(this.position),t}console.log("no node")},atOrigin:function(){return 0==this.position.x&&0==this.position.y&&0==this.position.z},getOutgoing:function(){return this.graph.getOutgoingEdges(this)},getIncoming:function(){return this.graph.getIncomingEdges(this)},getEdges:function(){return this.graph.getEdges(this)},getChildren:function(){var r=[];return this.getOutgoing().forEach(function(e,t){-1==r.indexOf(e.to)&&r.push(e.to)}),r},getParents:function(){var n=[];return this.getIncoming().forEach(function(e,t){var r=e.from;-1==n.indexOf(r)&&n.push(r)}),n},isSource:function(){return this.graph.isSource(this)},isTarget:function(){return this.graph.isTarget(this)},setLabel:function(e){this.label=e},setType:function(e){this.type=e},update:function(){}},VOne.fibSphere=function(e,t,r,n){for(var o,i,a,s,l,h=2/e,c=new Float32Array(3*e),d=n?Math.random()*e:1,u=0;u<e;u++)i=u*h-1+h/2,l=Math.sqrt(1-i*i),s=(u+d)%e*VOne.SphericalIncrementRatio,o=Math.cos(s)*l,a=Math.sin(s)*l,c[3*u]=t.x+o*r,c[3*u+1]=t.y+i*r,c[3*u+2]=t.z+a*r;return c},VOne.circlePackLayout=function(e,t){if(!Array.isArray(e))return console.error("Provided data must be an array!"),-1;t||(t={});var f=t.childPropertyName||"values",y=t.nestedData||!1,g=t.setRadius||!1,m=t.radiusPropertyName||"radius",v=t.positionPropertyName||"center",r=t.centerX||0,n=t.centerY||0,A=t.padding||0,O=t.toleranceDistanceFactor||.01,E=function(e,t,r){var n,o,i,a=t[v].x>=e[v].x,s=t[v].y>=e[v].y,l=t[m]+e[m],h=0,c=e[v].distanceTo(t[v]),d=e[m]+r;a?s?(o=t[v].y-e[v].y,h=Math.asin(o/c)):(n=t[v].x-e[v].x,h=-Math.acos(n/c)):s?(n=t[v].x-e[v].x,h=Math.acos(n/c)):(o=t[v].y-e[v].y,h=Math.PI-Math.asin(o/c));var u=0;Math.abs(l-c)>.02*e[m]&&(u=(c-l)/2*e[m]/t[m]);return i=h+Math.acos((e[m]+u)/d),{x:e[v].x+Math.cos(i)*d,y:e[v].y+Math.sin(i)*d}},V=function(e,t,r,n){r=r||t.length-1;for(var o=1-(n=n||.001),i=0;i<=r;i++)if(e!==t[i]&&e[v].distanceTo(t[i][v])*o<e[m]+A)return!0;return!1};!function e(t,r,n){if(g){var o="function"==typeof g;t.forEach(function(e){e[m]=o?g(e):g})}if(Array.isArray(t)){t.sort(function(e,t){return e[m]<t[m]?-1:e[m]>t[m]?1:0});var i,a,s,l,h=[];if(a=r,s=n,t[0][v]=new THREE.Vector3(a,s,0),h[0]=t[0],y&&f in t[0]&&e(t[0][f],a,s),1<t.length&&(a=r+t[0][m]+t[1][m]+A,s=n,t[1][v]=new THREE.Vector3(a,s,0),h[1]=t[1],y&&f in t[1]&&e(t[1][f],a,s)),2<t.length)for(var c,d,u=1,p=2;p<t.length;p++){for(c=!0,i=t[p],d=p-1;c;)a=(l=E(h[0],h[1],i[m]+A)).x,s=l.y,i[v]=new THREE.Vector3(a,s,0),V(i,t,p-1,O)?(u===p&&p-(u=1)<=++d&&(d=2),u++,h[0]=t[u],h[1]=t[d]):(c=!1,h[1]=i);y&&f in t[p]&&e(t[p][f],a,s)}}}(e,r,n)},VOne.CubeDistribution=function(e){e.forEach(function(e,t){e.vOriginalIndex=t}),this.cubeDistribution={},this._dataArray=Array.from(e),this.positionArray=new Float32Array(3*this._dataArray.length),this.positionArray.fill(0),this.axisModel={x:{},y:{},z:{}}},VOne.CubeDistribution.prototype.constructor=VOne.CubeDistribution,VOne.CubeDistribution.prototype.distribute=function(A,O){var E=this;A=A||{},O=O||this._dataArray;var V,M,w,b,R,x=A.axisModel||this.axisModel,T={x:{length:0,boundaries:[]},y:{length:0,boundaries:[]},z:{length:0,boundaries:[]}};return["x","y","z"].forEach(function(s,e){if(A[s])if(V=A[s].axisLength||1e3,M=A[s].startAt||0,w=M+V,b=void 0!==A[s].order?A[s].order:VOne.ORDER.DESC,R=parseInt(A[s].density)||10,A[s].groupBy){x[s].groupedBy=A[s].groupBy,x[s].groups={};var n=VOne.OPERATION.COUNT;void 0!==A[s].orderPropTreatment&&A[s].orderProp&&(n=A[s].orderPropTreatment),O.forEach(function(e,t){if(void 0===e[A[s].groupBy]&&(e[A[s].groupBy]="--not-set--"),x[s].groups[e[A[s].groupBy]]||(x[s].groups[e[A[s].groupBy]]={},x[s].groups[e[A[s].groupBy]].records=[],x[s].groups[e[A[s].groupBy]].orderValue=0,x[s].groups[e[A[s].groupBy]].count=0),x[s].groups[e[A[s].groupBy]].records.push(e),n!==VOne.OPERATION.COUNT){var r;try{r=parseFloat(e[A[s].orderProp])}catch(e){r=0}x[s].groups[e[A[s].groupBy]].orderValue+=r}x[s].groups[e[A[s].groupBy]].count++});var t=[],l=0;for(var r in x[s].groups)n===VOne.OPERATION.AVG&&(x[s].groups[r].orderValue=x[s].groups[r].orderValue/x[s].groups[r].count),n===VOne.OPERATION.COUNT?(x[s].groups[r].orderValue=x[s].groups[r].count,l+=x[s].groups[r].count):l+=x[s].groups[r].orderValue,x[s].groups[r].label=r,t.push(x[s].groups[r]);t.sort(function(e,t){return b===VOne.ORDER.ASC?e.orderValue<t.orderValue?-1:e.orderValue>t.orderValue?1:0:e.orderValue<t.orderValue?1:e.orderValue>t.orderValue?-1:0});var h,c=M,d=0;T[s].length=V,t.forEach(function(e,t){if(d=e.orderValue/l*V,e.startAt=c,h=c+d,e.endAt=h,T[s].boundaries.push({label:e.label,startAt:e.startAt,endAt:e.endAt}),e.availableDistance=h-c,c=h,A[s].subgroup){A[s].subgroup.startAt=e.startAt,A[s].subgroup.axisLength=d;var r={};r[s]={},r[s]=A[s].subgroup,E.distribute(r,e.records)}else{var n=e.availableDistance/R,o=n/2,i="x"===s?0:"y"===s?1:2,a=e.startAt+o;e.records.forEach(function(e,t){E.positionArray[3*e.vOriginalIndex+i]=a+t%R*n})}})}else if(void 0!==A[s].orderProp){var o=w-M,i="x"===s?0:"y"===s?1:2,a=Math.max.apply(Math,O.map(function(e){return e[A[s].orderProp]})),u=Math.min.apply(Math,O.map(function(e){return e[A[s].orderProp]})),p=a-u;if(O.forEach(function(e,t){b===VOne.ORDER.ASC?E.positionArray[3*e.vOriginalIndex+i]=M+(e[A[s].orderProp]-u)/p*o:E.positionArray[3*e.vOriginalIndex+i]=w-(e[A[s].orderProp]-u)/p*o}),A[s].ticksCount&&0<A[s].ticksCount){var f,y,g=(T[s].length=V)/(A[s].ticksCount+1),m=b===VOne.ORDER.ASC?M:w;T[s].boundaries.push({label:u,startAt:m,endAt:m});for(var v=0;v<A[s].ticksCount+1;v++)f=b===VOne.ORDER.ASC?m+g:m-g,y=u+(v+1)*p/A[s].ticksCount,T[s].boundaries.push({label:y,startAt:m,endAt:f}),m=f,f=b===VOne.ORDER.ASC?g+f:f-g}}}),{positionArray:this.positionArray,boundaries:T}},VOne.DeathSphere=function(){this.type="VOne.DeathSphere"},VOne.DeathSphere.prototype.constructor=VOne.DeathSphere,VOne.DeathSphere.prototype.generate=function(r,e,t){if(!Array.isArray(r))return console.error("An array must be provided to create a Death sphere."),-1;void 0===t&&(t="deathSphere");var n=e.childrenPropertyName||"values",o=e.parentPropertyName||"key",i=e.valueProperty||"totalValue",a=e.marginDegrees||20,l=e.radius||500,h=e.segmentsResolution||32,s=[],c=[],d=[],u=[],p=0,f=function(e,t){for(var r=(t-e)*VOne.degToRad/h,n=[],o=e*VOne.degToRad,i=0;i<=h;i++){var a=l*Math.cos(o),s=l*Math.sin(o);n.push(new THREE.Vector2(a,s)),o+=r}return n};calculateLevel0Total=function(){for(var e=0,t=0;t<r.length;t++)e+=r[t][i];return e},p=r[0][o]&&r[0][o][i]?r[0][o][i]:calculateLevel0Total();for(var y,g,m,v,A,O,E,V=0,M=-90+a,w=90-a,b=w-M,R=0;R<r.length;R++){E=(V+(y=V+VOne.DoublePI*r[R][i]/p))/2,g=f(M,w),m=y-V,r[R].geometry=new THREE.LatheGeometry(g,32,V,m),r[R].middlePhi=E,s.push(r[R].geometry),c.push(r[R]),v=M;for(var x=0;x<r[R][n].length;x++)O=f(v,A=v+r[R][n][x][i]/r[R][i]*b),r[R][n][x].geometry=new THREE.LatheGeometry(O,12,V,m),r[R][n][x].parentIndex=R,d.push(r[R][n][x].geometry),u.push(r[R][n][x]),v=A;V=y}var T=new VOne.GeometryModel("main"+t,void 0,c);T.setGeometries(s);var C=new VOne.GeometryModel("secondary"+t,void 0,u);return C.setGeometries(d),{mainGeometryModel:T,secondaryGeometryModel:C}},VOne.halfTube=function(e,t,r){e=e||1e3,t=t||{x:0,y:0,z:0};var n=(r=r||{}).height||500,o=r.radius||1e3,i=r.startPhi||180,a=r.endPhi||360,s=r.pointsPerRow||12,l=n/Math.ceil(e/s);if(a<i){var h=i;i=a,a=h}for(var c,d,u=(a-i)/s*VOne.degToRad,p=i*VOne.degToRad+u/2,f=p,y=t.y-n/2,g=new Float32Array(3*e),m=1;m<=e;m++){var v=m-1;c=o*Math.cos(f),d=o*Math.sin(f),g[3*v]=t.x+c,g[3*v+1]=y,g[3*v+2]=t.z+d,m%s!=0&&0!==m?f+=u:(f=p,y+=l)}return g},VOne.spiral=function(e,t){for(var r,n,o,i,a=(t=t||{}).centerX||0,s=t.centerY||0,l=t.sizePropertyName||"radius",h=t.positionPropertyName||"position",c=t.setSize||!1,d=t.linearPadding||0,u=t.radialPadding||0,p=t.z||0,f=t.looseSpiral||!1,y=t.startRadius||0,g=0,m=0,v=0;v<e.length;v++)c&&(e[v][l]="function"==typeof c?c(e[v],v):c),o=f?y+e[v][l]*VOne.GoldenRatio:0<y?y+(2*Math.pow(e[v][l],2)+u)/Math.PI/y/2:e[v][l],i=Math.atan((g+e[v][l]+d)/y)+m,r=a+o*Math.cos(i),n=s+o*Math.sin(i),e[v][h]=new THREE.Vector3(r,n,p),g=e[v][l],y=o,m=i},VOne.RadialPolygon=function(e,t){if(!e||e<3)throw new Error("Number of sections must be equal or greater than 3.");this.sectionsCount=e;var r=VOne.DoublePI/this.sectionsCount;this.triangleAperture=r;var n,o,i=function(e){var t=r/2;return e*Math.cos(t)};t.radii?(this.radii=t.radii,this.arista=i(this.radii)):t.arista?(this.arista=t.arista,this.radii=(n=this.arista,o=r/2,n/Math.sin(o))):(this.radii=333,this.arista=i(this.radii)),this.centerHeight="number"!=typeof t.centerHeight?0:t.centerHeight,this.sections=[],this.triangles=[];for(var a=0;a<this.sectionsCount;a++){var s=r*a,l=r*(a+1),h=this.radii*Math.cos(s),c=this.radii*Math.cos(l),d=this.radii*Math.sin(s),u=this.radii*Math.sin(l),p=new THREE.Vector3(h,d,0),f=new THREE.Vector3(c,u,0),y=new THREE.Vector3(0,0,this.centerHeight),g=new THREE.Vector3((h+c)/2,(d+u)/2,0),m=(p.clone().sub(y),f.clone().sub(y),new THREE.Triangle(p,f,y)),v=new THREE.Vector3;m.getNormal(v),m.startAngle=s,m.endAngle=l,m.halfAngle=(s+l)/2,this.triangles.push(m);var A={vertices:[p,f,y],normal:v,aristaMagnitude:y.distanceTo(g),angle:r};this.sections.push(A)}},VOne.RadialPolygon.prototype.constructor=VOne.RadialPolygon,VOne.RadialPolygon.prototype.getSections=function(){return this.sections},VOne.RadialPolygon.prototype.getSection=function(e){return this.sections[e%this.sectionsCount]},VOne.RadialPolygon.prototype.getPoint=function(e,t,r,n){var o=t+this.triangles[r].startAngle,i=-(this.triangles[r].halfAngle-o),a=e/Math.cos(i),s=a*Math.cos(o),l=a*Math.sin(o),h=this.centerHeight*(1-e/this.arista),c=(this.centerHeight,this.arista,new THREE.Vector3(s,l,h)),d=this.sections[r].normal.clone();return d.multiplyScalar(n),c.add(d)},VOne.GeometryModel=function(e,t,r,n){this.type="GeometryModel",this.name=e+"Nodes",this.dataModel=r,this.nodesAttributes=n,this.mesh=t,this.geometries=void 0,this.setInteraction=function(e,t){this[e]=t}},VOne.GeometryModel.prototype={constructor:VOne.GeometryModel,setGeometries:function(e){this.geometries=e}},VOne.Scenes=[],VOne.BufferGeometryModel=function(e){this.type="BufferGeometryModel",this.dataModel=e,this.positionArray=void 0,this.colorArray=void 0,this.sizeArray=void 0,this.alphaArray=void 0,this.geometry=void 0,this.mesh=void 0,this.animating=!1,this.verticesCount=1},VOne.BufferGeometryModel.prototype={constructor:VOne.BufferGeometryModel,setPositionArray:function(e){this.positionArray=e},getPositionArray:function(){return this.positionArray},setColorArray:function(e){this.colorArray=e},getColorArray:function(){return this.colorArray},setSizeArray:function(e){this.sizeArray=e},getSizeArray:function(){return this.sizeArray},setAlphaArray:function(e){this.alphaArray=e},getAlphaArray:function(){return this.alphaArray},setDataModel:function(e){this.dataModel=e},getDataModel:function(){return this.dataModel},setGeometry:function(e){this.geometry=e},getGeometry:function(){return this.geometry},setMesh:function(e){var t=this;e.getModel=function(){return t},this.mesh=e},getSceneObject:function(){return this.mesh},setAnimating:function(e){this.animating=e},getVerticesCount:function(){return this.verticesCount},setVerticesCount:function(e){this.verticesCount=e},setInteraction:function(e,t){this[e]=t}},VOne.PreparedBufferGeometryModel=function(e,t){if(!e||"number"!=typeof e)return new Error("Usage: new PreparedBufferGeometryModel(maxVerticesNumber, [dataModel]);");VOne.BufferGeometryModel.call(this,t),this.type="PreparedBufferGeometryModel",this.maxVerticesNumber=e,this.setPositionFor=void 0,this.setColorFor=void 0,this.setSizeFor=void 0,this.setAlphaFor=void 0,this.lastPositionFunction="",this.lastColorFunction="",this.lastSizeFunction="",this.lastAlphaFunction="",this.setGeometry(new THREE.BufferGeometry)},VOne.PreparedBufferGeometryModel.prototype=Object.create(VOne.BufferGeometryModel.prototype),VOne.PreparedBufferGeometryModel.prototype.constructor=VOne.PreparedBufferGeometryModel,VOne.PreparedBufferGeometryModel.prototype.setPosition=function(e){return this.setPositionFor=e,void 0===this.positionArray&&(this.positionArray=new Float32Array(3*this.maxVerticesNumber),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.positionArray,3))),this.lastPositionFunction=e,this},VOne.PreparedBufferGeometryModel.prototype.setSize=function(e){return this.setSizeFor=e,void 0===this.sizeArray&&(this.sizeArray=new Float32Array(this.maxVerticesNumber),this.geometry.addAttribute("size",new THREE.BufferAttribute(this.sizeArray,1))),this.lastSizeFunction=e,this},VOne.PreparedBufferGeometryModel.prototype.setColor=function(e){return this.setColorFor=e,void 0===this.colorArray&&(this.colorArray=new Float32Array(3*this.maxVerticesNumber),this.geometry.addAttribute("color",new THREE.BufferAttribute(this.colorArray,3))),this.lastColorFunction=e,this.colorFnUpdated=!0,this},VOne.PreparedBufferGeometryModel.prototype.setAlpha=function(e){return this.setAlphaFor=e,void 0===this.alphaArray&&(this.alphaArray=new Float32Array(this.maxVerticesNumber),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(this.alphaArray,1))),this.lastAlphaFunction=e,this.alphaFnUpdated=!0,this},VOne.PreparedBufferGeometryModel.prototype.setDataModel=function(e){return e.length>this.maxVerticesNumber&&console.warn("Providing a model larger than the max vertices number assigned can lead to unexpected and fatal behaviour."),this.dataModel=e,this},VOne.PreparedBufferGeometryModel.prototype.appendRecords=function(e,t){var r=t||!1,n=this.dataModel.length,o=n+e.length;return this.dataModel.extend(e),r&&this.processRecords(n,e.length),{previusModelSize:n,currentModelSize:o}},VOne.PreparedBufferGeometryModel.prototype.processRecords=function(e,t,r){var n=e||0,o=(t||this.dataModel.length)+n;o>this.dataModel.length&&(o=this.dataModel.length-1);var i,a=[],s=this;if(void 0!==this.setPositionFor||r||0<n){var l="function"==typeof this.setPositionFor?function(e,t){e.position=s.setPositionFor(e,t),s.positionArray[3*t]=e.position.x,s.positionArray[3*t+1]=e.position.y,s.positionArray[3*t+2]=e.position.z}:function(e,t){e.position=s.setPositionFor,s.positionArray[3*t]=e.position.x,s.positionArray[3*t+1]=e.position.y,s.positionArray[3*t+2]=e.position.z};a.push(l),this.positionFnUpdated=!1}if(void 0!==this.setColorFor||r||0<n){var h="function"==typeof this.setColorFor?function(e,t){e.color=s.setColorFor(e,t),s.colorArray[3*t]=e.color.r,s.colorArray[3*t+1]=e.color.g,s.colorArray[3*t+2]=e.color.b}:function(e,t){e.color=s.setColorFor,s.colorArray[3*t]=e.color.r,s.colorArray[3*t+1]=e.color.g,s.colorArray[3*t+2]=e.color.b};a.push(h),this.colorFnUpdated=!1}if(void 0!==this.setSizeFor||r||0<n){var c="function"==typeof this.setSizeFor?function(e,t){e.size=s.setSizeFor(e,t),s.sizeArray[t]=e.size}:function(e,t){e.size=s.setSizeFor,s.sizeArray[t]=e.size};a.push(c),this.sizeFnUpdated=!1}if(void 0!==this.setAlphaFor||r||0<n){var d="function"==typeof this.setAlphaFor?function(e,t){e.alpha=s.setAlphaFor(e,t),s.alphaArray[t]=e.alpha}:function(e,t){e.alpha=s.setAlphaFor,s.alphaArray[t]=e.alpha};a.push(d),this.alphaFnUpdated=!1}for(var u=n;u<o;u++)i=this.dataModel[u],a.forEach(function(e){e(i,u)});void 0!==this.setPositionFor&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()),void 0!==this.setColorFor&&(this.geometry.attributes.color.needsUpdate=!0),void 0!==this.setSizeFor&&(this.geometry.attributes.size.needsUpdate=!0),void 0!==this.setAlphaFor&&(this.geometry.attributes.alpha.needsUpdate=!0),this.geometry.drawRange.count=this.dataModel.length},VOne.PreparedBufferGeometryModel.prototype.updatePositionArray=function(e,t){var r=this;if(void 0!==this.setPositionFor){var n="function"==typeof this.setPositionFor?function(e,t){e.position=r.setPositionFor(e,t),r.positionArray[3*t]=e.position.x,r.positionArray[3*t+1]=e.position.y,r.positionArray[3*t+2]=e.position.z}:function(e,t){e.position=r.setPositionFor,r.positionArray[3*t]=e.position.x,r.positionArray[3*t+1]=e.position.y,r.positionArray[3*t+2]=e.position.z};e=e||0,t=t||this.dataModel.length-1;for(var o=e;o<=t;o++)record=this.dataModel[o],n(record,o);this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()}},VOne.PreparedBufferGeometryModel.prototype.updateColorArray=function(e,t){var r=this;if(void 0!==this.setColorFor){var n="function"==typeof this.setColorFor?function(e,t){e.color=r.setColorFor(e,t),r.colorArray[3*t]=e.color.r,r.colorArray[3*t+1]=e.color.g,r.colorArray[3*t+2]=e.color.b}:function(e,t){e.color=r.setColorFor,r.colorArray[3*t]=e.color.r,r.colorArray[3*t+1]=e.color.g,r.colorArray[3*t+2]=e.color.b};e=e||0,t=t||this.dataModel.length-1;for(var o=e;o<=t;o++)record=this.dataModel[o],n(record,o);this.geometry.attributes.color.needsUpdate=!0}},VOne.PreparedBufferGeometryModel.prototype.updateSizeArray=function(e,t){var r=this;if(void 0!==this.setSizeFor){var n="function"==typeof this.setSizeFor?function(e,t){e.size=r.setSizeFor(e,t),r.sizeArray[t]=e.size}:function(e,t){e.size=r.setSizeFor,r.sizeArray[t]=e.size};e=e||0,t=t||this.dataModel.length-1;for(var o=e;o<=t;o++)record=this.dataModel[o],n(record,o);this.geometry.attributes.size.needsUpdate=!0}},VOne.PreparedBufferGeometryModel.prototype.updateAlphaArray=function(e,t){var r=this;if(void 0!==this.setAlphaFor){var n="function"==typeof this.setAlphaFor?function(e,t){e.alpha=r.setAlphaFor(e,t),r.alphaArray[t]=e.alpha}:function(e,t){e.alpha=r.setAlphaFor,r.alphaArray[t]=e.alpha};e=e||0,t=t||this.dataModel.length-1;for(var o=e;o<=t;o++)record=this.dataModel[o],n(record,o);this.geometry.attributes.alpha.needsUpdate=!0}},VOne.PreparedBufferGeometryModel.prototype.setGeometryDrawRangeCount=function(e){this.geometry.drawRange.count=e},VOne.BackgroundModelGenerator=function(o,i,e){if(!o||!i)return console.error("Must provide a valid records count value and a model to initialize! ej.:\n var mySuperModelGenerator = new VOne.BackgroundModelGenerator(howManyRecordsToHandle, { propertyName: 'property_type', propertyName: 'property_type' } );\n Check VOne documentation about valid property's types"),-1;var a=this;this.maskedDataModel=[],this.modelKeys=Object.keys(i),this.rawData={},this.dataModel=void 0,VOne.PreparedBufferGeometryModel.call(this,o,this.dataModel),this.type="BackgroundModelGenerator",this.recordsCount=o,this.recordsPartialDeliverCount=e||o,this.partialDeliver3Times=3*this.recordsPartialDeliverCount,this.worker=void 0,this.positionsProgram=void 0,this.colorsProgram=void 0,this.sizesProgram=void 0,this.alphasProgram=void 0,this.modelKeys.forEach(function(e){switch(i[e]){case"Int8Array":a.rawData[e]=new Int8Array(o);break;case"Uint8Array":a.rawData[e]=new Uint8Array(o);break;case"Uint8ClampedArray":a.rawData[e]=new Uint8ClampedArray(o);break;case"Int16Array":a.rawData[e]=new Int16Array(o);break;case"Uint16Array":a.rawData[e]=new Uint16Array(o);break;case"Int32Array":a.rawData[e]=new Int32Array(o);break;case"Uint32Array":a.rawData[e]=new Uint32Array(o);break;case"Float32Array":a.rawData[e]=new Float32Array(o);break;case"Float64Array":a.rawData[e]=new Float64Array(o);break;default:if(-1<i[e].toLowerCase().indexOf("string")){var t=i[e].indexOf("("),r=i[e].indexOf(")"),n=parseInt(i[e].substr(t+1,r-t-1));a.rawData[e]=new Uint8Array(o*n)}}}),this.program=["var model = { }, recordsPartialDeliverCount = "+this.recordsPartialDeliverCount+";","var dataModel_;","var extras;","var recordsCount_;","function initModel(dataModel, recordsCount){","dataModel_ = dataModel;","var keys = Object.keys(dataModel);","recordsCount_ = recordsCount;","keys.forEach(function(key){","switch(dataModel[key]){","case 'Int8Array':","model[key] = new Int8Array(recordsCount);","break;","case 'Uint8Array':","model[key] = new Uint8Array(recordsCount);","break;","case 'Uint8ClampedArray':","model[key] = new Uint8ClampedArray(recordsCount);","break;","case 'Int16Array':","model[key] = new Int16Array(recordsCount);","break;","case 'Uint16Array':","model[key] = new Uint16Array(recordsCount);","break;","case 'Int32Array':","model[key] = new Int32Array(recordsCount);","break;","case 'Uint32Array':","model[key] = new Uint32Array(recordsCount);","break;","case 'Float32Array':","model[key] = new Float32Array(recordsCount);","break;","case 'Float64Array':","model[key] = new Float64Array(recordsCount);","break;","default:","if(dataModel[key].toLowerCase().indexOf('string') > -1){","var lengthStartPos = dataModel[key].indexOf('(');","var lengthEndPos = dataModel[key].indexOf(')');","var strMaxLength = parseInt(dataModel[key].substr(lengthStartPos + 1, lengthEndPos - lengthStartPos - 1));","model[key] = new Uint8Array(recordsCount * strMaxLength);","}","break;","}","});","self.postMessage(model);","};","function stringToTypedArray(s) {","var escstr = encodeURIComponent(s);","var binstr = escstr.replace(/%([0-9A-F]{2})/g, function(match, p1) {","return String.fromCharCode('0x' + p1);","});","var ua = new Uint8Array(binstr.length);","Array.prototype.forEach.call(binstr, function (ch, i) {","ua[i] = ch.charCodeAt(0);","});","return ua;","}"],this.messengerProgramHead=["self.onmessage = function(e){","var data = e.data;","switch(data.cmd){","case 'initModel':","initModel(data.dataModel, data.recordsCount);","break;","case 'processRecords':","processRecords(data.records, data.offset);","break;","case 'getRecords':","self.postMessage({ messageType: 'model', content: model });","break;","case 'setExtras':","extras = data.extras;","break;"],this.messengerProgramBody=[],this.messengerProgramTail=["default:","self.postMessage('Unrecognized command or command not yet implemented. sorry... =(');","break;","}","}"],this.recordsCount3Times=3*this.recordsCount,this.dataModelForWorker=i,this.drawRangeCurrentIndex=0},VOne.BackgroundModelGenerator.prototype=Object.create(VOne.PreparedBufferGeometryModel.prototype),VOne.BackgroundModelGenerator.prototype.constructor=VOne.BackgroundModelGenerator,VOne.BackgroundModelGenerator.prototype.setPositionScript=function(e){return this.positionsProgram=[],this.program.push("var positionArray = new Float32Array("+this.partialDeliver3Times+"); var positionResult;"),this.program.push("var setPositionFunction = function(record, index) { "+e+" } ;"),this.positionsProgram.push("positionResult = setPositionFunction(record, i);"),this.positionsProgram.push("positionArray[j * 3] = positionResult.x"),this.positionsProgram.push("positionArray[j * 3 + 1] = positionResult.y"),this.positionsProgram.push("positionArray[j * 3 + 2] = positionResult.z"),this.useSetPositionsProgram=!0,this.messengerProgramBody.push("case 'getPositionArray':","self.postMessage({ messageType: 'positionArray', content: positionArray });","break;"),this.positionArray=new Float32Array(this.recordsCount3Times),this.geometry.addAttribute("position",new THREE.BufferAttribute(this.positionArray,3)),this},VOne.BackgroundModelGenerator.prototype.setColorScript=function(e){return this.colorsProgram=[],this.program.push("var colorArray = new Float32Array("+this.partialDeliver3Times+"); var colorResult;"),this.program.push("var setColorFunction = function(record, index){ "+e+" };"),this.colorsProgram.push("colorResult = setColorFunction(record, i);"),this.colorsProgram.push("colorArray[j * 3] = colorResult.r"),this.colorsProgram.push("colorArray[j * 3 + 1] = colorResult.g"),this.colorsProgram.push("colorArray[j * 3 + 2] = colorResult.b"),this.useSetColorsProgram=!0,this.messengerProgramBody.push("case 'getColorArray':","self.postMessage({ messageType: 'colorArray', content: colorArray });","break;"),this.colorArray=new Float32Array(this.recordsCount3Times),this.geometry.addAttribute("color",new THREE.BufferAttribute(this.colorArray,3)),this},VOne.BackgroundModelGenerator.prototype.setSizeScript=function(e){return this.sizesProgram=[],this.program.push("var sizeArray = new Float32Array("+this.recordsPartialDeliverCount+"); var sizeResult;"),this.program.push("var setSizeFunction = function(record, index) { "+e+" };"),this.sizesProgram.push("sizeResult = setSizeFunction(record, i);"),this.sizesProgram.push("sizeArray[j] = sizeResult"),this.useSetSizesProgram=!0,this.messengerProgramBody.push("case 'getSizeArray':","self.postMessage({ messageType: 'sizeArray', content: sizeArray });","break;"),this.sizeArray=new Float32Array(this.recordsCount),this.geometry.addAttribute("size",new THREE.BufferAttribute(this.sizeArray,1)),this},VOne.BackgroundModelGenerator.prototype.setAlphaScript=function(e){return this.alphasProgram=[],this.program.push("var alphaArray = new Float32Array("+this.recordsPartialDeliverCount+"); var alphaResult;"),this.program.push("var setAlphaFunction = function(record, index){ "+e+" };"),this.alphasProgram.push("alphaResult = setAlphaFunction(record, i);"),this.alphasProgram.push("alphaArray[j] = alphaResult"),this.useSetAlphasProgram=!0,this.messengerProgramBody.push("case 'getAlphaArray':","self.postMessage({ messageType: 'alphaArray', content: alphaArray });","break;"),this.alphaArray=new Float32Array(this.recordsCount),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(this.alphaArray,1)),this},VOne.BackgroundModelGenerator.prototype.init=function(){var r=this;if(this.program.push("var processRecords = function(records, offset){","var finalIndex = records.length + offset;","var record;","var currentIndex = 0;","var modelKeys = Object.keys(model);","var j = 0;","var strIndex;","var toStore;","for(var i = offset; i < finalIndex; i++, j++){","record = records[currentIndex];","modelKeys.forEach(function(key){","if(dataModel_[key].toLowerCase().indexOf('string') === -1){","model[key][currentIndex] = record[key];","} else if(dataModel_[key].toLowerCase().indexOf('string') > -1){","strIndex = model[key].length / recordsCount_ * currentIndex;","toStore = stringToTypedArray(record[key]);","toStore.forEach(function (value, index) {","model[key][strIndex + index] = value"," } );","}","});"),this.positionsProgram&&this.program.push(this.positionsProgram.join("\n")),this.colorsProgram&&this.program.push(this.colorsProgram.join("\n")),this.sizesProgram&&this.program.push(this.sizesProgram.join("\n")),this.alphasProgram&&this.program.push(this.alphasProgram.join("\n")),this.program.push("currentIndex ++;","}"),this.positionsProgram||this.colorsProgram||this.sizesProgram||this.alphasProgram){var t=[],n=[],o=0;this.program.push("self.postMessage({ messageType: 'transferrables', offset: offset, finalIndex: finalIndex, transferrables: {  "),this.positionsProgram&&(t.push(0<o?", positionArray: positionArray":"positionArray: positionArray"),n.push(0<o?", positionArray.buffer":"positionArray.buffer"),o++),this.colorsProgram&&(t.push(0<o?", colorArray: colorArray":"colorArray: colorArray"),n.push(0<o?", colorArray.buffer":"colorArray.buffer"),o++),this.sizesProgram&&(t.push(0<o?", sizeArray: sizeArray":"sizeArray: sizeArray"),n.push(0<o?", sizeArray.buffer":"sizeArray.buffer"),o++),this.alphasProgram&&(t.push(0<o?", alphaArray: alphaArray":"alphaArray: alphaArray"),n.push(0<o?", alphaArray.buffer":"alphaArray.buffer"),o++),Object.keys(this.rawData).forEach(function(e){t.push(0<o?", "+e+': model["'+e+'"]':e+': model["'+e+'"]'),n.push(0<o?', model["'+e+'"].buffer':'model["'+e+'"].buffer'),o++}),this.program.push(t.join(""),"} }, [",n.join(""),"]);"),this.program.push(this.positionsProgram?"positionArray = new Float32Array("+this.partialDeliver3Times+");":""),this.program.push(this.colorsProgram?"colorArray = new Float32Array("+this.partialDeliver3Times+");":""),this.program.push(this.sizesProgram?"sizeArray = new Float32Array("+this.recordsPartialDeliverCount+");":""),this.program.push(this.sizesProgram?"alphaArray = new Float32Array("+this.recordsPartialDeliverCount+");":""),this.program.push("initModel(dataModel_, "+this.recordsPartialDeliverCount+");")}this.program.push("}"),this.program.push(this.messengerProgramHead.join("\n")),this.program.push(this.messengerProgramBody.join("\n")),this.program.push(this.messengerProgramTail.join("\n"));var e=this.program.join("\n"),i=new Blob([e]),a=window.URL.createObjectURL(i);return this.worker=new Worker(a),this.worker.onerror=function(e){console.error("Error from background model generator worker","ERROR: Line "+e.lineno+" in "+e.filename+": "+e.message)},this.worker.onmessage=function(e){var t=e.data;if(t.messageType)switch(t.messageType){case"positionArray":this.positionArray=t.content;break;case"colorArray":this.colorArray=t.content;break;case"sizeArray":this.sizeArray=t.content;break;case"alphaArray":this.alphaArray=t.content;break;case"model":this.rawData=t.content;break;case"transferrables":r.updateGeometryModelArrays(t.transferrables,t.offset,t.finalIndex);break;case"info":console.log(t.content);break;default:console.log("Received the following message from background thread. But I don't know what to do with it: ",t.content)}},this.worker.postMessage({cmd:"initModel",dataModel:this.dataModelForWorker,recordsCount:this.recordsPartialDeliverCount}),this},VOne.BackgroundModelGenerator.prototype.processRecords=function(e,t){this.worker.postMessage({cmd:"processRecords",records:e,offset:t})},VOne.BackgroundModelGenerator.prototype.setExtrasForWorker=function(e){this.worker.postMessage({cmd:"setExtras",extras:e})},VOne.BackgroundModelGenerator.prototype.updateGeometryModelArrays=function(o,i,e){var a=this;o.positionArray&&(this.positionArray.set(o.positionArray,3*i),this.geometry.attributes.position.needsUpdate=!0),o.colorArray&&(this.colorArray.set(o.colorArray,3*i),this.geometry.attributes.color.needsUpdate=!0),o.sizeArray&&(this.sizeArray.set(o.sizeArray,i),this.geometry.attributes.size.needsUpdate=!0),o.alphaArray&&(this.alphaArray.set(o.alphaArray,i),this.geometry.attributes.alpha.needsUpdate=!0),this.modelKeys.forEach(function(e){if(-1<a.dataModelForWorker[e].toLowerCase().indexOf("string")){var t=a.dataModelForWorker[e].indexOf("("),r=a.dataModelForWorker[e].indexOf(")"),n=parseInt(a.dataModelForWorker[e].substr(t+1,r-t-1));a.rawData[e].set(o[e],i*n)}else a.rawData[e].set(o[e],i)}),this.dataModel=new Proxy(this.rawData,{get:function(e,o){if("length"===o||"count"===o)return a.recordsCount;var i={};return a.modelKeys.forEach(function(e){if(-1<a.dataModelForWorker[e].toLowerCase().indexOf("string")){var t=a.dataModelForWorker[e].indexOf("("),r=a.dataModelForWorker[e].indexOf(")"),n=parseInt(a.dataModelForWorker[e].substr(t+1,r-t-1));i[e]=a.typedArrayToString(a.rawData[e].slice(o*n,o*n+n))}else i[e]=a.rawData[e][o]}),i}}),this.setGeometryDrawRangeCount(e-1),this.geometry.computeBoundingSphere()},VOne.BackgroundModelGenerator.prototype.typedArrayToString=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},VOne.DefaultImages={star:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHDRYtFjgycv0AAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAABlNJREFUWMPll8uPHUcVxn9fdfd9zcy1PePYjj32YJkQDA5BipBAAqQIsQD+B1hlj8QCsOwBO0aILRJr/gZ2sIoILBAOcgSBxGAzNs68PO/7mn5U1WHRPQqRYo8HkRUlXfW93eqq36nz1XfOhf/nUV6G9ONcYL8PhYEBxwRu8MGzRxchfOZjAAjA+Ay4NsQWuBa4AJMKRtOgEfQGUJ6FcOF/BDA+CToF7W4dbZZDuQnpRXAJmCAD4gSsgGJQf5dA/82CG6dgdh7CPmgM4RLEk5BMAYIwAHYgeQjxC/U7ioAH5RDGwCboBUiOLJxPQvY50Kcg/A3sMugT4F4AdxlsHtwMOAfKIPszxFdAHaANZOAEtCBZPWIK7p6HcBluXvlhKgm+TWpmSIICz0O4+Z1feJYHxJ4RQ7PVl+rIGYDtgSU1YLAjpuDq1atpkiRpjLEDpGbWbq4kSeLNrDCz3DmXL37pludNKN+Bzp8g/BK0CbYMrINtAXtHALh+/XoqqRNCmJI0B8xIascY2wCSCmAMDM1sz8zGSZLk19593edvw9SvM2y3Ij4A7oO9X0Mkz7p4CKEDzAFnJC1IOg/MA6cknQSeA/pAJskBQVL47cmvxq//8c3Id19E7YKkVUFVo1rxDBpYXFxMQwgd59ycpHPAgpk9b2YnJXVr3RMlRTMbAbNAv9kdYoxeBT5kL6NouP4SzBWoD9p+BoAQQgocM7MzZrYg6ZKkeWAG6ACJpGBmE0nTZtYHus1975wrrr32A38rcT6ka9BeRVMFtYoOScHi4mJqZj1Jp4EFSZeAi8A5SReSJFlI0/RskiRzwJSZAbjmY2ZWNWD7b/ye+OqXN6KqVRjuY+u1Vxy2A2kz8WyT59OSTkg6n6bp+SzLprvdbpJlmZVlmY9Go+Pe+3sxxmBmBTAEHjvntiXlFvZQrIglyIPFZ/OBjnNu2sxONDAzaZqearVa/VarlfR6Paanpwkh9CTN7+3tjWOMI0nTTZp6Ztb23qfOP/JxPIFBLUJVhwDEGFMza5tZD2ibWSYpy7Ks2+v1XLfbZWZmhn6/j5kpz/POeDyeCyG8H2PMGo10JaWtVgu3u0ZcD7AG7IKNDwFoXM41gkrMLEoiTVM3NTWlfr9Pv9+n3W5TliVZlsk5125Sl9SGSyIplYR/6NEysAK2W9eRQwGccxEIDYwBeYyxcs5Zp9NRq9Wqa0RZUhSFxRgrMwvNySglBcCbGXoPbBPcNsRBrZCnAqRpSlVVhXNuImkMFMCkLMutwWAwnWVZq6oqnHPs7OwwGAyKsiy3gZzabvLmJHhJxKU693Fc23AcHS5C75zLJY3MbChpYmYT7/2DwWCQFUXxXKfTaccYyfM8L4piJca43Kh/BOxJ2m5OhNdj8AVoAtkQysEzAEgam9kmsC7p+EFey7L03vuNyWQyDbgQwgDYALaAXTN73PzelZRfe+uWt6LuC2xQi7C/VBvGE8fNmze9cy53zm1JWgX+ZWbrZrYjaS3GeC+E8K73/q/APWDtALaWGisxxr2qqnK3AbYBPICpO5AtfWA0Tx2SfFPl1swsacRZmdlsc8ycJBqh7QPbZrYCPDCztRjj6MbvfuZjAd13Ptrpnrz/l8C/ccP/9NUf5cCWmRFjLCTtA7OSOgdzmJkHBjHGbUkrzrmNEMJelmW+dQfc/hMCfGr7dQX8aUjm4ScLdVU0s46kY5JmgN5/BOGBiZkNzWwvSZKRc85//zc3PI+gt3xEgPASmIPqLHAOkgvAS/Dj21dTSR3nXAq0Y4xIwjkXQgi+EW5+bXjLH3Q/+TKc+OcRAEZfg/aF+mG1DW6uroHuZXCfbhNnr/D6z7+VSiKEcABQNy/fuOHjHYjvAatg66D3oXP/ydXuw5F/BfznBa/0CL2M5O4I+4vHCrASrAoQB1z93opPkxcxSzDbxKo/kExuowegEhQAgyRCMn56uf3wOAf6bIf4xSto6nns1G3i0jIaAttgux6mVnDuLYLtgFooPsZVf4fhkLDRdL8F2ATCBFw8AkBwQMvhOtOEdBYd79RuMYS4Buk0uGxMDHexzirC1f9QRkNsOaAVsJ3a7Tio+ztHAHC7EJf2sftv42b/AXfX0RbECOkWWAo+gM7t42ZyDGFlxHbqTtet1r0/ozp6RpB+E/jVRwP8G3R7eXmZvRtYAAAAAElFTkSuQmCC"},VOne.Shaders={nodesCPS:{vertex:["attribute vec3 color;","attribute float size;","varying vec3 vColor;","void main() {","vColor = color;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * (600.0 / length( mvPosition.xyz ) );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 uniformsColor;","uniform sampler2D texture;","varying vec3 vColor;","void main() {","gl_FragColor = vec4( uniformsColor * vColor, 1.0 );","gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );","}"].join("\n")}},VOne.ThreeSceneManager=function(e,t){this.type="ThreeSceneManager",this._scene=e,this.sceneModel={},this.objectIndex=0,this._interactiveModels=t,this.camera=e.camera,this.controls=void 0,this.onRender=[],VOne.Scenes.push(this)},VOne.ThreeSceneManager.prototype={constructor:VOne.ThreeSceneManager,add:function(e,t,r){this.objectIndex++;var n=t||"g"+this.objectIndex;if(e.sceneManager=this,Array.isArray(e)){var o=r||new THREE.Object3D;return e.forEach(function(e){o.add(e)}),r||(this._scene.add(o),this.sceneModel[n]=o),o}if(r){var i=this.sceneModel[r];return i||(i=new THREE.Object3D,this.sceneModel[r]=i,this._scene.add(i)),this.sceneModel[r].add(e),this.sceneModel[r]}return this._scene.add(e),void(this.sceneModel[n]=e)},registerInteractiveBufferGeometry:function(e){var t;void 0===e.name?(t="bufferGeometry"+this.objectIndex,e.mesh.name=t):t=e.name,this._interactiveModels[t]=e,this._interactiveModels.add(e.mesh)},unRegisterInteractiveBufferGeometry:function(r){var n=this;this._scene.VOneData.interactiveObjects.forEach(function(e,t){if(e===r.mesh)return n._scene.VOneData.interactiveObjects.splice(t,1)})},registerInteractiveGeometry:function(e){var t=e.name;this._interactiveModels[t]=e;for(var r=0;r<e.mesh.length;r++)e.mesh[r].name=t,this._interactiveModels.add(e.mesh[r])},getLastObject:function(){var e=Object.keys(this.sceneModel),t=e[e.length-1];return this.sceneModel[t]},getObjectsCount:function(){return Object.keys(this.sceneModel).length},getObject:function(e){return this.sceneModel[e]},removeObject:function(e){this._scene.remove(this.sceneModel[e]),delete this.sceneModel[e]},getSceneObjects:function(){return this.sceneModel},removeLastObjectFromScene:function(e){var t,r=Object.keys(this.sceneModel);return e?(t=r[r.length-1],this._scene.remove(this.sceneModel[t]),delete this.sceneModel[t],!0):1<r.length&&(t=r[r.length-1],this._scene.remove(this.sceneModel[t]),delete this.sceneModel[t],!0)},clear:function(){for(var e=Object.keys(this.sceneModel),t=0;t<e.length;t++)this._scene.remove(this.sceneModel[e[t]]),delete this.sceneModel[e[t]]},setCameraPosition:function(e,t,r){this._scene.camera.position.set(e,t,r)},setOnRender:function(e,t,r){if("function"!=typeof e)console.error("ERROR: You must provide a function!");else{var n=r||"",o=t||[];this.onRender.push({id:n,fn:e,params:o})}},removeFromOnRenderById:function(e){if(e&&""!==e){for(var t,r=this.onRender.length,n=0;n<r;n++)if((t=this.onRender[n]).id===e)return this.onRender.splice(n,1),t}else console.warn("Can't remove a function without id.")},registerAnimationEngine:function(){var e=new VOne.AnimationEngine(this);this.setOnRender(e.animate,this,"animationEngine")},pauseRenderer:function(){this._scene.redererPaused=!0},resumeRenderer:function(){this._scene.redererPaused=!1},getMouse:function(){return this._scene.mouse},getMouseOnScreen:function(){return this._scene.mouseOnScreen}},VOne.RenderersManager={glRenderer:!1,clock:new THREE.Clock,scenesToRender:{},bgColor:0,bgAlpha:1,canvas:void 0,addScene:function(n,e){n.VOneData.rendererType;var t=!1;if(0===Object.keys(VOne.RenderersManager.scenesToRender).length&&(t=!0),n.VOneData.rendererClass===THREE.WebGLRenderer){VOne.RenderersManager.glRenderer||(VOne.RenderersManager.canvas=document.createElement("canvas"),VOne.RenderersManager.canvas.style.width="100%",VOne.RenderersManager.canvas.style.height="100%",VOne.RenderersManager.canvas.style.top="0",VOne.RenderersManager.canvas.style.left="0",VOne.RenderersManager.canvas.style.zIndex="-1",VOne.RenderersManager.canvas.style.position="fixed",document.body.appendChild(VOne.RenderersManager.canvas),VOne.RenderersManager.scenesToRender.glRenderer={scenes:[]},VOne.RenderersManager.glRenderer=new THREE.WebGLRenderer({canvas:VOne.RenderersManager.canvas,alpha:!0,antialias:!0}),VOne.RenderersManager.glRenderer.setClearColor(VOne.RenderersManager.bgColor,VOne.RenderersManager.bgAlpha),VOne.RenderersManager.glRenderer.setPixelRatio(window.devicePixelRatio)),n.VOneData.id=e,VOne.RenderersManager.scenesToRender.glRenderer.scenes.push(n),n.VOneData.renderer=VOne.RenderersManager.glRenderer;var r=parseInt(n.VOneData.container.style.width.substr(0,n.VOneData.container.style.width.indexOf("px"))),o=parseInt(n.VOneData.container.style.height.substr(0,n.VOneData.container.style.height.indexOf("px")));n.VOneData.container.widthRelation=r/window.innerWidth,n.VOneData.container.heightRelation=o/window.innerHeight,n.onMouseMove=function(e){e.preventDefault();var t=e.target.getBoundingClientRect();n.mouse.x=e.offsetX/t.width*2-1,n.mouse.y=-e.offsetY/t.height*2+1,n.mouseOnScreen.x=e.offsetX,n.mouseOnScreen.y=e.offsetY},n.onMouseClick=function(e){if(e.preventDefault(),null!==n.VOneData.INTERSECTED){var t=n.VOneData.interactiveModels[n.VOneData.lastInteractiveModelName];if("function"==typeof t.onClick)if(n.VOneData.intersections.isBufferGeometry){var r=n.VOneData.interactiveModels[n.VOneData.lastInteractiveModelName].dataModel[n.VOneData.INTERSECTED];t.onClick(r,n.VOneData.INTERSECTED)}else t.onClick(n.VOneData.intersections.intersectedInterestProperty)}}}else VOne.RenderersManager.scenesToRender.otherRenderer||(VOne.RenderersManager.scenesToRender.otherRenderer={scenes:[]}),VOne.RenderersManager.scenesToRender.otherRenderer.scenes.push(n),n.VOneData.renderer=new n.VOneData.rendererClass({alpha:!0,antialias:!0}),n.VOneData.renderer.setSize(n.VOneData.containerDimensions.width,n.VOneData.containerDimensions.height),n.VOneData.container.appendChild(n.VOneData.renderer.domElement),n.VOneData.widthRelation=n.VOneData.containerDimensions.width/window.innerWidth,n.VOneData.heightRelation=n.VOneData.containerDimensions.height/window.innerHeight;(n.VOneData.renderer.sortObjects=!0,n.VOneData.intersections={},n.VOneData.rendererProperties)&&Object.keys(n.VOneData.rendererProperties).forEach(function(e){n.VOneData.renderer[e]=n.VOneData.rendererProperties[e]});n.VOneData.container.addEventListener("mousemove",n.onMouseMove,!1),n.VOneData.container.addEventListener("click",n.onMouseClick,!1),t&&VOne.RenderersManager.animate()},removeSceneById:function(e){},updateRendererSize:function(){},animate:function(){requestAnimationFrame(VOne.RenderersManager.animate),VOne.RenderersManager.renderScenes()},renderScenes:function(){for(var e=Object.keys(VOne.RenderersManager.scenesToRender),d=VOne.RenderersManager.clock.getDelta(),t=0;t<e.length;t++){var r=VOne.RenderersManager.scenesToRender[e[t]].scenes,a=window.innerWidth,s=window.innerHeight;"glRenderer"===e[t]?(VOne.RenderersManager.canvas.width===a&&VOne.RenderersManager.canvas.height==s||(VOne.RenderersManager.scenesToRender.glRenderer.scenes.forEach(function(e){var t=e.VOneData.containerDimensions?e.VOneData.containerDimensions.width/e.VOneData.containerDimensions.height:a/s;if("div"===e.VOneData.containerType){var r=e.VOneData.container.widthRelation*a,n=e.VOneData.container.heightRelation*s;e.VOneData.container.style.width=r+"px",e.VOneData.container.style.height=n+"px"}e.camera.aspect=t,e.camera.updateProjectionMatrix()}),VOne.RenderersManager.glRenderer.setPixelRatio(window.devicePixelRatio),VOne.RenderersManager.glRenderer.setSize(a,s,!1)),VOne.RenderersManager.glRenderer.setClearColor(VOne.RenderersManager.bgColor,VOne.RenderersManager.bgAlpha),VOne.RenderersManager.glRenderer.setScissorTest(!1),VOne.RenderersManager.glRenderer.clear(),VOne.RenderersManager.glRenderer.setScissorTest(!0),r.forEach(function(e){if(e.visible){if(0<e.VOneData.interactiveObjects.length){e.VOneData.raycaster.setFromCamera(e.mouse,e.camera);var t,r,n=e.VOneData.raycaster.intersectObjects(e.VOneData.interactiveObjects);if(0<n.length){if(n[0].object.geometry&&"BufferGeometry"===n[0].object.geometry.type){var o=n[0];if(o.faceIndex&&null!==o.faceIndex){e.VOneData.lastInteractiveModelName=n[0].object.name;var i=Math.floor(o.faceIndex*e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName].dataModel.length/n[0].object.geometry.attributes.position.count);e.VOneData.intersections.intersectedInterestProperty=i}else e.VOneData.intersections.intersectedInterestProperty=n[0].index;e.VOneData.intersections.isBufferGeometry=!0}else"Mesh"===n[0].object.type&&(e.VOneData.intersections.intersectedInterestProperty=n[0].object,e.VOneData.intersections.isBufferGeometry=!1);e.VOneData.INTERSECTED!=e.VOneData.intersections.intersectedInterestProperty&&(null!==e.VOneData.INTERSECTED&&"function"==typeof(t=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName]).onMouseOut&&(e.VOneData.intersections.isBufferGeometry?(r=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName].dataModel[e.VOneData.INTERSECTED],t.onMouseOut(r,e.VOneData.INTERSECTED)):t.onMouseOut(e.VOneData.intersections.intersectedInterestProperty)),e.VOneData.INTERSECTED=e.VOneData.intersections.intersectedInterestProperty,e.VOneData.lastInteractiveModelName=n[0].object.name,"function"==typeof(t=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName]).onMouseOver&&(e.VOneData.intersections.isBufferGeometry?(r=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName].dataModel[e.VOneData.INTERSECTED],t.onMouseOver(r,e.VOneData.INTERSECTED)):t.onMouseOver(e.VOneData.intersections.intersectedInterestProperty)))}else null!==e.VOneData.INTERSECTED&&("function"==typeof(t=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName]).onMouseOut&&(e.VOneData.intersections.isBufferGeometry?(r=e.VOneData.interactiveModels[e.VOneData.lastInteractiveModelName].dataModel[e.VOneData.INTERSECTED],t.onMouseOut(r,e.VOneData.INTERSECTED)):t.onMouseOut(e.VOneData.intersections.intersectedInterestProperty)),e.VOneData.INTERSECTED=null)}e.VOneData.controls&&e.VOneData.controls.update(d),0<e.VOneData.sceneManager.onRender.length&&e.VOneData.sceneManager.onRender.forEach(function(e){e.fn(e.params,d)});var a=e.VOneData.container.getBoundingClientRect();if(0<a.bottom||a.top<e.VOneData.renderer.domElement.clientHeight||0<a.right||a.left<e.VOneData.renderer.domElement.clientWidth){var s=a.right-a.left,l=a.bottom-a.top,h=a.left,c=e.VOneData.renderer.domElement.clientHeight-a.bottom;e.VOneData.renderer.setViewport(h,c,s,l),e.VOneData.renderer.setScissor(h,c,s,l),VOne.RenderersManager.glRenderer.setClearColor(e.VOneData.bgColor,e.VOneData.bgAlpha),e.VOneData.renderer.render(e,e.camera)}}})):r.forEach(function(e){var t,r,n=!1,o=e.VOneData.renderer.domElement.getBoundingClientRect();if(o.width/a!==e.VOneData.widthRelation&&(t=window.innerWidth*e.VOneData.widthRelation,e.VOneData.container.style.width=t+"px",n=!0),o.height/s!==e.VOneData.heightRelation&&(r=window.innerHeight*e.VOneData.heightRelation,e.VOneData.container.style.height=r+"px",n=!0),n){e.VOneData.renderer.setSize(t||window.innerWidth*e.VOneData.widthRelation,r||window.innerHeight*e.VOneData.heightRelation);var i=a/s;e.camera.aspect=i,e.camera.updateProjectionMatrix()}e.VOneData.controls&&e.VOneData.controls.update(d),0<e.VOneData.sceneManager.onRender.length&&e.VOneData.sceneManager.onRender.forEach(function(e){e.fn(e.params)}),e.VOneData.renderer.render(e,e.camera)})}}},VOne.CPSBufferGeometriesGenerator=function(){var e={generateGeometries:function(t,e,r,n){t.interactive;var o,i,a,s,l=r,h=t.hasRelations||!1,c=t.elementZPos||function(e){return 1e3*Math.random()},d=t.elementSize?"function"==typeof t.elementSize?t.elementSize:function(e){return t.elementSize}:function(e){return 250},u=t.elementColor?"function"==typeof t.elementColor?t.elementColor:function(e){return t.elementColor}:function(e){return"pink"},p=t.elementAlpha?t.elementAlpha:.9;if(void 0!==l){h&&(s=new Float32Array(6*l.length),o=t.relationsLinesColor?"function"==typeof t.relationsColor?t.relationsColor:function(e){return t.relationsColor}:function(e){return[7829367,7829367]},i=t.relationsLineWidth||.5,a=t.relationsLinesAlpha?t.relationsLinesAlpha:1);var f,y,g=new Float32Array(3*l.length),m=new Float32Array(l.length),v=new Float32Array(3*l.length),A=new THREE.BufferGeometry;l.forEach(function(e,t){g[3*t]=e.position.x,g[3*t+1]=e.position.y,e.position.z=e.position.z||c(e),g[3*t+2]=isNaN(e.position.z)?0:e.position.z,m[t]=d(e),e.size=m[t];var r=new THREE.Color(u(e));v[3*t]=r.r,v[3*t+1]=r.g,v[3*t+3]=r.b,e.color=r,h&&e.parent&&(s[6*t]=e.position.x,s[6*t+1]=e.position.y,s[6*t+2]=e.position.z,s[6*t+3]=e.parent.position.x,s[6*t+4]=e.parent.position.y,e.parent.position.z||(e.parent.position.z=c(e.parent)),s[6*t+5]=e.parent.position.z)});var O=new THREE.TextureLoader;y=t.texturePath?O.load(t.texturePath):O.load(VOne.DefaultImages.star);var E={uniformsColor:{type:"c",value:new THREE.Color(16777215)},texture:{type:"t",value:y}},V=new THREE.ShaderMaterial({uniforms:E,vertexShader:VOne.Shaders.nodesCPS.vertex,fragmentShader:VOne.Shaders.nodesCPS.fragment,blending:THREE.AdditiveBlending,depthTest:!0,transparent:p<1,opacity:p});A.addAttribute("position",new THREE.BufferAttribute(g,3)),A.addAttribute("color",new THREE.BufferAttribute(v,3)),A.addAttribute("size",new THREE.BufferAttribute(m,1));var M=new THREE.Points(A,V);if(M.name=n+"Nodes",e.add(M,M.name),h){(f=new THREE.BufferGeometry).addAttribute("position",new THREE.BufferAttribute(s,3));var w=new THREE.Line(f,new THREE.LineBasicMaterial({lineWidth:i,color:o[0],transparent:!0,opacity:a}));w.name=n+"Relations",e.add(w,w.name)}return new VOne.GeometryModel(n,M,l,A.attributes)}console.error("ERROR: A data model is required.")}};return e},VOne.GraphGeometriesGenerator=function(e,t){if(this.type="VOne.GeometriesGenerator",!e)return console.error("You must provide a VOne.graph."),-1;this.graph=e,this.textureMap=t||{default:{color:"pink",scale:10}},this.geometries=[],this.relationsBufferGeometry=new THREE.BufferGeometry,this.relations=new Float32Array(3*e.edges.length),this.lineMaterial=new THREE.LineBasicMaterial({linewidth:.1,color:16777215,transparent:!0,opacity:.8})},VOne.GraphGeometriesGenerator.prototype={constructor:VOne.GraphGeometriesGenerator},VOne.GraphGeometriesGenerator.prototype.buildGeometries=function(e){var o=this.textureMap,n=new THREE.TextureLoader,i=this;Object.keys(o).forEach(function(e){var t;t=e.texturePath?n.load(o[e].texturePath):n.load(VOne.DefaultImages.star);var r=new THREE.Color(o[e].color);o[e].material=new THREE.SpriteMaterial({map:t,color:r})}),this.graph.nodes.forEach(function(t){var e=void 0===t.type?"default":t.type,r=new THREE.Sprite(o[e].material),n=t.position.clone();r.position.set(n.x,n.y,n.z),r.scale.x=r.scale.y=r.scale.z=o[e].scale,t.sprite=r,t.update=function(){var e=t.position.clone();r.position.set(e.x,e.y,e.z)},i.geometries.push(r)}),this.graph.edges.forEach(function(r,n){r.update=function(){var e=r.from.position.clone(),t=r.to.position.clone();i.relations[6*n]=e.x,i.relations[6*n+1]=e.y,i.relations[6*n+2]=e.z,i.relations[6*n+3]=t.x,i.relations[6*n+4]=t.y,i.relations[6*n+5]=t.z,i.relationsBufferGeometry.attributes.position&&(i.relationsBufferGeometry.attributes.position.needsUpdate=!0)},r.update()}),i.relationsBufferGeometry.addAttribute("position",new THREE.BufferAttribute(i.relations,3));var t=new THREE.LineSegments(i.relationsBufferGeometry,i.lineMaterial);return{nodes:this.geometries,relations:t}},VOne.GenericBufferGeometriesGenerator=function(p){this.generator={},this.generator.generateFromModel=function(){if(!this.model)throw new Error("A model is required to generate a points geometry. Use setModel(model) to set one.");var e=!1,t=p?new VOne.InstancedBufferGeometryModel(this.model):new VOne.BufferGeometryModel(this.model),r=this.model.length,n=new THREE.BufferGeometry;if(void 0!==this.setPosition){var o,i=new Float32Array(3*r);if("function"==typeof this.setPosition)for(var a=0;a<r;a++)o=this.setPosition(this.model[a],a),this.model[a].position=o,i[3*a]=o.x,i[3*a+1]=o.y,i[3*a+2]=o.z;else for(a=0;a<r;a++)o=this.setPosition,this.model[a].position=o,i[3*a]=o.x,i[3*a+1]=o.y,i[3*a+2]=o.z;t.setPositionArray(i),n.addAttribute("position",new THREE.BufferAttribute(i,3)),e=!0}if(void 0!==this.setColor){var s,l=new Float32Array(3*r);if("function"==typeof this.setColor)for(a=0;a<r;a++)s=this.setColor(this.model[a]),this.model[a].color=s,l[3*a]=s.r,l[3*a+1]=s.g,l[3*a+2]=s.b;else for(a=0;a<r;a++)s=this.setColor,this.model[a].color=s,l[3*a]=s.r,l[3*a+1]=s.g,l[3*a+2]=s.b;t.setColorArray(l),n.addAttribute("color",new THREE.BufferAttribute(l,3)),e=!0}if(void 0!==this.setSize){var h,c=new Float32Array(r);if("function"==typeof this.setSize)for(a=0;a<r;a++)h=this.setSize(this.model[a],a),this.model[a].size=h,c[a]=h;else for(a=0;a<r;a++)h=this.setSize,this.model[a].size=h,c[a]=h;t.setSizeArray(c),n.addAttribute("size",new THREE.BufferAttribute(c,1)),e=!0}if(void 0!==this.setAlpha){var d,u=new Float32Array(r);if("function"==typeof this.setAlpha)for(a=0;a<this.model.length;a++)d=this.setAlpha(this.model[a],a),this.model[a].alpha=d,u[a]=d;else for(a=0;a<this.model.length;a++)d=this.setAlpha,this.model[a].alpha=d,u[a]=d;t.setAlphaArray(u),n.addAttribute("alpha",new THREE.BufferAttribute(u,1)),e=!0}return e?(t.setGeometry(n),t):(console.error("no geometry generated. Try setting position, color, size or alpha first."),-1)}},VOne.GenericBufferGeometriesGenerator.prototype={constructor:VOne.GenericBufferGeometriesGenerator,setModel:function(e){return this.generator.model=e,this},setPosition:function(e){return this.generator.setPosition=e,this},setColor:function(e){return this.generator.setColor=e,this},setSize:function(e){return this.generator.setSize=e,this},setAlpha:function(e){return this.generator.setAlpha=e,this},generate:function(){return this.generator.generateFromModel()}},VOne.RelationshipBufferGeometriesGenerator=function(){this.generator={},this.generator.generateFromModel=function(){if(!this.model)throw new Error("A model is required to generate a points geometry. Use setModel(model) to set one.");for(var e=new VOne.BufferGeometryModel(this.model),t=this.model.length,r=new THREE.BufferGeometry,n=0,o=0;o<t;o++)"parent"in this.model[o]&&n++;if(0!==n){var i,a,s,l,h,c,d,u,p=new Float32Array(6*n);this.setColor&&(i=new Float32Array(6*n)),this.setAlpha&&(a=new Float32Array(2*n));for(o=0;o<t;o++)"parent"in this.model[o]&&(s=this.model[o],l=this.model[o].parent,h={x:this.model[o].position.x,y:this.model[o].position.y,z:this.model[o].position.z},c={x:this.model[o].parent.position.x,y:this.model[o].parent.position.y,z:this.model[o].parent.position.z},p[6*o]=h.x,p[6*o+1]=h.y,p[6*o+2]=h.z,p[6*o+3]=c.x,p[6*o+4]=c.y,p[6*o+5]=c.z,s.relationshipsFirstIndex=6*o,l.relationshipsFirstIndex=6*o+3,this.setColor&&("function"==typeof this.setColor?(d=this.setColor(s),i[6*o]=d[0].r,i[6*o+1]=d[0].g,i[6*o+2]=d[0].b,i[6*o+3]=d[1].r,i[6*o+4]=d[1].g,i[6*o+5]=d[1].b):(i[6*o]=this.setColor[0].r,i[6*o+1]=this.setColor[0].g,i[6*o+2]=this.setColor[0].b,i[6*o+3]=this.setColor[1].r,i[6*o+4]=this.setColor[1].g,i[6*o+5]=this.setColor[1].b)),this.setAlpha&&("function"==typeof this.setAlpha?(u=this.setAlpha(s),a[2*o]=u[0],a[2*o+1]=u[1]):(a[2*o]=this.setAlpha[0],a[2*o+1]=this.setAlpha[1])));return e.setPositionArray(p),r.addAttribute("position",new THREE.BufferAttribute(p,3)),this.setColor&&(e.setColorArray(i),r.addAttribute("color",new THREE.BufferAttribute(i,3))),this.setAlpha&&(e.setAlphaArray(a),r.addAttribute("alpha",new THREE.BufferAttribute(a,1))),e.setGeometry(r),e}console.error("No element within the provided model has <parent> property.")}},VOne.RelationshipBufferGeometriesGenerator.prototype={constructor:VOne.RelationshipBufferGeometriesGenerator,setDataModel:function(e){return this.generator.model=e,this},setColor:function(e){return this.generator.setColor=e,this},setAlpha:function(e){return this.generator.setAlpha=e,this},generate:function(){return this.generator.generateFromModel()}},VOne.PieSlice=function(e){var t=e.startAngle*(e.angleInRadians?1:VOne.degToRad),r=e.endAngle*(e.angleInRadians?1:VOne.degToRad),n=e.color||new THREE.Color;this.shape=new THREE.Shape,this.alpha=e.alpha||1;var o={x:Math.cos(t)*e.innerRadius,y:Math.sin(t)*e.innerRadius};Math.cos(r),e.outerRadius,Math.sin(r),e.outerRadius;this.shape.moveTo(o.x,o.y),this.shape.absarc(0,0,e.innerRadius,t,r),this.shape.absarc(0,0,e.outerRadius,r,t,!0),this.createSliceBufferGeometry(e.height,n)},VOne.PieSlice.prototype.constructor=VOne.PieSlice,VOne.PieSlice.prototype.calculateArcPoints=function(e,t,r){return{startX:Math.cos(e)*r,startY:Math.sin(e)*r,midX:Math.cos((t+e)/2)*r,midY:Math.sin((t+e)/2)*r,endX:Math.cos(t)*r,endY:Math.sin(t)*r}},VOne.PieSlice.prototype.createSliceBufferGeometry=function(e,t){var r={depth:e,bevelEnabled:!1,steps:1,curveSegments:16,dynamic:!0};this.sliceGeometry=new THREE.ExtrudeGeometry(this.shape,r);var n,o=this.sliceGeometry.faces.length,i=new Float32Array(9*o),a=new Float32Array(9*o),s=new Float32Array(9*o),l=new Float32Array(3*o);this.geometry=new THREE.BufferGeometry;for(var h=0;h<this.sliceGeometry.faces.length;h++)n=this.sliceGeometry.faces[h],i[9*h]=this.sliceGeometry.vertices[n.a].x,i[9*h+1]=this.sliceGeometry.vertices[n.a].y,i[9*h+2]=this.sliceGeometry.vertices[n.a].z,i[9*h+3]=this.sliceGeometry.vertices[n.b].x,i[9*h+4]=this.sliceGeometry.vertices[n.b].y,i[9*h+5]=this.sliceGeometry.vertices[n.b].z,i[9*h+6]=this.sliceGeometry.vertices[n.c].x,i[9*h+7]=this.sliceGeometry.vertices[n.c].y,i[9*h+8]=this.sliceGeometry.vertices[n.c].z,a[9*h]=n.normal.x,a[9*h+1]=n.normal.y,a[9*h+2]=n.normal.z,a[9*h+3]=n.normal.x,a[9*h+4]=n.normal.y,a[9*h+5]=n.normal.z,a[9*h+6]=n.normal.x,a[9*h+7]=n.normal.y,a[9*h+8]=n.normal.z,s[9*h]=t.r,s[9*h+1]=t.g,s[9*h+2]=t.b,s[9*h+3]=t.r,s[9*h+4]=t.g,s[9*h+5]=t.b,s[9*h+6]=t.r,s[9*h+7]=t.g,s[9*h+8]=t.b,l[3*h]=this.alpha,l[3*h+1]=this.alpha,l[3*h+2]=this.alpha;this.geometry.addAttribute("position",new THREE.BufferAttribute(i,3)),this.geometry.addAttribute("normal",new THREE.BufferAttribute(a,3)),this.geometry.addAttribute("color",new THREE.BufferAttribute(s,3)),this.geometry.addAttribute("alpha",new THREE.BufferAttribute(l,1)),this.geometry.computeBoundingBox()},VOne.PieSlice.prototype.getGeometry=function(){return this.geometry},VOne.PieSlice.prototype.getEdgesGeometry=function(e){for(var t=e.color||new THREE.Color,r=e.alpha||1,n=new THREE.EdgesGeometry(this.geometry),o=n.attributes.position.count,i=new Float32Array(3*o),a=new Float32Array(o),s=0;s<o;s++)i[3*s]=t.r,i[3*s+1]=t.g,i[3*s+2]=t.b,a[s]=r;return n.addAttribute("color",new THREE.BufferAttribute(i,3)),n.addAttribute("alpha",new THREE.BufferAttribute(a,1)),n},VOne.BufferGeometriesFactory=function(){this.type="BufferGeometriesFactory"},VOne.BufferGeometriesFactory.prototype={constructor:VOne.BufferGeometriesFactory,build:function(e,t){if(!t.fromClass||!t.usingArgs||!e)return console.error("Error! fromClass, args and records are required!"),new Error("Error! fromClass, args and records are required!");var r=!1,n=[];t.usingArgs.forEach(function(e,t){"function"==typeof e&&(r=!0,n.push({index:t,f:e}))});var o=e[0],i=void 0;r?(i=[],t.usingArgs.forEach(function(e){var t=void 0;t="function"==typeof e?e(o):e,i.push(t)})):i=t.usingArgs;for(var a=new(Function.prototype.bind.apply(t.fromClass,[null].concat(_toConsumableArray(i)))),s=a.attributes.position.array.length,l=a.index?a.index.array.length:0,h=l?Math.max.apply(Math,_toConsumableArray(a.index.array))+1:0,c=s/3,d=new Float32Array(s*e.length),u=t.setColor?new Float32Array(d.length):void 0,p=t.setAlpha?new Float32Array(d.length/3):void 0,f=a.index?new Uint32Array(l*e.length):void 0,y=void 0,g=[].concat(_toConsumableArray(t.usingArgs)),m=0;m<e.length;m++){y=e[m],r&&n.forEach(function(e){g[e.index]=e.f(y)});var v=new(Function.prototype.bind.apply(t.fromClass,[null].concat(_toConsumableArray(g)))),A=void 0;A=t.setPosition?"function"==typeof t.setPosition?t.setPosition(y,m):t.setPosition:{x:0,y:0,z:0};for(var O=0;O<s/3;O++){if(d[3*O+s*m]=v.attributes.position.array[3*O]+A.x,d[3*O+1+s*m]=v.attributes.position.array[3*O+1]+A.y,d[3*O+2+s*m]=v.attributes.position.array[3*O+2]+A.z,t.setColor){var E=void 0;E="function"==typeof t.setColor?t.setColor(y,m):t.setColor,u[3*O+s*m]=E.r,u[3*O+1+s*m]=E.g,u[3*O+2+s*m]=E.b}if(t.setAlpha){var V=void 0;V="function"==typeof t.setAlpha?t.setAlpha(y,m):t.setAlpha,p[O+c*m]=V}}for(var M=0;M<l;M++)f[M+l*m]=v.index.array[M]+h*m}var w=new VOne.BufferGeometryModel(e),b=new THREE.BufferGeometry;return b.addAttribute("position",new THREE.BufferAttribute(d,3)),w.setPositionArray(d),t.setColor&&(w.setColorArray(u),b.addAttribute("color",new THREE.BufferAttribute(u,3))),t.setAlpha&&(w.setAlphaArray(p),b.addAttribute("alpha",new THREE.BufferAttribute(p,1))),l&&b.setIndex(new THREE.BufferAttribute(f,1)),b.computeBoundingSphere(),w.setGeometry(b),w.setVerticesCount(s/3),w}},VOne.ExtendedLine=function(e,t){e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry?(this.settings=t||{},this.setGeometry(e)):this.settings=e||{},void 0!==this.settings.lineWidth?this.setWidth(this.settings.lineWidth):this.setWidth(1)},VOne.ExtendedLine.prototype.constructor=VOne.ExtendedLine,VOne.ExtendedLine.prototype.setGeometry=function(e){if(e instanceof THREE.BufferGeometry)this.geometry=e,this.positionArray=e.attributes.position.array,e.attributes.color&&(this.settings.vertexColor=!0),e.attributes.alpha?this.settings.vertexAlpha=!0:this.setAlpha(1);else{if(this.geometry=new THREE.BufferGeometry,e instanceof THREE.Geometry){this.positionArray=new Float32Array(3*e.vertices.length);for(var t=0;t<e.vertices.length;t++)this.positionArray[3*t]=e.vertices[t].x,this.positionArray[3*t+1]=e.vertices[t].y,this.positionArray[3*t+2]=e.vertices[t].z;this.geometry.addAttribute("position",new THREE.BufferAttribute(this.positionArray,3))}this.setAlpha(1)}this.setupGeometry()},VOne.ExtendedLine.prototype.setupGeometry=function(){var e=this.positionArray.length/6;if(this.geometry.attributes.uv)this.uvArray=this.geometry.attributes.uv;else{this.uvArray=new Float32Array(4*e);for(var t=0;t<e;t++){var r=t/(e-1);this.uvArray[4*t]=r,this.uvArray[4*t+1]=0,this.uvArray[4*t+2]=r,this.uvArray[4*t+3]=1}this.geometry.addAttribute("uv",new THREE.BufferAttribute(this.uvArray,2))}if(this.nextPoints=new Float32Array(this.positionArray.length),this.prevPoints=new Float32Array(this.positionArray.length),this.prevPoints[0]=this.positionArray[0],this.prevPoints[1]=this.positionArray[1],this.prevPoints[2]=this.positionArray[2],this.settings.lineSegments)for(var n=0;n<e;n++)this.prevPoints[6*n]=this.positionArray[6*n],this.prevPoints[6*n+1]=this.positionArray[6*n+1],this.prevPoints[6*n+2]=this.positionArray[6*n+2],this.prevPoints[6*n+3]=this.positionArray[6*n],this.prevPoints[6*n+4]=this.positionArray[6*n+1],this.prevPoints[6*n+5]=this.positionArray[6*n+2],this.nextPoints[6*n]=this.positionArray[6*n+3],this.nextPoints[6*n+1]=this.positionArray[6*n+4],this.nextPoints[6*n+2]=this.positionArray[6*n+5],this.nextPoints[6*n+3]=this.positionArray[6*n+3],this.nextPoints[6*n+4]=this.positionArray[6*n+4],this.nextPoints[6*n+5]=this.positionArray[6*n+5];else for(var o=3;o<this.positionArray.length;o++)this.prevPoints[o]=this.positionArray[o-3],this.nextPoints[o-3]=this.positionArray[o];this.nextPoints[this.positionArray.length-3]=this.positionArray[this.positionArray.length-3],this.nextPoints[this.positionArray.length-2]=this.positionArray[this.positionArray.length-2],this.nextPoints[this.positionArray.length-1]=this.positionArray[this.positionArray.length-1],this.geometry.addAttribute("nextPoint",new THREE.BufferAttribute(this.nextPoints,3)),this.geometry.addAttribute("prevPoint",new THREE.BufferAttribute(this.prevPoints,3)),this.sideArray=new Float32Array(2*e);for(var i=0;i<e;i++)this.sideArray[2*i]=1,this.sideArray[2*i+1]=-1;if(this.geometry.addAttribute("side",new THREE.BufferAttribute(this.sideArray,1)),this.geometry.index)this.indexArray=this.geometry.index.array;else{if(this.settings.lineSegments){this.indexArray=new Uint16Array(this.positionArray.length/2-6);for(var a=0;a<e/2-1;a++){var s=2*a;this.indexArray[6*a]=s,this.indexArray[6*a+1]=s+1,this.indexArray[6*a+2]=s+2,this.indexArray[6*a+3]=s+2,this.indexArray[6*a+4]=s+1,this.indexArray[6*a+5]=s+3}}else{this.indexArray=new Uint16Array(this.positionArray.length-6);for(var l=0;l<e-1;l++){var h=2*l;this.indexArray[6*l]=h,this.indexArray[6*l+1]=h+1,this.indexArray[6*l+2]=h+2,this.indexArray[6*l+3]=h+2,this.indexArray[6*l+4]=h+1,this.indexArray[6*l+5]=h+3}}this.geometry.setIndex(new THREE.BufferAttribute(this.indexArray,1))}},VOne.ExtendedLine.prototype.setWidth=function(e){if(e instanceof Float32Array)this.geometry.addAttribute("width",new THREE.BufferAttribute(e,1)),this.settings.vertexWidth=!0;else if(Array.isArray(e)){var t=new Float32Array(e);this.geometry.addAttribute("width",new THREE.BufferAttribute(t,1)),this.settings.vertexWidth=!0}else"number"==typeof e&&(this.settings.width=e,this.settings.vertexWidth=!1)},VOne.ExtendedLine.prototype.setAlpha=function(e){if(e instanceof Float32Array)this.geometry.addAttribute("alpha",new THREE.BufferAttribute(e,1)),this.settings.vertexAlpha=!0;else if(Array.isArray(e)){var t=new Float32Array(e);this.geometry.addAttribute("alpha",new THREE.BufferAttribute(t,1)),this.settings.vertexAlpha=!0}else"number"==typeof e&&(this.settings.alpha=e,this.settings.vertexAlpha=!1)},VOne.ExtendedLine.prototype.setColor=function(e){return e instanceof Float32Array?(this.geometry.addAttribute("color",new THREE.BufferAttribute(e,3)),void(this.settings.vertexColor=!0)):e instanceof THREE.BufferAttribute?(this.geometry.addAttribute("color",e),void(this.settings.vertexColor=!0)):void 0},VOne.ExtendedLine.prototype.getVertexShader=function(){return"\n        attribute vec3 prevPoint;\n        attribute vec3 nextPoint;\n        attribute float side;\n\n        "+(this.settings.vertexWidth?"attribute float width;":"uniform float width;")+"\n        "+(this.settings.vertexAlpha?"attribute float alpha;":"uniform float alpha;")+"\n        "+(this.settings.vertexColor?"attribute vec3 color;":"uniform vec3 color;")+"\n\n        varying vec2 vUV;\n        varying vec4 vColor;\n\n\n        void main() {\n\n            float pixelWidthFactor = 1.0 / projectionMatrix[0][0];\n\n            vColor = vec4( color, alpha );\n            vUV = uv;\n\n            // mat4 m = projectionMatrix * modelViewMatrix;\n\n            vec4 finalPosition = modelViewMatrix * vec4(position, 1.0);\n            vec4 prevPosition = modelViewMatrix * vec4(prevPoint, 1.0);\n            vec4 nextPosition = modelViewMatrix * vec4(nextPoint, 1.0);\n\n            vec2 dir;\n\n            vec2 current = finalPosition.xy / finalPosition.w;\n            vec2 previous = prevPosition.xy / prevPosition.w;\n            vec2 next = nextPosition.xy / nextPosition.w;\n\n            float widthCorrection = 1.8 * finalPosition.w * width * pixelWidthFactor;\n\n            if(next == previous) dir = normalize(current - previous);\n            else if (previous == current) dir = normalize(next  - current);\n            else {\n                vec2 dirA = normalize(current - previous);\n                vec2 dirB = normalize(next - current);\n\n                dir = normalize(dirA + dirB);\n            }\n\n            vec2 normal = vec2(-dir.y, dir.x);\n\n            normal *= widthCorrection / 2.0;\n\n            vec4 offset = vec4(normal * side, 0.0, 1.0);\n\n            finalPosition.xy += offset.xy;\n\n            gl_Position = projectionMatrix * finalPosition;\n\n        }\n\n    "},VOne.ExtendedLine.prototype.getFragmentShader=function(){return"\n        varying vec4 vColor;\n\n        void main(){\n\n            gl_FragColor = vColor;\n\n        }\n    "},VOne.ExtendedLine.prototype.getLineShaders=function(){var e={};return this.settings.vertexWidth||(e.width={value:this.settings.width}),this.settings.vertexColors||(e.color={value:this.settings.color||new THREE.Color(16777215)}),this.settings.vertexAlpha||(e.alpha={value:this.settings.alpha}),{fragmentShader:this.getFragmentShader(),vertexShader:this.getVertexShader(),uniforms:e}},VOne.ExtendedLine.prototype.getGeometry=function(){return this.geometry},VOne.LeapGrabControls=function(e,t){if(!e)return console.error("No scene provided to VOne.LeapGrabControls. Can't start."),-1;this.config=t||{};var h=this;this.sceneManager=e;var c=this.config.objectToControl||e.camera,r=this.config.panSpeed||.02,n=this.config.rotationSpeed||.05,d=(this.config.zoomSpeed,new THREE.Vector2),u=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Vector2,y=1;this.target=new THREE.Vector3;var g,m=0,v=1/0,A=this.pointingFlag=!1,O=!1,E=!1,V=!1,M=!1,w=void 0===this.config.useHelperDiv||this.config.useHelperDiv,b=new THREE.Vector3;b.subVectors(c.position,this.target),this.objectToControl&&this.startControls(),this.startControls=function(){if(console.info("starting leapmotion grab controls"),w){var s=document.createElement("div");s.id="VOneRightHandDiv",s.style="position: fixed; right: 0; bottom: 0; width: 25%; height: 0; border: solid 1px #eee;",document.body.appendChild(s);var l=document.createElement("div");l.id="VOneLeftHandDiv",l.style="position: fixed; left: 0; bottom: 0; width: 25%; height: 0; border: solid 1px #eee;",document.body.appendChild(l)}(g=new Leap.Controller({enableGestures:!0})).setBackground(!0),g.loop(function(e){if(0<e.hands.length){h.sceneManager.controls&&(h.sceneManager.controls.enabled=!1),pointingFlag=!0;for(var t=g.frame(1),r=0;r<e.hands.length;r++){var n,o=e.hands[r];if(n=1===o.grabStrength?"closed":"open","right"===o.type){var i=o.translation(t);"open"===n?(w&&(s.style.borderColor="green"),V||(d.setX(i[0]),d.setY(i[1]),u.copy(d)),O=!(M=!0)):(w&&(s.style.borderColor="yellow"),V=!1,u.setX(i[0]),u.setY(i[1]),O=!0),1===e.hands.length&&(l.style.borderColor="#eee",E=M=!1)}else{var a=o.translation(t);"open"===n?(w&&(l.style.borderColor="green"),V||(p.setX(a[0]),p.setY(a[1]),f.copy(p)),A=!(V=!0)):(w&&(l.style.borderColor="yellow"),f.setX(a[0]),f.setY(a[1]),A=!(V=!1)),1===e.hands.length&&(s.style.borderColor="#eee",E=V=!1)}}M&&V?1.5<e.scaleFactor(t)?y=1:(y=e.scaleFactor(t),E=!0):E=!1,function(){A&&P();O&&S();E&&G();c.position.addVectors(h.target,b),b.lengthSq()>Math.pow(v,2)&&c.position.addVectors(h.target,b.setLength(v));b<Math.pow(m,2)&&c.position.addVectors(h.target,b.setLength(m));c.lookAt(h.target)}()}else l.style.borderColor="#eee",s.style.borderColor="#eee",M=V=!1,pointingFlag=!1,h.sceneManager.controls&&(h.sceneManager.controls.enabled=!0)})};var o,i,a,s,l,R,x,T,C,D,P=(i=new THREE.Vector3,a=new THREE.Quaternion,s=new THREE.Vector3,l=new THREE.Vector3,R=new THREE.Vector3,x=new THREE.Vector3,function(){x.set(f.x,f.y,0),(o=x.length())&&(b.copy(c.position).sub(h.target),s.copy(b).normalize(),l.copy(c.up).normalize(),R.crossVectors(l,s).normalize(),l.setLength(f.y),R.setLength(f.x),x.copy(l.add(R)),i.crossVectors(x,b).normalize(),o*=n,a.setFromAxisAngle(i,o),b.applyQuaternion(a),c.up.applyQuaternion(a))}),S=(T=new THREE.Vector2,C=new THREE.Vector3,D=new THREE.Vector3,function(){b.subVectors(c.position,h.target),T.copy(u),T.multiplyScalar(b.length()*r),D.copy(b).cross(c.up).setLength(T.x),D.add(C.copy(c.up).setLength(-T.y)),c.position.add(D),h.target.add(D)}),G=function(){var e=2-y;b.multiplyScalar(e)};this.startControls()},VOne.LeapGrabControls.prototype={constructor:VOne.LeapGrabControls},THREE.Mesh.prototype.addClass=function(e){return void 0===this.classes&&(this.classes=[]),this.classes.indexOf(-1!==e)&&this.classes.push(e),this.classes},THREE.Mesh.prototype.removeClass=function(e){if(void 0===this.classes)return-1;var t=this.classes.indexOf(e);return-1<t&&this.classes.splice(t,1),this.classes};var areEquivalentObjects=function t(r,n){var e=Object.keys,o=void 0===r?"undefined":_typeof(r),i=void 0===n?"undefined":_typeof(n);return r&&n&&"object"===o&&o===i?e(r).length===e(n).length&&e(r).every(function(e){return t(r[e],n[e])}):r===n};Array.prototype.extend=function(e){e.forEach(function(e){this.push(e)},this)},VOne.select=function(e){var t=new VOne.Selection,r=0,n=1;switch(e.charAt(0)){case"#":r=VOne.MeshNameProperty;break;case"_":r=VOne.ChildNameProperty;break;case".":r=VOne.MeshClassName;break;default:r=VOne.ChildNameProperty,n=0}for(var o=e.substr(n),i=VOne.Scenes.length,a=0;a<i;a++){var s=VOne.Scenes[a].getSceneObjects();if(r===VOne.ChildNameProperty)void 0!==_typeof(s[o])&&t.selected.push(s[o]);else for(var l=Object.keys(s),h=0;h<l.length;h++)if(Array.isArray(s[l[h]]))s[l[h]].forEach(function(e){switch(r){case VOne.MeshNameProperty:e.name===o&&t.selected.push(e);break;case VOne.MeshClassName:void 0!==e.classes&&-1!==e.classes.indexOf(o)&&t.selected.push(e)}});else switch(r){case VOne.MeshNameProperty:s[l[h]].name===o&&t.selected.push(s[l[h]]);break;case VOne.MeshClassName:void 0!==s[l[h]].classes&&-1!==s[l[h]].classes.indexOf(o)&&t.selected.push(s[l[h]])}}return t},VOne.Selection=function(){this.selected=[],this.positionAnimationDuration=void 0,this.positionAnimationTarget=void 0,this.scaleAnimationDuration=void 0,this.scaleAnimationTarget=void 0},VOne.Selection.prototype={constructor:VOne.Selection,setPositionAnimationTarget:function(e){return this.positionAnimationTarget=e,this},setPositionAnimationDuration:function(e){return this.positionAnimationDuration=e,this},setScaleAnimationTarget:function(e){return this.scaleAnimationTarget=e,this},setScaleAnimationDuration:function(e){return this.scaleAnimationDuration=e,this},start:function(){var t,r,n=new VOne.Animation,o=this;void 0!==this.positionAnimationTarget&&("function"==typeof this.positionAnimationTarget?this.selected.forEach(function(e){t=o.positionAnimationTarget(e),r=o.getDurationFor(e),n.meshBasicAnimation(e,VOne.PositionAnimation,t,r)}):this.selected.forEach(function(e){t=o.positionAnimationTarget,r=o.getDurationFor(e),n.meshBasicAnimation(e,VOne.PositionAnimation,t,r)}));void 0!==this.scaleAnimationTarget&&("function"==typeof this.scaleAnimationTarget?this.selected.forEach(function(e){t=o.scaleAnimationTarget(e),r=o.getDurationFor(e),n.meshBasicAnimation(e,VOne.ScaleAnimation,t,r)}):this.selected.forEach(function(e){t=o.scaleAnimationTarget,r=o.getDurationFor(e),n.meshBasicAnimation(e,VOne.ScaleAnimation,t,r)}))},getDurationFor:function(e){var t;return e===VOne.PositionAnimation?void 0!==this.positionAnimationDuration&&(t="function"==typeof this.positionAnimationDuration?this.positionAnimationDuration(this):this.positionAnimationDuration):void 0!==this.scaleAnimationDuration&&(t="function"==typeof this.scaleAnimationDuration?this.scaleAnimationDuration(this):this.scaleAnimationDuration),t}},VOne.Selection3D=function(e){if(!e instanceof VOne.ThreeSceneManager)throw new Error("Can't recognize scene as VOne.ThreeSceneManager object type.");this.type="Selection3D",this._scene=e},VOne.Selection3D.prototype={constructor:VOne.Selection3D,startSelectionMode:function(R,l,e){var x=this;if(!R.mesh instanceof THREE.Object3D||!R instanceof VOne.BufferGeometryModel||!R instanceof VOne.GeometryModel)return console.error("ERROR ON VOne.Selection3D.startSelection: You must provide a VOne GeometryModel instance with a mesh set.");this._scene.controls&&(this._scene.controls.enabled=!1);var h=new THREE.Vector2,c=new THREE.Vector2;e||this._domElement||((e=document.createElement("div")).style.position="fixed",e.style.border="solid 1px #eee",e.style.borderRadius="0.1rem",e.style.padding="0.5rem",document.body.appendChild(e)),this._domElement||(this._domElement=e),this.onMouseDown=function(e){h.x=e.clientX,h.y=e.clientY,x.selecting=!0;var t=h.x+1,r=h.x+1,n=h.y+1,o=h.y+1;x._domElement.style.left=t+"px",x._domElement.style.top=n+"px",x._domElement.style.width=r-t+"px",x._domElement.style.height=o-n+"px",x._domElement.style.visibility="visible"},this.onMouseMove=function(e){c.x=e.clientX,c.y=e.clientY;var t=h.x,r=c.x,n=h.y,o=c.y;if(r<t){var i=t;t=r,r=i}if(o<n){var a=n;n=o,o=a}if(x.selecting){x._domElement.style.left=t+"px",x._domElement.style.top=n+"px",x._domElement.style.width=r-t+"px",x._domElement.style.height=o-n+"px",x._domElement.style.visibility="visible";var s=function(e,t,r,n){var o=e/window.innerWidth*2-1,i=t/window.innerWidth*2-1,a=-r/window.innerHeight*2+1,s=-n/window.innerHeight*2+1,l=(new THREE.Vector3).copy(x._scene.camera.position),h=new THREE.Vector3(o,a,0).unproject(x._scene.camera),c=new THREE.Vector3(i,a,0).unproject(x._scene.camera),d=new THREE.Vector3(o,s,0).unproject(x._scene.camera),u=new THREE.Vector3(i,s,0).unproject(x._scene.camera),p=h.clone().sub(l),f=c.clone().sub(l),y=u.clone().sub(l);p.normalize(),f.normalize(),y.normalize(),p.multiplyScalar(Number.MAX_VALUE),f.multiplyScalar(Number.MAX_VALUE),y.multiplyScalar(Number.MAX_VALUE),p.add(l),f.add(l),y.add(l);var g=new THREE.Plane;g.setFromCoplanarPoints(l,h,c);var m=new THREE.Plane;m.setFromCoplanarPoints(l,u,d);var v=new THREE.Plane;v.setFromCoplanarPoints(d,h,l);var A=new THREE.Plane;A.setFromCoplanarPoints(x._scene.camera.position,c,u);var O=new THREE.Plane;O.setFromCoplanarPoints(c,u,d);var E=new THREE.Plane;E.setFromCoplanarPoints(y,f,p),E.normal.multiplyScalar(-1);var V=new THREE.Frustum(g,A,m,v,O,E),M=[];if(R.mesh instanceof THREE.Points)for(var w=0;w<R.dataModel.length;w++){var b=new THREE.Vector3(R.positionArray[3*w],R.positionArray[3*w+1],R.positionArray[3*w+2]);V.containsPoint(b)&&M.push({record:R.dataModel[w],index:w})}return M}(t,r,n,o);"function"==typeof l&&l({records:s})}},this.onMouseUp=function(e){x.selecting=!1},this._scene._scene.VOneData.container.addEventListener("mousedown",this.onMouseDown),this._scene._scene.VOneData.container.addEventListener("mousemove",this.onMouseMove),this._scene._scene.VOneData.container.addEventListener("mouseup",this.onMouseUp)},deactivateSelectionMode:function(){this._scene.controls&&(this._scene.controls.enabled=!0),this.clearSelection(),this._scene._scene.VOneData.container.removeEventListener("mousedown",this.onMouseDown),this._scene._scene.VOneData.container.removeEventListener("mousemove",this.onMouseMove),this._scene._scene.VOneData.container.removeEventListener("mouseup",this.onMouseUp),this.selecting=!1},clearSelection:function(){this._domElement.style.visibility="hidden"},select:function(){}},VOne.Utils.curve2d=function(e,t,r,n){n=n||64,!e instanceof THREE.Vector3&&(e=new THREE.Vector3(e.x,e.y,e.z)),!t instanceof THREE.Vector3&&(t=new THREE.Vector3(t.x,t.y,t.z));e.distanceTo(t);var o=e.angleTo(t),i=VOne.HalfPI/1.5,a=void 0,s=void 0;t.y>=e.y?(a={x:r*Math.cos(o+i)+e.x,y:r*Math.sin(o+2*i)+e.y,z:e.z},s={x:r*Math.cos(o+i)+t.x,y:r*Math.sin(o+2*i)+t.y,z:t.z}):t.x>=e.x?(a={x:r*Math.cos(o-i)+e.x,y:r*Math.sin(o-i)+e.y,z:e.z},s={x:r*Math.cos(o-i/2)+t.x,y:r*Math.sin(o+2*i+Math.PI)+t.y,z:t.z}):(e.z>=t.z&&(o-=i),a={x:r*Math.cos(o+i)+e.x,y:-r*Math.sin(o-2*i)+e.y,z:e.z},s={x:r*Math.cos(o+i)+t.x,y:-r*Math.sin(o-2*i)+t.y,z:t.z});var l=[e,a,s,t],h=[],c=1/n,d=c;t.z,e.z;h.push(f(0));for(var u=0;u<n;u++)h.push(f(d)),d+=c;function p(e,t){for(var r=1,n=e-t+1;n<=e;n++)r*=n;for(n=1;n<=t;n++)r/=n;return r}function f(e){for(var t=0,r=0,n=0,o=l.length-1,i=0;i<=o;i++){var a=p(o,i)*Math.pow(1-e,o-i)*Math.pow(e,i);t+=a*l[i].x,r+=a*l[i].y,n+=a*l[i].z}return new THREE.Vector3(t,r,n)}return h},VOne.AnimationEngine=function(e){this.type="VOne.AnimationEngine",this.animate.bind(this)},VOne.AnimationEngine.prototype={constructor:VOne.AnimationEngine,animate:function(e){for(var t=e.getSceneObjects(),r=Object.keys(t),n=0;n<r.length;n++){var o=t[r[n]];if(o instanceof THREE.Points){if("function"!=typeof o.getModel)return;var i=o.getModel();if(i.animating){var a=!(i.animating=!1),s=!0,l=!0,h=i.getDataModel();for(n=0;n<h.length;n++){var c=h[n],d=!0;if(c.animating){if(c.positionTween&&c.positionTween.running){var u=1e3*c.positionTween.clock.getElapsedTime()/c.positionTween.tweenDuration,p=i.getPositionArray();if(u<1){var f=c.positionTween.delta.clone();f.multiplyScalar(u);var y=c.positionTween.start.clone();y.sub(f),p[3*n]=y.x,p[3*n+1]=y.y,p[3*n+2]=y.z,o.geometry.attributes.position.needsUpdate=!0,i.animating=!0}else c.position.set(c.positionTween.dest.x,c.positionTween.dest.y,c.positionTween.dest.z),p[3*n]=c.positionTween.dest.x,p[3*n+1]=c.positionTween.dest.y,p[3*n+2]=c.positionTween.dest.z,o.geometry.attributes.position.needsUpdate=!0,c.positionTween.running=!1}if(c.scaleTween&&c.scaleTween.running){u=1e3*c.scaleTween.clock.getElapsedTime()/c.scaleTween.tweenDuration;var g=i.getSizeArray();if(u<1){var m=c.scaleTween.delta;m*=u;var v=c.scaleTween.start;v+=m,c.size=v,g[n]=v,o.geometry.attributes.size.needsUpdate=!0,i.animating=!0}else c.size=c.scaleTween.dest,g[n]=c.scaleTween.dest,o.geometry.attributes.size.needsUpdate=!0,c.scaleTween.running=!1}if(c.alphaTween&&c.alphaTween.running){u=1e3*c.alphaTween.clock.getElapsedTime()/c.alphaTween.tweenDuration;var A=i.getAlphaArray();if(u<1){m=c.alphaTween.delta;m*=u;v=c.alphaTween.start;v+=m,c.alpha=v,A[n]=v,o.geometry.attributes.alpha.needsUpdate=!0,i.animating=!0}else c.alpha=c.alphaTween.dest,A[n]=c.alphaTween.dest,o.geometry.attributes.alpha.needsUpdate=!0,c.alphaTween.running=!1}c.scaleTween&&c.scaleTween.running||(a=!1),c.positionTween&&c.positionTween.running||(s=!1),c.alphaTween&&c.alphaTween.running||(l=!1),s||a||l||(d=!1),c.animating=d}}i.animating||o.geometry.computeBoundingSphere()}}else if(o instanceof THREE.Mesh||o instanceof THREE.Camera)VOne.AnimationEngine.animateMesh(o);else if(0<o.children.length){o.animating&&VOne.AnimationEngine.animateMesh(o);for(var O=0;O<o.children.length;O++)o.children[O].animating&&VOne.AnimationEngine.animateMesh(o.children[O])}}}},VOne.AnimationEngine.animateMesh=function(e){if(e.animating){var t,r=!0,n=!0,o=!0;if(e.positionTween&&e.positionTween.running)if((t=1e3*e.positionTween.clock.getElapsedTime()/e.positionTween.tweenDuration)<1){var i=e.positionTween.delta.clone();i.multiplyScalar(t);var a=e.positionTween.start.clone();a.sub(i),e.position.set(a.x,a.y,a.z)}else e.position.set(e.positionTween.dest.x,e.positionTween.dest.y,e.positionTween.dest.z),e.positionTween.running=!1;if(e.scaleTween&&e.scaleTween.running)if((t=1e3*e.scaleTween.clock.getElapsedTime()/e.scaleTween.tweenDuration)<1){var s=e.scaleTween.delta.clone();s.multiplyScalar(t);var l=e.scaleTween.start.clone();l.sub(s),e.scale.set(l.x,l.y,l.z)}else e.scale.set(e.scaleTween.dest.x,e.scaleTween.dest.y,e.scaleTween.dest.z),e.scaleTween.running=!1;e.scaleTween&&e.scaleTween.running||(n=!1),e.positionTween&&e.positionTween.running||(o=!1),o||n||(r=!1),e.animating=r}},VOne.Animation=function(){},VOne.Animation.prototype.constructor=VOne.Animation,VOne.Animation.prototype.meshBasicAnimation=function(e,t,r,n,o){var i,a,s,l=n||500;if(!(r instanceof THREE.Vector3))return console.error("Target position / scale must be a THREE.Vector3. Try again."),-1;if(t===VOne.PositionAnimation)i="positionTween",a=e.position.clone(),(s=e.position.clone()).sub(r);else{if(t!==VOne.ScaleAnimation)return console.error("Provide a valid animation type."),-1;i="scaleTween",a=e.scale.clone(),(s=e.scale.clone()).sub(r)}var h=new THREE.Clock;h.start();var c={start:a,dest:r,tweenDuration:l,clock:h,delta:s,running:!0};e[i]=c,e.animating=!0},VOne.Animation.prototype.pointsBasicAnimation=function(e,t,r,n,o){var i,a,s,l=o||500;if(0===l&&(l=1),!(e instanceof THREE.Points))return console.error("A THREE.Points object must be supplied in order to be animated."),-1;if(r===VOne.PositionAnimation&&!(n instanceof THREE.Vector3))return console.error("Target position in position animation must be a THREE.Vector3. Try again."),-1;var h=e.getModel(),c=h.getDataModel();if(r===VOne.PositionAnimation)i="positionTween",a=c[t].position.clone(),(s=c[t].position.clone()).sub(n),c[t].position.set(n.x,n.y,n.z);else if(r===VOne.ScaleAnimation)i="scaleTween",a=c[t].size,s=c[t].size-n;else{if(r!==VOne.AlphaAnimation)return console.error("Provide a valid animation type."),-1;i="alphaTween",a=c[t].alpha,s=c[t].alpha-n}var d=new THREE.Clock;d.start();var u={start:a,dest:n,tweenDuration:l,clock:d,delta:s,running:!0};c[t][i]=u,c[t].animating=!0,h.animating=!0},VOne.AAnimation=function(){this.clock=new THREE.Clock,this.runningAnimations={},this.currentAnimationIndex=0;var O=function(){};this.pointsAnimation=function(i,e){var t=e.indexes,n=e.targets,a=e.duration,r=e.animationType,o=e.onFinished;if(!t||!n||!a)return console.error("indexes, targets and duration are required for using pointsAnimation.");var s=new O;s.clock=new THREE.Clock;var l=Array.isArray(t)?t:[t],h=!Array.isArray(a),c=r===VOne.PositionAnimation||r===VOne.ColorAnimation?3:1,d=l.length*c;s.sourceArray=new Float32Array(d),s.targetArray=new Float32Array(d),s.deltaArray=new Float32Array(d);var u=0,p=0,f=function(e){switch(e){case VOne.PositionAnimation:return"position";case VOne.ColorAnimation:return"color";case VOne.AlphaAnimation:return"alpha";case VOne.ScaleAnimation:return"size";default:return"position"}}(r),y=f+"Array",g=function(e){switch(e){case VOne.PositionAnimation:return["x","y","z"];case VOne.ColorAnimation:return["r","g","b"];default:return!1}}(r);l.forEach(function(e,t){p=t*c;for(var r=0;r<c;r++)u=p+r,g?(s.sourceArray[u]=i.dataModel[e][f][g[r%c]],s.targetArray[u]=n[t][g[r%c]]):(s.sourceArray[u]=i.dataModel[e][f],s.targetArray[u]=n[t]),s.deltaArray[u]=s.targetArray[u]-s.sourceArray[u]}),s.onFinish=function(){for(var e=0;e<t.length;e++)g?i.dataModel[e][f].copy(n[e]):i.dataModel[e][f]=n[e];r===VOne.PositionAnimation&&i.geometry.computeBoundingSphere(),"function"==typeof o&&o()};var m=void 0,v=void 0,A="animation_"+this.currentAnimationIndex;m=g?function(){if(!v){for(var e=1e3*s.clock.getElapsedTime(),t=!0,r=0;r<l.length;r++){var n=e/(h?a:a[r]);p=r*c;for(var o=0;o<c;o++)u=p+o,n<1?(i[y][l[r]*c+o]=s.sourceArray[u]+s.deltaArray[u]*n,t=!1):i[y][l[r]*c+o]=s.targetArray[u]}i.geometry.attributes[f].needsUpdate=!0,t&&(v=!0,i.mesh.sceneManager.removeFromOnRenderById(A),s.onFinish())}}:function(){if(!v){for(var e=1e3*s.clock.getElapsedTime(),t=!0,r=0;r<l.length;r++){var n=e/(h?a:a[r]);n<1?(i[y][l[r]]=s.sourceArray[r]+s.deltaArray[r]*n,t=!1):i[y][l[r]]=s.targetArray[r]}i.geometry.attributes[f].needsUpdate=!0,t&&(v=!0,i.mesh.sceneManager.removeFromOnRenderById(A),s.onFinish())}},i.mesh.sceneManager.setOnRender(m,{},A),this.currentAnimationIndex++}},VOne.AAnimation.prototype.constructor=VOne.AAnimation,VOne.ShaderCreator=function(){},VOne.ShaderCreator.prototype={constructor:VOne.ShaderCreator,createShader:function(e){var t,r=[],n=[];e.color?(r.push("attribute vec3 "+e.color+";"),r.push("varying vec3 vColor;")):e.varyingColor&&(r.push("attribute vec3 "+e.varyingColor.startColor+";"),r.push("attribute vec3 "+e.varyingColor.endColor+";"),r.push("varying vec3 vColor;")),e.textureArrayIndex&&(r.push("attribute float "+e.textureArrayIndex+";"),r.push("varying float v"+e.textureArrayIndex+";")),e.varyingAttributes&&(r.push("attribute float "+e.varyingAttributes.age+";"),r.push("attribute float "+e.varyingAttributes.duration+";")),e.size?r.push("attribute float "+e.size+";"):e.varyingSize&&(r.push("attribute float "+e.varyingSize.startSize+";"),r.push("attribute float "+e.varyingSize.endSize+";")),e.alpha&&"string"==typeof e.alpha&&(r.push("attribute float "+e.alpha+";"),r.push("varying float VOneAlphaValue;")),r.push("void main() {"),e.varyingAttributes&&r.push("float factor = "+e.varyingAttributes.age+" / "+e.varyingAttributes.duration+";"),e.color?r.push("vColor = "+e.color+";"):e.varyingColor&&r.push("vColor = mix("+e.varyingColor.startColor+", "+e.varyingColor.endColor+", factor);"),e.textureArrayIndex&&r.push("v"+e.textureArrayIndex+" = "+e.textureArrayIndex+";"),e.alpha&&"string"==typeof e.alpha&&r.push("VOneAlphaValue = "+e.alpha+";"),r.push("vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );"),e.points&&!e.varyingSize&&(t=e.pointsFactor||"200.0",r.push("gl_PointSize = size * ( "+t+" / length( mvPosition.xyz ) );")),e.points&&e.varyingSize&&(t=e.pointsFactor||"200.0",r.push("float sizeFactor = "+e.varyingAttributes.age+" / "+e.varyingAttributes.duration+";"),r.push("gl_PointSize = "+e.varyingSize.startSize+" + sizeFactor *  ( "+e.varyingSize.endSize+" - "+e.varyingSize.startSize+") * ( "+t+" / length(mvPosition.xyz ) ); ")),r.push("gl_Position = projectionMatrix * mvPosition;"),r.push("}");var o={};if(e.coverColor?o.colorUniform={type:"c",value:e.coverColor}:o.colorUniform={type:"c",value:new THREE.Color(16777215)},e.useTexture){var i=(new THREE.TextureLoader).load(e.useTexture);o.texture={type:"t",value:i},n.push("uniform sampler2D texture;")}if(e.textureArray){if(!e.textureArrayIndex||!Array.isArray(e.textureArray))return console.error("No texture array index property (attribute name) provided."),-1;o.texture={type:"t",value:i},n.push("uniform sampler2D textures["+e.textureArray.length+"];"),n.push("varying float v"+e.textureArrayIndex+";")}if(e.useTHREETexture&&(o.texture={type:"t",value:e.useTHREETexture},n.push("uniform sampler2D texture;")),n.push("uniform vec3 colorUniform;"),n.push("varying vec3 vColor;"),e.alpha?"number"==typeof e.alpha?(o.VOneAlphaValue={value:e.alpha},n.push("uniform float VOneAlphaValue;")):n.push("varying float VOneAlphaValue;"):(o.VOneAlphaValue={value:1},n.push("uniform float VOneAlphaValue;")),e.textureArray&&n.push("varying float v"+e.textureArrayIndex+";"),n.push("void main() {"),e.color||e.varyingColor?n.push("gl_FragColor = vec4( colorUniform * vColor, VOneAlphaValue );"):n.push("gl_FragColor = vec4( colorUniform, VOneAlphaValue );"),(e.useTexture||e.useTHREETexture)&&e.points)n.push("gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );"),e.alpha&&n.push("if ( gl_FragColor.a < 0.001 ) discard;");else if(e.textureArray){n.push("vec4 startColor = vec4(vColor, 1.0);"),n.push("vec4 finalColor;");for(var a=0;a<e.textureArray.length;a++)n.push("vec4 finalColor;"),n.push("if(v"+e.textureArrayIndex+" < "+a+".5){ "),n.push("finalColor = texture2D(textures["+a+"], gl_PointCoord);"),n.push("}")}else e.color&&(e.alpha?n.push("gl_FragColor.a = VOneAlphaValue;"):n.push("gl_FragColor = vec4( colorUniform * vColor, 1.0 );"));return n.push("}"),{vertexShader:r.join("\n"),fragmentShader:n.join("\n"),uniforms:o}}},VOne.Label3D=function(e,t){void 0===t&&(t={});var r=t.hasOwnProperty("fontFace")?t.fontFace:"Arial Narrow",n=t.hasOwnProperty("fontSize")?t.fontSize:18,o=t.hasOwnProperty("lineLength")?t.lineLength:27,i=t.hasOwnProperty("maxLines")?t.maxLines:3,a=t.hasOwnProperty("lineHeight")?t.lineHeight:n+5,s=t.hasOwnProperty("borderThickness")?t.borderThickness:2,l=t.hasOwnProperty("borderColor")?t.borderColor:{r:150,g:0,b:150,a:0},h=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:0},c=t.hasOwnProperty("textColor")?t.textColor:{r:30,g:0,b:190,a:1},d=t.canvasFixedWidth,u=t.canvasFixedHeight,p=[];"number"==typeof e&&(e=e.toString());for(var f,y,g=e.split(" "),m=0,v=0;v<i&&m<g.length;v++)for(p[v]="",f=!1,y=0;!f&&m<g.length;)y+g[m].length<o?(p[v]+=" "+g[m],m++,y=p[v].length):(p[v]+=" ",f=!0);m<g.length&&(p[i-1]+="...");var A,O,E=n*o,V=p.length*a;d?A=d:(A=nearestPow2(E))<E&&(A*=2),u?O=u:V<(O=nearestPow2(V))&&(O*=2);var M=document.createElement("canvas");M.width=A,M.height=O;var w=M.getContext("2d");w.font=n+"px "+r,w.textAlign=t.textAlign||"center",w.font=n+"px "+r,w.fillStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",w.strokeStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")",w.lineWidth=s,w.fillStyle="rgba("+c.r+", "+c.g+", "+c.b+","+parseFloat(c.a?c.a:1)+")";var b=Math.floor(A/2),R=Math.ceil(O/2-V/2+a/2);p.forEach(function(e){w.fillText(e,b,R),R+=a});var x,T,C=new THREE.Texture(M);return C.needsUpdate=!0,t.spriteMaterial?(x=new THREE.SpriteMaterial({map:C,side:THREE.DoubleSide,transparent:!0}),(T=new THREE.Sprite(x)).scale.set(.5*M.width,.5*M.height,1)):((x=new THREE.MeshBasicMaterial({map:C,side:THREE.DoubleSide})).transparent=!0,T=new THREE.Mesh(new THREE.PlaneGeometry(A,O),x)),T.material.depthTest=!1,T},VOne.LogScale=function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return console.error("VOne.LogScale: Domain and range must be provided as arrays!"),-1;this.domain=e,this.range=t,this.domain[0]===this.domain[1]&&(this.domain[1]=this.domain[0]+1),this.minDomainValue=this.domain[0],this.maxDomainValue=this.domain[1],this.minRangeValue=Math.log(this.range[0]),this.maxRangeValue=Math.log(this.range[1]),this.scale=(this.maxRangeValue-this.minRangeValue)/(this.maxDomainValue-this.minDomainValue)},VOne.LogScale.prototype={constructor:VOne.LogScale,getValueFor:function(e){return Math.exp(this.minRangeValue+this.scale*(e-this.minDomainValue))}},VOne.Polygon=function(e,t,r,n,o,i){var a=360/e,s=o?90:0;this.vertices=[];for(var l=0;l<e;l++){var h=calculateXYInRadius(s,n);h.x+=t,h.y+=r,this.vertices.push(new THREE.Vector2(h.x,h.y)),s+=a}this.vertices.push(this.vertices[0])},VOne.Polygon.prototype.constructor=VOne.Polygon,VOne.HexGrid=function(e,t,r,n,o,i){if(this.lengthX=e<r?r-e:e-r,this.lengthY=t<n?n-t:t-n,this.rotated=i||!0,this.shapes=[],this.model=[],this.byNameModel={},this.hexRadius=o/2,this.startX=e,this.startY=t,this.endX=r,this.endY=n,this.rotated){var a=calculateXYInRadius(30,this.hexRadius),s=calculateXYInRadius(330,this.hexRadius),l=calculateXYInRadius(150,this.hexRadius);this.deltaY=a.y-s.y,this.deltaX=(a.x-l.x)/2}else{a=calculateXYInRadius(60,this.hexRadius),s=calculateXYInRadius(120,this.hexRadius),l=calculateXYInRadius(300,this.hexRadius);this.deltaY=(a.y-l.y)/2,this.deltaX=a.x-s.x}for(var h=this.rotated?Math.ceil(this.lengthY/(this.hexRadius+2*this.deltaY)):Math.ceil(this.lengthY/this.deltaY),c=this.lengthX/this.deltaX,d=this.rotated?Math.ceil(c):Math.ceil(this.lengthX/(this.hexRadius+deltaX)),u=e,p=t,f=0;f<d;f++){for(var y=0;y<h;y++){var g=new VOne.Polygon(6,u,p,this.hexRadius,this.rotated);g.index=f*h+y;var m=new THREE.Shape(g.vertices);m.name="v"+f+"_"+y,g.name="v"+f+"_"+y,g.center=new THREE.Vector2(u,p),p+=3*this.deltaY,this.shapes.push(m),this.model.push(g),this.byNameModel["v"+f+"_"+y]=g}this.rotated?(p=f%2==0?t+3*this.hexRadius/2:t,u+=this.deltaX):(u=y%2==0?e+3*this.hexRadius/2:e,p+=this.deltaY)}this.shapeGeometry=new THREE.ShapeGeometry(this.shapes)},VOne.HexGrid.prototype.constructor=VOne.HexGrid,VOne.HexGrid.prototype.generateBufferGeometries=function(e){for(var t=e||0,r=this.shapeGeometry.faces.length,n=new Float32Array(9*r),o=new Float32Array(9*r),i=0;i<r;i++){var a=this.shapeGeometry.faces[i];n[9*i]=this.shapeGeometry.vertices[a.a].x,n[9*i+1]=this.shapeGeometry.vertices[a.a].y,n[9*i+2]=t,n[9*i+3]=this.shapeGeometry.vertices[a.b].x,n[9*i+4]=this.shapeGeometry.vertices[a.b].y,n[9*i+5]=t,n[9*i+6]=this.shapeGeometry.vertices[a.c].x,n[9*i+7]=this.shapeGeometry.vertices[a.c].y,n[9*i+8]=t,o[9*i]=a.normal.x,o[9*i+1]=a.normal.y,o[9*i+2]=a.normal.z,o[9*i+3]=a.normal.x,o[9*i+4]=a.normal.y,o[9*i+5]=a.normal.z,o[9*i+6]=a.normal.x,o[9*i+7]=a.normal.y,o[9*i+8]=a.normal.z}return this.bufferGeometry=new THREE.BufferGeometry,this.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(n,3)),this.bufferGeometry.addAttribute("normal",new THREE.BufferAttribute(o,3)),this.pointsCount=n.length,this.bufferGeometryModel=new VOne.BufferGeometryModel(this.model),this.bufferGeometryModel.setGeometry(this.bufferGeometry),this.bufferGeometryModel.setPositionArray(n),this},VOne.HexGrid.prototype.setGeometriesColor=function(e){var t=this.model.length;if("function"==typeof e)for(var r=0;r<t;r++)this.model[r].color=e(this.model[r]);else{if(!(e instanceof THREE.Color))return console.error("No valid color provided for HexGrid."),-1;for(r=0;r<t;r++)this.model[r].color=e}var n=this.shapeGeometry.faces.length,o=new Float32Array(9*n),i=n/t;for(r=0;r<n;r++){var a=Math.floor(r/i);o[9*r]=this.model[a].color.r,o[9*r+1]=this.model[a].color.g,o[9*r+2]=this.model[a].color.b,o[9*r+3]=this.model[a].color.r,o[9*r+4]=this.model[a].color.g,o[9*r+5]=this.model[a].color.b,o[9*r+6]=this.model[a].color.r,o[9*r+7]=this.model[a].color.g,o[9*r+8]=this.model[a].color.b}return this.bufferGeometry.addAttribute("color",new THREE.BufferAttribute(o,3)),this.bufferGeometryModel.setColorArray(o),this},VOne.HexGrid.prototype.setGeometriesAlpha=function(e){var t=this.model.length;if("function"==typeof e)for(var r=0;r<t;r++)this.model[r].alpha=e(this.model[r]);else{if("number"!=typeof e)return console.error("No valid alpha provided for HexGrid."),-1;for(r=0;r<t;r++)this.model[r].alpha=e}var n=this.shapeGeometry.faces.length,o=new Float32Array(3*n),i=n/t;for(r=0;r<n;r++){var a=Math.floor(r/i);o[3*r]=this.model[a].alpha,o[3*r+1]=this.model[a].alpha,o[3*r+2]=this.model[a].alpha}return this.bufferGeometry.addAttribute("alpha",new THREE.BufferAttribute(o,1)),this.bufferGeometryModel.setAlphaArray(o),this},VOne.HexGrid.prototype.generateEdgesGeometry=function(e){for(var t=e||0,r=this.shapes.length,n=new Float32Array(36*r),o=0;o<r;o++)for(var i=this.shapes[o],a=0;a<6;a++)n[36*o+6*a]=i.actions[a].args[0],n[36*o+6*a+1]=i.actions[a].args[1],n[36*o+6*a+2]=t,n[36*o+6*a+3]=i.actions[a+1].args[0],n[36*o+6*a+4]=i.actions[a+1].args[1],n[36*o+6*a+5]=t;return this.edgesBufferGeometry=new THREE.BufferGeometry,this.edgesBufferGeometry.addAttribute("position",new THREE.BufferAttribute(n,3)),this.edgesBufferGeometry},VOne.HexGrid.prototype.whereIs=function(e,t){new THREE.Vector2(e,t);var r=void 0,n=this.hexRadius,o=this.startX<this.endX?this.startX:this.endX,i=this.startY<this.endY?this.startY:this.endY,a=(this.endX,this.endX,this.endX),s=(this.endY,this.endY,this.endY);if(e<o||a<e||t<i||s<t)return!1;var l=this.rotated?this.lengthY/(this.hexRadius+2*this.deltaY):this.lengthY/this.deltaY,h=this.rotated?this.lengthX/this.deltaX:this.lengthX/(this.hexRadius+deltaX),c=Math.floor((e-o)/this.lengthX*h),d=Math.floor((t-i)/this.lengthY*l);n=(r=this.byNameModel["v"+c+"_"+d]).center.distanceTo(new THREE.Vector2(e,t));for(var u=c-1;u<=c+1;u++)for(var p=d-1;p<=d+1;p++){var f=this.byNameModel["v"+u+"_"+p];if(f)f.center.distanceTo(new THREE.Vector2(e,t))<n&&(r=this.byNameModel["v"+u+"_"+p])}return r};